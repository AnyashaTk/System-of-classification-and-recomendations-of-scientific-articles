text,space_num,symbolic_percent,space_percent,num_world,num_columns,front_spaces_perc,back_spaces
"                                              MNRAS 000, 1‚Äì22 (2015)                                              Preprint 6 January 2021               Compiled using MNRAS LATEX style file v3.0",46.0,0.3865979381443299,0.6134020618556701,15.0,31.0,0.22772277227722773,0.03960396039603964
                                              A Composite Likelihood Approach for Inference under Photometric,46.0,0.5137614678899083,0.4862385321100917,8.0,1.0,0.22772277227722773,0.46039603960396036
                                              Redshift Uncertainty,46.0,0.2878787878787879,0.7121212121212122,2.0,1.0,0.22772277227722773,0.6732673267326732
"                                              M. M. Rau1‚òÖ , C. B. Morrison2 , S. J. Schmidt4 , S. Wilson3 , R. Mandelbaum1 ,",46.0,0.49193548387096775,0.5080645161290323,18.0,1.0,0.22772277227722773,0.38613861386138615
                                              Y.-Y.,46.0,0.09803921568627451,0.9019607843137255,1.0,1.0,0.22772277227722773,0.7475247524752475
                                              1,46.0,0.02127659574468085,0.9787234042553191,1.0,1.0,0.22772277227722773,0.7673267326732673
                                                    Mao5 for the LSST Dark Energy Science Collaboration,52.0,0.42718446601941745,0.5728155339805825,8.0,1.0,0.25742574257425743,0.4900990099009901
"                                                McWilliams Center for Cosmology, Department of Physics, Carnegie Mellon University, Pittsburgh, PA 15213",48.0,0.6052631578947368,0.39473684210526316,13.0,1.0,0.2376237623762376,0.24752475247524752
"                                              2 Department  of Astronomy, University of Washington, Box 351580, Seattle, WA 98195, USA",46.0,0.5597014925373134,0.4402985074626866,13.0,2.0,0.22772277227722773,0.3366336633663366
"                                              3 School of Computer Science and Statistics, Lloyd Institute, Trinity College, Dublin, Ireland",46.0,0.5857142857142857,0.41428571428571426,13.0,1.0,0.22772277227722773,0.306930693069307
"                                              4 Department of Physics, University of California, Davis, CA 95616, USA",46.0,0.5213675213675214,0.4786324786324786,11.0,1.0,0.22772277227722773,0.42079207920792083
arXiv:2101.01184v1 [astro-ph.CO] 4 Jan 2021,0.0,0.9069767441860465,0.09302325581395354,5.0,1.0,0.0,0.7871287128712872
"                                              5 Department of Physics and Astronomy, Rutgers, The State University of New Jersey, Piscataway, NJ 08854, USA",46.0,0.6,0.4,17.0,1.0,0.22772277227722773,0.23267326732673266
                                              Accepted XXX. Received YYY; in original form ZZZ,46.0,0.43617021276595747,0.5638297872340425,8.0,1.0,0.22772277227722773,0.5346534653465347
                                                                                    ABSTRACT,84.0,0.08695652173913043,0.9130434782608696,1.0,1.0,0.4158415841584158,0.5445544554455446
                                                                                    Obtaining accurately calibrated redshift distributions of photometric samples is one of the great,84.0,0.4696132596685083,0.5303867403314917,13.0,1.0,0.4158415841584158,0.10396039603960394
"                                                                                    challenges in photometric surveys like LSST, Euclid, HSC, KiDS, and DES. We combine the",84.0,0.4327485380116959,0.5672514619883041,14.0,1.0,0.4158415841584158,0.1534653465346535
"                                                                                    redshift information from the galaxy photometry with constraints from two-point functions,",84.0,0.45977011494252873,0.5402298850574713,11.0,1.0,0.4158415841584158,0.13861386138613863
                                                                                    utilizing cross-correlations with spatially overlapping spectroscopic samples. Our likelihood,84.0,0.480225988700565,0.519774011299435,9.0,1.0,0.4158415841584158,0.12376237623762376
                                                                                    framework is designed to integrate directly into a typical large-scale structure and weak lensing,84.0,0.46408839779005523,0.5359116022099448,14.0,1.0,0.4158415841584158,0.10396039603960394
                                                                                    analysis based on two-point functions. We discuss efficient and accurate inference techniques,84.0,0.4632768361581921,0.536723163841808,12.0,1.0,0.4158415841584158,0.12376237623762376
                                                                                    that allow us to scale the method to the large samples of galaxies to be expected in LSST.,84.0,0.41954022988505746,0.5804597701149425,18.0,1.0,0.4158415841584158,0.13861386138613863
"                                                                                    We consider statistical challenges like the parametrization of redshift systematics, discuss and",84.0,0.4722222222222222,0.5277777777777778,12.0,1.0,0.4158415841584158,0.1089108910891089
"                                                                                    evaluate techniques to regularize the sample redshift distributions, and investigate techniques",84.0,0.4748603351955307,0.5251396648044693,11.0,1.0,0.4158415841584158,0.11386138613861385
                                                                                    that can help to detect and calibrate sources of systematic error using posterior predictive,84.0,0.44886363636363635,0.5511363636363636,14.0,1.0,0.4158415841584158,0.12871287128712872
                                                                                    checks. We evaluate and forecast photometric redshift performance using data from the Cos-,84.0,0.4482758620689655,0.5517241379310345,13.0,1.0,0.4158415841584158,0.13861386138613863
"                                                                                    moDC2 simulations, within which we mimic a DESI-like spectroscopic calibration sample for",84.0,0.4508670520231214,0.5491329479768786,12.0,1.0,0.4158415841584158,0.14356435643564358
"                                                                                    cross-correlations. Using a combination of spatial cross-correlations and photometry, we show",84.0,0.4689265536723164,0.5310734463276836,11.0,1.0,0.4158415841584158,0.12376237623762376
                                                                                    that we can provide calibration of the mean of the sample redshift distribution to an accuracy,84.0,0.4438202247191011,0.5561797752808989,16.0,1.0,0.4158415841584158,0.1188118811881188
"                                                                                    of at least 0.002(1 + ùëß), consistent with the LSST-Y1 science requirements for weak lensing",84.0,0.44,0.56,15.0,1.0,0.4158415841584158,0.13366336633663367
                                                                                    and large-scale structure probes.,84.0,0.2564102564102564,0.7435897435897436,4.0,1.0,0.4158415841584158,0.42079207920792083
                                                                                    Key words: keyword1 ‚Äì keyword2 ‚Äì keyword3,84.0,0.28,0.72,7.0,1.0,0.4158415841584158,0.3811881188118812
                                              1    INTRODUCTION                                                             the broadband photometry of galaxies allows for a limited accuracy,46.0,0.3684210526315789,0.631578947368421,12.0,33.0,0.22772277227722773,0.05940594059405946
"                                                                                                                            in the estimated redshifts. In photometric surveys, we therefore typ-",124.0,0.31088082901554404,0.689119170984456,10.0,1.0,0.6138613861386139,0.044554455445544594
                                              With ongoing and future large area photometric surveys like the,46.0,0.4954128440366973,0.5045871559633027,10.0,1.0,0.22772277227722773,0.46039603960396036
                                                                                                                            ically consider two-point statistics of density fields that have been,124.0,0.31088082901554404,0.689119170984456,10.0,1.0,0.6138613861386139,0.044554455445544594
"                                              Dark Energy Survey (DES; e.g., Abbott et al. 2018b), the Kilo-",46.0,0.48148148148148145,0.5185185185185186,11.0,1.0,0.22772277227722773,0.4653465346534653
"                                                                                                                            projected along the line-of-sight, i.e., in the redshift direction. They",124.0,0.32142857142857145,0.6785714285714286,10.0,1.0,0.6138613861386139,0.02970297029702973
"                                              Degree Survey (KiDS; e.g., Hildebrandt et al. 2017), the Hyper",46.0,0.49074074074074076,0.5092592592592593,10.0,1.0,0.22772277227722773,0.4653465346534653
                                                                                                                            are then subsequently compared with the corresponding weak lens-,124.0,0.2978723404255319,0.7021276595744681,9.0,1.0,0.6138613861386139,0.06930693069306926
"                                              Suprime-Cam (HSC; e.g., Aihara et al. 2018), the Rubin Observa-",46.0,0.4954128440366973,0.5045871559633027,10.0,1.0,0.22772277227722773,0.46039603960396036
                                                                                                                            ing (WL) and large scale structure (LSS) theory predictions in a,124.0,0.2872340425531915,0.7127659574468085,11.0,1.0,0.6138613861386139,0.06930693069306926
"                                              tory Legacy Survey of Space and Time (LSST; e.g., Iveziƒá et al.",46.0,0.47706422018348627,0.5229357798165137,12.0,1.0,0.22772277227722773,0.46039603960396036
                                                                                                                            likelihood framework. These theory predictions have to account for,124.0,0.30526315789473685,0.6947368421052631,9.0,1.0,0.6138613861386139,0.05940594059405946
"                                              2019), the Roman Space Telescope (e.g. Spergel et al. 2015) and",46.0,0.48623853211009177,0.5137614678899083,11.0,1.0,0.22772277227722773,0.46039603960396036
"                                                                                                                            the line-of-sight projection, and therefore depend on the redshift",124.0,0.30526315789473685,0.6947368421052631,9.0,1.0,0.6138613861386139,0.05940594059405946
                                              Euclid (e.g. Laureƒ≥s et al. 2011) modern cosmology has entered,46.0,0.49074074074074076,0.5092592592592593,10.0,1.0,0.22772277227722773,0.4653465346534653
                                                                                                                            distribution of the galaxies in the sample that have to be accurately,124.0,0.3005181347150259,0.6994818652849741,12.0,1.0,0.6138613861386139,0.044554455445544594
"                                              the era of precision cosmology, where it becomes increasingly im-",46.0,0.5045045045045045,0.49549549549549554,10.0,1.0,0.22772277227722773,0.45049504950495045
                                                                                                                            modelled and calibrated (see e.g. Huterer et al. 2006; Hoyle et al.,124.0,0.2931937172774869,0.7068062827225131,12.0,1.0,0.6138613861386139,0.054455445544554504
                                              portant to accurately account for sources of systematic bias and,46.0,0.5,0.5,10.0,1.0,0.22772277227722773,0.4554455445544554
                                                                                                                            2018; Tanaka et al. 2018; Hildebrandt et al. 2020; Joudaki et al.,124.0,0.2857142857142857,0.7142857142857143,12.0,1.0,0.6138613861386139,0.0643564356435643
                                              uncertainty (e.g. Mandelbaum 2018). Large area photometric sur-,46.0,0.5137614678899083,0.4862385321100917,8.0,1.0,0.22772277227722773,0.46039603960396036
                                                                                                                            2020).,124.0,0.046153846153846156,0.9538461538461538,1.0,1.0,0.6138613861386139,0.3564356435643564
                                              veys constrain cosmological parameters and the growth of structure,46.0,0.5178571428571429,0.4821428571428571,9.0,1.0,0.22772277227722773,0.4455445544554455
                                                                                                                                  A primary goal of large area photometric survey programs is to,130.0,0.2708333333333333,0.7291666666666667,11.0,1.0,0.6435643564356436,0.04950495049504955
                                              using two-point statistics of galaxy and shear fields (see e.g. Hilde-,46.0,0.5172413793103449,0.48275862068965514,11.0,1.0,0.22772277227722773,0.4257425742574258
"                                                                                                                            map the growth of structure and expansion history of the Universe,",124.0,0.29473684210526313,0.7052631578947368,11.0,1.0,0.6138613861386139,0.05940594059405946
                                              brandt et al. 2017; Uitert et al. 2017; Abbott et al. 2018a; Joudaki,46.0,0.49122807017543857,0.5087719298245614,13.0,1.0,0.22772277227722773,0.4356435643564357
                                                                                                                            and thereby constrain the dark energy equation of state via the,124.0,0.28342245989304815,0.7165775401069518,11.0,1.0,0.6138613861386139,0.07425742574257421
                                              et al. 2018; Hikage et al. 2019; Heymans et al. 2020). Using only,46.0,0.4774774774774775,0.5225225225225225,13.0,1.0,0.22772277227722773,0.45049504950495045
"                                                                                                                            distance-redshift and growth-redshift relations (see e.g., Albrecht",124.0,0.3193717277486911,0.6806282722513088,7.0,1.0,0.6138613861386139,0.054455445544554504
"                                                                                                                            et al. 2006, p. 31) which both enter the WL and LSS modelling.",124.0,0.26881720430107525,0.7311827956989247,13.0,1.0,0.6138613861386139,0.07920792079207917
                                                                                                                            Note that these fundamental relationships within our cosmological,124.0,0.30687830687830686,0.6931216931216931,8.0,1.0,0.6138613861386139,0.0643564356435643
"                                              ‚òÖ   E-mail: markusr@andrew.cmu.edu                                            model are redshift dependent, as are some key sources of theoret-",46.0,0.4497354497354497,0.5502645502645502,14.0,24.0,0.22772277227722773,0.0643564356435643
                                              ¬© 2015 The Authors,46.0,0.234375,0.765625,4.0,1.0,0.22772277227722773,0.6831683168316831
avr_spaces,74.83582089552239,1.0,0.0,1.0,1.0,0.3704743608689227,0.9504950495049505
2,0.0,1.0,0.0,1.0,1.0,0.0,0.995049504950495
"ical uncertainty, such as the galaxy-dark matter bias model (see        In contrast, template-based redshift inference requires a complete set",0.0,0.823943661971831,0.176056338028169,19.0,5.0,0.0,0.29702970297029707
e.g. Matarrese et al. 1997; Clerkin et al. 2015; Chang et al. 2016;     of templates but no calibration sample. Checking a fitted model can,0.0,0.8057553956834532,0.19424460431654678,24.0,3.0,0.0,0.31188118811881194
"Simon & Hilbert 2018; Prat et al. 2018). The inferred ensemble          also, in principle, use the color space alone, by comparing the pho-",0.0,0.7785714285714286,0.22142857142857142,23.0,6.0,0.0,0.306930693069307
redshift distributions for samples of galaxies can therefore exhibit a  tometry generated by the fitted templates with the measurements. In,0.0,0.8561151079136691,0.14388489208633093,20.0,2.0,0.0,0.31188118811881194
degeneracy with cosmological or astrophysical parameters. Inaccu-       practice this approach has limitations. The generation of SED model,0.0,0.841726618705036,0.15827338129496404,17.0,4.0,0.0,0.31188118811881194
"rate distance, or redshift, measurements based on the photometry of     templates is challenging and often requires spectroscopic reference",0.0,0.8489208633093526,0.15107913669064743,18.0,3.0,0.0,0.31188118811881194
"the galaxies are therefore important modelling systematics in these     data for some galaxies. Furthermore, degeneracies between galaxy",0.0,0.8529411764705882,0.1470588235294118,17.0,3.0,0.0,0.3267326732673267
surveys (e.g. Ma et al. 2006; Bernstein & Huterer 2010). We there-      type and galaxy redshift can make the aforementioned color-based,0.0,0.8161764705882353,0.18382352941176472,21.0,4.0,0.0,0.3267326732673267
"fore must exploit all data sources that have the potential to break     approach ill-defined. Thus, while template fitting does not require",0.0,0.8273381294964028,0.17266187050359716,21.0,3.0,0.0,0.31188118811881194
"these degeneracies to perform efficient and accurate inference.         spectroscopic data to infer redshifts of galaxies, in practise it is of-",0.0,0.8125,0.1875,20.0,5.0,0.0,0.28712871287128716
"      The two methods available to constrain the redshift of galaxies   ten necessary for building and evaluating models. Finally, empirical",6.0,0.8142857142857143,0.18571428571428572,19.0,2.0,0.0297029702970297,0.306930693069307
in the absence of accurate spectroscopic measurements are ‚Äòtem-         techniques that construct photometric redshift estimates by ‚Äòlearn-,0.0,0.8273381294964028,0.17266187050359716,17.0,5.0,0.0,0.31188118811881194
plate fitting‚Äô methods and empirical methods that ‚Äòlearn‚Äô the map-      ing‚Äô from a spectroscopic calibration dataset require reference data,0.0,0.8357142857142857,0.16428571428571426,19.0,4.0,0.0,0.306930693069307
"ping between photometry and redshift (for a recent review, see          that does not have to spatially overlap, but needs to be representative",0.0,0.7902097902097902,0.2097902097902098,22.0,6.0,0.0,0.2920792079207921
Salvato et al. 2019). SED fitting methods fit the galaxy photome-       in color-redshift space.,0.0,0.8020833333333334,0.19791666666666663,14.0,4.0,0.0,0.5247524752475248
"try with models of the galaxy spectral energy distribution (SED;              Besides spatial correlations of galaxy clustering, we can also",0.0,0.7785714285714286,0.22142857142857142,19.0,8.0,0.0,0.306930693069307
"e.g., Arnouts et al. 1999; Ben√≠tez 2000; Ilbert et al. 2006; Feld-      use other two-point statistics from e.g., weak gravitational lensing",0.0,0.8214285714285714,0.1785714285714286,21.0,4.0,0.0,0.306930693069307
mann et al. 2006; Greisel et al. 2015; Leistedt et al. 2016; Malz &     (e.g. Benjamin et al. 2013; St√∂lzner et al. 2020). There also exists,0.0,0.7928571428571428,0.20714285714285718,26.0,3.0,0.0,0.306930693069307
Hogg 2020). Machine Learning-based methods infer photometric            a considerable literature in how photometric redshift uncertainty,0.0,0.8175182481751825,0.18248175182481752,15.0,7.0,0.0,0.32178217821782173
redshifts by constructing a density estimate for the conditional dis-   can be treated in the individual cosmological probes (McLeod et al.,0.0,0.841726618705036,0.15827338129496404,21.0,2.0,0.0,0.31188118811881194
tribution of the galaxy redshifts given their photometry (Tagliaferri   2017; Hoyle & Rau 2019) or how one can combine template fitting,0.0,0.837037037037037,0.16296296296296298,21.0,2.0,0.0,0.33168316831683164
et al. 2003; Collister & Lahav 2004; Gerdes et al. 2010; Carrasco       and cross correlation measurements (Alarcon et al. 2020b; S√°nchez,0.0,0.8102189781021898,0.1897810218978102,21.0,4.0,0.0,0.32178217821782173
Kind & Brunner 2013; Bonnett 2015; Rau et al. 2015; Hoyle 2016).        & Bernstein 2019; Jones & Heavens 2019; Rau et al. 2020). Shortly,0.0,0.781021897810219,0.21897810218978098,24.0,5.0,0.0,0.32178217821782173
Combinations of both these techniques have also been investigated       before this paper was submitted for publication Myles et al. (2020);,0.0,0.8214285714285714,0.1785714285714286,20.0,4.0,0.0,0.306930693069307
(Speagle & Eisenstein 2015; Hoyle et al. 2015). Unfortunately the       Gatti et al. (2020); Cawthon et al. (2020) presented the redshift,0.0,0.8102189781021898,0.1897810218978102,21.0,4.0,0.0,0.32178217821782173
"accuracy of these techniques is limited since they suffer from differ-  inference scheme for the DES Y3 analyses, that combines a cross-",0.0,0.8382352941176471,0.16176470588235292,22.0,2.0,0.0,0.3267326732673267
ent sources of systematic error. Template fitting approaches can be     correlation and shear ratio data vector with redshift information,0.0,0.8394160583941606,0.16058394160583944,19.0,3.0,0.0,0.32178217821782173
"systematically biased, if fits are constructed using sets of spectral   derived using an empirical mapping of broad band ‚ÄòWide field‚Äô",0.0,0.8421052631578947,0.1578947368421053,20.0,2.0,0.0,0.34158415841584155
energy distributions that are not representative of all galaxies in the photometry to spatially smaller calibration fields with narrow-band,0.0,0.8705035971223022,0.1294964028776978,19.0,1.0,0.0,0.31188118811881194
"sample. In contrast, photometric redshift techniques that require a     photometric and spectroscopic redshift information.",0.0,0.8617886178861789,0.1382113821138211,14.0,3.0,0.0,0.3910891089108911
training set can produce systematically biased results due to incom-          This paper presents a composite likelihood approach to jointly,0.0,0.8071428571428572,0.19285714285714284,19.0,6.0,0.0,0.306930693069307
plete spectroscopic training samples. It is particularly difficult to   constrain photometric redshift distributions using information from,0.0,0.8776978417266187,0.12230215827338131,16.0,2.0,0.0,0.31188118811881194
obtain representative spectroscopic data due to the long exposure       both the available photometry and the clustering of galaxies. We,0.0,0.8235294117647058,0.17647058823529416,19.0,4.0,0.0,0.3267326732673267
"times that are necessary to obtain accurate spectroscopic redshifts     focus on statistical challenges in this inference. In particular, the",0.0,0.8439716312056738,0.15602836879432624,19.0,3.0,0.0,0.301980198019802
for faint sources (see e.g. Huterer et al. 2014; Newman et al. 2015).   parts of the model that utilize the photometry of galaxies can pose,0.0,0.8129496402877698,0.18705035971223016,25.0,2.0,0.0,0.31188118811881194
"      Instead of inferring photometric redshifts by fitting models      computational challenges, since the likelihood depends on mea-",6.0,0.8059701492537313,0.19402985074626866,16.0,4.0,0.0297029702970297,0.3366336633663366
"for the spectral energy distribution, we can also infer photometric     surements of all galaxies in the sample. We therefore derive an effi-",0.0,0.8226950354609929,0.17730496453900713,22.0,3.0,0.0,0.301980198019802
redshift infromation using spatial cross-correlations between pho-      cient methodology that facilitates inference of redshift distributions,0.0,0.8661971830985915,0.1338028169014085,15.0,4.0,0.0,0.29702970297029707
tometric samples and spectroscopic samples (e.g. Newman 2008;           within this computationally expensive part of the model. Redshift,0.0,0.8102189781021898,0.1897810218978102,17.0,6.0,0.0,0.32178217821782173
M√©nard et al. 2013; McQuinn & White 2013; Scottez et al. 2016;          inference based on noisy photometry is an inverse problem and the,0.0,0.7737226277372263,0.22627737226277367,23.0,6.0,0.0,0.32178217821782173
Raccanelli et al. 2017; Morrison et al. 2017; Davis et al. 2017; Gatti  inference scheme requires careful regularization to achieve good,0.0,0.8455882352941176,0.15441176470588236,21.0,2.0,0.0,0.3267326732673267
et al. 2018). Cross-correlation methods measure the spatial cross       probability coverage. We therefore describe several regularization,0.0,0.8478260869565217,0.15217391304347827,16.0,4.0,0.0,0.3168316831683168
correlation between a reference sample with accurate redshift infor-    techniques and evaluate their respective merits in numerical exper-,0.0,0.8561151079136691,0.14388489208633093,18.0,3.0,0.0,0.31188118811881194
"mation, typically spectroscopic galaxy catalogs, and photometric        iments. Information from the spatial distribution of galaxies can",0.0,0.8394160583941606,0.16058394160583944,16.0,5.0,0.0,0.32178217821782173
samples that do not have accurate redshift information. Ignoring        then be incorporated within the composite likelihood framework,0.0,0.8283582089552238,0.17164179104477617,17.0,5.0,0.0,0.3366336633663366
cosmic magnification effects (see e.g. Scranton et al. 2005) the        by efficient MCMC sampling. We test our methodology using data,0.0,0.8059701492537313,0.19402985074626866,20.0,5.0,0.0,0.3366336633663366
expected spatial cross correlation is only nonzero for samples at       from the CosmoDC2 (Korytov et al. 2019) simulated extragalac-,0.0,0.8195488721804511,0.18045112781954886,19.0,4.0,0.0,0.34158415841584155
the same redshift. By cross correlating subsamples of spectroscopic     tic catalog. While some of the inference techniques developed in,0.0,0.8382352941176471,0.16176470588235292,19.0,3.0,0.0,0.3267326732673267
samples that are selected in thin redshift slices with these photomet-  this paper can also be used in the context of an empirical mapping,0.0,0.8260869565217391,0.17391304347826086,24.0,2.0,0.0,0.3168316831683168
"ric catalogs and comparing the resulting signals, we can reconstruct    to a small-area calibration field, our primary goal is to facilitate",0.0,0.8357142857142857,0.16428571428571426,21.0,3.0,0.0,0.306930693069307
the redshift distribution of the unknown photometric sample.            inference using physical SED modelling that utilizes a likelihood,0.0,0.8029197080291971,0.1970802919708029,17.0,7.0,0.0,0.32178217821782173
      It is important to highlight the different sources of systematic  that jointly describes photometry and spatial information for all ob-,6.0,0.8156028368794326,0.18439716312056742,20.0,2.0,0.0297029702970297,0.301980198019802
uncertainty in these two approaches: the measurement of spatial         served galaxies. Inference under spatial variations in photometry or,0.0,0.8214285714285714,0.1785714285714286,18.0,5.0,0.0,0.306930693069307
cross correlations requires that the sample with unknown redshift       redshift information will be addressed in the course of the paper,0.0,0.8175182481751825,0.18248175182481752,20.0,4.0,0.0,0.32178217821782173
information and the reference sample overlap spatially and cover the    and in ¬ß 10.,0.0,0.8095238095238095,0.19047619047619047,14.0,3.0,0.0,0.5841584158415842
"same redshift range. However, the spectroscopic calibration sample            The paper is structured as follows: ¬ß 2 describes the simu-",0.0,0.7883211678832117,0.21167883211678828,19.0,7.0,0.0,0.32178217821782173
"does not have to cover the same color/magnitude space as the un-        lated galaxy samples used in this work, while ¬ß 3 gives a brief",0.0,0.7703703703703704,0.22962962962962963,25.0,5.0,0.0,0.33168316831683164
"known photometric sample. It is, however, important to accurately       introduction into inverse problems and deconvolution by discussing",0.0,0.8405797101449275,0.1594202898550725,17.0,4.0,0.0,0.3168316831683168
model the redshift-dependent galaxy-dark matter bias of the photo-      a simple toy model for photometric redshift inference. The fol-,0.0,0.8296296296296296,0.1703703703703704,19.0,4.0,0.0,0.33168316831683164
"metric sample and the spectroscopic calibration sample, since the       lowing sections describe our inference methodology in detail: ¬ß 4",0.0,0.8248175182481752,0.17518248175182483,19.0,4.0,0.0,0.32178217821782173
"redshift-dependent ratio between these two functions is completely      starts with a description of the photometric likelihood, where we",0.0,0.8394160583941606,0.16058394160583944,18.0,4.0,0.0,0.32178217821782173
"degenerate with the photometric redshift distribution to be inferred.   also discuss several regularization schemes, and ¬ß 5 formulates the",0.0,0.8561151079136691,0.14388489208633093,19.0,2.0,0.0,0.31188118811881194
"                                                                                                                      MNRAS 000, 1‚Äì22 (2015)",118.0,0.1357142857142857,0.8642857142857143,4.0,1.0,0.5841584158415841,0.306930693069307
avr_spaces,2.0923076923076924,1.0,0.0,1.0,1.0,0.01035795887281036,0.9504950495049505
                                                                              Likelihood Inference under Photo-z error                      3,78.0,0.2624113475177305,0.7375886524822695,6.0,12.0,0.38613861386138615,0.301980198019802
"cross-correlation likelihood. Both of these parts are then combined     type/SED and apparent magnitude in the redshift estimation, though",0.0,0.8478260869565217,0.15217391304347827,18.0,3.0,0.0,0.3168316831683168
in a composite likelihood framework in ¬ß 6. ¬ß 7 discusses aspects       we do not employ the prior in this investigation.,0.0,0.7851239669421488,0.2148760330578512,21.0,4.0,0.0,0.400990099009901
of model evaluation and parametrization of systematics. We then               To construct a template set we begin with the empirical SED,0.0,0.7591240875912408,0.24087591240875916,20.0,8.0,0.0,0.32178217821782173
apply our methodology to the simulated data in ¬ß 8. ¬ß 9 summarizes      catalog of Brown et al. (2014). We then use the ESP software pack-,0.0,0.782608695652174,0.21739130434782605,26.0,4.0,0.0,0.3168316831683168
"our findings. ¬ß 10 closes the paper with a discussion of future work.   age (Kalmbach & Connolly 2017), which constructs a principal",0.0,0.8257575757575758,0.1742424242424242,22.0,2.0,0.0,0.3465346534653465
                                                                        component basis set from the empirical SEDs and uses photomet-,72.0,0.39552238805970147,0.6044776119402986,10.0,1.0,0.3564356435643564,0.3366336633663366
                                                                        ric training data to construct the final SED template via Gaussian,72.0,0.4057971014492754,0.5942028985507246,11.0,1.0,0.3564356435643564,0.3168316831683168
                                                                        Processes. The final training set used by BPZ consists of the 129,72.0,0.39416058394160586,0.6058394160583942,12.0,1.0,0.3564356435643564,0.32178217821782173
2    SIMULATED GALAXY SAMPLES                                           empirical templates and 100 additional templates output from ESP.,0.0,0.583941605839416,0.416058394160584,13.0,24.0,0.0,0.32178217821782173
"We use data from the CosmoDC2 simulated extragalactic catalog           These templates roughly, but not perfectly, span the observed range",0.0,0.7985611510791367,0.20143884892086328,19.0,6.0,0.0,0.31188118811881194
(Korytov et al. 2019) in this work. CosmoDC2 is a mock extragalac-      of colors for the sample. We compute the likelihoods for all SEDs by,0.0,0.7928571428571428,0.20714285714285718,25.0,4.0,0.0,0.306930693069307
tic catalog based on a trillion particle N-body simulation with a box   comparing the observed fluxes to model fluxes evaluated on a grid of,0.0,0.8214285714285714,0.1785714285714286,24.0,2.0,0.0,0.306930693069307
"size of 4.225 Gpc3 , the ‚ÄòOuter Rim‚Äô run (Heitmann et al. 2019). The    redshift spanning 0 < ùëß < 3. The 1-dimensional marginalized (over",0.0,0.8029197080291971,0.1970802919708029,25.0,3.0,0.0,0.32178217821782173
simulated catalog covers 440 deg2 of sky area and spans a redshift      template type) posterior distributions for each galaxy comprise our,0.0,0.8201438848920863,0.17985611510791366,21.0,4.0,0.0,0.31188118811881194
range 0 < ùëß ‚â§ 3. Galaxies are assigned to the halo catalog and          final template fitting redshift estimate.,0.0,0.7610619469026548,0.23893805309734517,19.0,6.0,0.0,0.44059405940594054
supplemented with additional galaxies based on the assumption of,0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
a power law extrapolation of a power law sub-halo mass function at      Machine Learning-based Redshifts We use the python version of,0.0,0.8120300751879699,0.18796992481203012,21.0,4.0,0.0,0.34158415841584155
lower masses. The resulting catalog exhibits a number count slope       the publicly available FlexCode2 (Izbicki & Lee 2017) combined,0.0,0.8208955223880597,0.17910447761194026,19.0,4.0,0.0,0.3366336633663366
consistent with that of the Hyper SuprimeCam Deep survey (Aihara        with the XGBoost algorithm (Chen & Guestrin 2016) to compute,0.0,0.803030303030303,0.19696969696969702,20.0,5.0,0.0,0.3465346534653465
"et al. 2018) down to an r-band magnitude of r ‚àº 28, well beyond         photometric redshifts which we will refer to by the name FlexZ-",0.0,0.762962962962963,0.23703703703703705,25.0,5.0,0.0,0.33168316831683164
the apparent magnitudes that will be utilized in this paper. The        Boost. FlexZBoost estimates the conditional density in redshift,0.0,0.8148148148148148,0.18518518518518523,19.0,5.0,0.0,0.33168316831683164
galaxy catalog uses a combination of empirical and semi-analytic        for each galaxy by fitting to an orthonormal set of basis functions,0.0,0.8057553956834532,0.19424460431654678,21.0,5.0,0.0,0.31188118811881194
"modelling, utilizing the Galacticus (Benson 2012) and GalSampler        (in this case cosines) via regression with XGBoost. To further re-",0.0,0.8188405797101449,0.1811594202898551,19.0,5.0,0.0,0.3168316831683168
"codes (Hearin et al. 2020). For more details on the catalog genera-     fine the estimates, 25 per cent of the training data is reserved as",0.0,0.7985611510791367,0.20143884892086328,25.0,3.0,0.0,0.31188118811881194
tion and properties we refer the reader to Korytov et al. (2019).       a validation set to determine optimal values for trimming extrane-,0.0,0.8043478260869565,0.19565217391304346,22.0,4.0,0.0,0.3168316831683168
"      In ¬ß 2.1 we will describe the particular selection of photometric ous low-level peaks in the likelihood, and a ‚Äúsharpening"" parameter",6.0,0.8129496402877698,0.18705035971223016,21.0,1.0,0.0297029702970297,0.31188118811881194
data and the photometric redshift catalog used in this work. ¬ß 2.2      of the form ùëù(ùëß) ‚àù ùëù(ùëß) ùõº that adjusts the overall width of the,0.0,0.7777777777777778,0.2222222222222222,26.0,4.0,0.0,0.33168316831683164
describes the generation of the reference spectroscopic sample.         density estimates to best match the data. For this analysis we use,0.0,0.8043478260869565,0.19565217391304346,20.0,5.0,0.0,0.3168316831683168
"                                                                        35 cosine basis functions, and a sharpening parameter, chosen via",72.0,0.40875912408759124,0.5912408759124088,10.0,1.0,0.3564356435643564,0.32178217821782173
"                                                                        cross-validation, of 1.4. Given the representative training data used",72.0,0.4326241134751773,0.5673758865248226,9.0,1.0,0.3564356435643564,0.301980198019802
"2.1    Photometric Sample and Photometric Redshift Catalog              in this experiment, we expect very accurate redshift estimates from",0.0,0.7697841726618705,0.2302158273381295,17.0,10.0,0.0,0.31188118811881194
                                                                        the FlexZBoost algorithm.,72.0,0.23711340206185566,0.7628865979381443,3.0,1.0,0.3564356435643564,0.5198019801980198
The photometric sample consists of mock galaxies from the LSST-,0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"DESC ‚ÄúCosmoDC2"" synthetic sky catalog (Korytov et al. 2019).",0.0,0.8666666666666667,0.1333333333333333,9.0,1.0,0.0,0.7029702970297029
"The catalogs do not contain stars or AGN, so star-galaxy separation     2.2    Spectroscopic Sample",0.0,0.797979797979798,0.202020202020202,14.0,5.0,0.0,0.5099009900990099
and non-thermal contamination are not an issue in this data set.,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
"                                                                        The simulated reference spectroscopic sample is selected to mimic,",72.0,0.42028985507246375,0.5797101449275363,9.0,1.0,0.3564356435643564,0.3168316831683168
Observations consist of magnitudes in the six ùë¢ùëîùëüùëñùëßùë¶ Rubin Ob-,0.0,0.8548387096774194,0.14516129032258063,10.0,1.0,0.0,0.693069306930693
"                                                                        in broad strokes, the sample selections of the Dark Energy Spec-",72.0,0.39705882352941174,0.6029411764705883,11.0,1.0,0.3564356435643564,0.3267326732673267
servatory filters. Simulated photometric errors were added to the,0.0,0.8769230769230769,0.12307692307692308,9.0,1.0,0.0,0.6782178217821782
"                                                                        trosopic Instrument (DESI, DESI Collaboration et al. 2016, Zhou",72.0,0.4074074074074074,0.5925925925925926,9.0,1.0,0.3564356435643564,0.33168316831683164
six bands using a simple model designed to match the expected,0.0,0.8360655737704918,0.16393442622950816,11.0,1.0,0.0,0.698019801980198
"                                                                        et al. 2020a, Zhou et al. 2020b). This consists of a set of four sam-",72.0,0.3900709219858156,0.6099290780141844,15.0,1.0,0.3564356435643564,0.301980198019802
"photometric S/N due to depth, seeing, airmass, and sky brightness",0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
                                                                        ples with increasing mean redshift: a magnitude-limited sample to,72.0,0.41605839416058393,0.583941605839416,9.0,1.0,0.3564356435643564,0.32178217821782173
at the completion of the full 10-year Wide Fast Deep survey (Iveziƒá,0.0,0.835820895522388,0.16417910447761197,12.0,1.0,0.0,0.6683168316831682
                                                                        ùëü LSST < 19.5; a Luminous Red Galaxy (LRG) sample; an Emis-,72.0,0.366412213740458,0.633587786259542,12.0,1.0,0.3564356435643564,0.35148514851485146
"et al. 2019). All galaxies are assumed to be isolated, i.e. blending",0.0,0.8382352941176471,0.16176470588235292,12.0,1.0,0.0,0.6633663366336633
                                                                        sion Line Galaxy (ELG) sample; and finally a high-redshift Quasar,72.0,0.40875912408759124,0.5912408759124088,10.0,1.0,0.3564356435643564,0.32178217821782173
effects are not modeled. We restrict the sample to galaxies with,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
                                                                        (QSO) sample. We show the redshift and ùëñLSST -band magnitude dis-,72.0,0.40145985401459855,0.5985401459854014,11.0,1.0,0.3564356435643564,0.32178217821782173
an ùëñ LSST -band magnitude of ùëñ LSST < 25.0 that corresponds to a,0.0,0.796875,0.203125,14.0,1.0,0.0,0.6831683168316831
"                                                                        tributions of these subsamples in Fig. 1. The LRG, ELG, and QSO",72.0,0.3851851851851852,0.6148148148148148,12.0,1.0,0.3564356435643564,0.33168316831683164
point source ùëñ LSST -band signal-to-noise (S/N) of ‚àº 20. We make,0.0,0.828125,0.171875,12.0,1.0,0.0,0.6831683168316831
                                                                        samples are selected such that their density per redshift matches,72.0,0.40875912408759124,0.5912408759124088,10.0,1.0,0.3564356435643564,0.32178217821782173
this cut because redshift estimates for lower S/N objects degrade,0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
                                                                        that of the DESI samples (priv. comm. Rongpu Zhou and Jeffrey,72.0,0.38345864661654133,0.6165413533834587,11.0,1.0,0.3564356435643564,0.34158415841584155
rapidly below this S/N level. We reserve a small set of ‚àº 100000,0.0,0.8125,0.1875,13.0,1.0,0.0,0.6831683168316831
                                                                        Newman). This sample is distinct from the redshift calibration data,72.0,0.4172661870503597,0.5827338129496402,10.0,1.0,0.3564356435643564,0.31188118811881194
galaxies for training of the photo-z algorithms; this training set is,0.0,0.855072463768116,0.14492753623188404,11.0,1.0,0.0,0.6584158415841583
                                                                        mentioned in the previous section.,72.0,0.2830188679245283,0.7169811320754718,5.0,1.0,0.3564356435643564,0.4752475247524752
"a random subset of the ùëñ LSST < 25.0 sample, and thus completely",0.0,0.8125,0.1875,13.0,1.0,0.0,0.6831683168316831
"                                                                              We construct a magnitude-limited sample, by imposing a mag-",78.0,0.3722627737226277,0.6277372262773723,9.0,1.0,0.38613861386138615,0.32178217821782173
"representative of the underlying galaxy distribution, so no modeling",0.0,0.8823529411764706,0.11764705882352944,9.0,1.0,0.0,0.6633663366336633
"                                                                        nitude cut of ùëü LSST < 19.5. To approximate the LRG, ELG and QSO",72.0,0.375,0.625,14.0,1.0,0.3564356435643564,0.3267326732673267
of spectroscopic incompleteness effects is necessary.,0.0,0.9056603773584906,0.09433962264150941,6.0,1.0,0.0,0.7376237623762376
"                                                                        galaxy samples, we use the values of the stellar mass, star forma-",72.0,0.39855072463768115,0.6014492753623188,12.0,1.0,0.3564356435643564,0.3168316831683168
"                                                                        tion rate, and black hole mass times Eddington ratio as proxies for",72.0,0.4028776978417266,0.5971223021582734,12.0,1.0,0.3564356435643564,0.31188118811881194
"Template Fitting Redshifts We use the publicly available Bayesian       objects that are LRG, ELG, and QSO-like respectively. Our goal",0.0,0.8208955223880597,0.17910447761194026,19.0,4.0,0.0,0.3366336633663366
photometric redshift code BPZ1 (Ben√≠tez 2000) to compute redshift       with these samples is to select galaxies that will have differing bias,0.0,0.8169014084507042,0.18309859154929575,21.0,4.0,0.0,0.29702970297029707
estimates for our simulated galaxies. BPZ is a template-based red-      properties and mimic the complexities of the DESI sample in this,0.0,0.8161764705882353,0.18382352941176472,21.0,4.0,0.0,0.3267326732673267
"shift estimation code that estimates redshift by computing model        regard, while matching the density and signal-to-noise we would",0.0,0.8222222222222222,0.1777777777777778,18.0,5.0,0.0,0.33168316831683164
fluxes from a set of template SEDs and evaluating the resulting ùúí2      expect with a DESI-like sample. We thus use these simple truth,0.0,0.7985074626865671,0.20149253731343286,23.0,4.0,0.0,0.3366336633663366
when compared to observed fluxes. BPZ includes the optional ap-         quantities from the simulation rather than recreate the full color,0.0,0.8043478260869565,0.19565217391304346,20.0,5.0,0.0,0.3168316831683168
"plication of a bivariate Bayesian prior over the joint distribution of  selection of a true, simulated DESI sample. The QSO, ELG, and",0.0,0.8345864661654135,0.16541353383458646,22.0,2.0,0.0,0.34158415841584155
1  available at: http://www.stsci.edu/~dcoe/BPZ/                        2  available at https://github.com/tpospisi/flexcode,0.0,0.7419354838709677,0.25806451612903225,8.0,15.0,0.0,0.38613861386138615
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,22.10126582278481,1.0,0.0,1.0,1.0,0.10941220704348917,0.9504950495049505
4,0.0,1.0,0.0,1.0,1.0,0.0,0.995049504950495
Figure 1. Left: Redshift probability density functions of the galaxy populations that constitute the DESI-like spectroscopic reference sample. Right:,0.0,0.8791946308724832,0.12080536912751683,19.0,1.0,0.0,0.2623762376237624
Corresponding i-band magnitude distributions.,0.0,0.9333333333333333,0.06666666666666665,4.0,1.0,0.0,0.7772277227722773
"LRG samples are all selected with ùëü LSST > 19.5, to be independent",0.0,0.8181818181818182,0.18181818181818177,13.0,1.0,0.0,0.6732673267326732
"of the magnitude-limited sample. Additionally, QSOs and ELGs are",0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
selected to have ùëü LSST < 23.4 and LRGs have the cut ùëß LSST < 23.0            Zùëù = Z + ùùê .                                                                 (1),0.0,0.3860759493670886,0.6139240506329113,23.0,39.0,0.0,0.2178217821782178
applied to them. QSOs are selected by ordering the candidate QSOs             The probability     densities3   associated with these random variables,0.0,0.7583892617449665,0.24161073825503354,19.0,10.0,0.0,0.2623762376237624
in a redshift bin by the product of their black hole mass and black           are:,0.0,0.7073170731707317,0.29268292682926833,15.0,6.0,0.0,0.594059405940594
"hole Eddington ratio, cutting on the value when the density of QSOs",0.0,0.835820895522388,0.16417910447761197,12.0,1.0,0.0,0.6683168316831682
matches the expected DESI density for a given redshift range. This             ùëç ùëó ‚àº ùëùùëß                                                                    (2),0.0,0.4050632911392405,0.5949367088607596,16.0,41.0,0.0,0.2178217821782178
process is repeated for ELGs using their star formation rate in the              ùëù      ùëù,0.0,0.651685393258427,0.348314606741573,14.0,11.0,0.0,0.5594059405940595
                                                                              ùëçùëó    ‚àº ùëùùëß                                                                   (3),78.0,0.05063291139240506,0.9493670886075949,4.0,36.0,0.38613861386138615,0.2178217821782178
simulation as a proxy for ‚ÄúELG-ness‚Äù. We also impose the condition,0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"that the candidate ELGs have a black hole mass times Eddington                  ùúñ ùëó ‚àº ùëùùúñ ,                                                                 (4)",0.0,0.3860759493670886,0.6139240506329113,17.0,42.0,0.0,0.2178217821782178
"ratio below what we cut on for the QSOs, to assure that the sam-",0.0,0.796875,0.203125,14.0,1.0,0.0,0.6831683168316831
"ples are independent. This process of rank-ordering and selecting             where ùëó ‚àà {1, . . . , ùëÅ gal } and ‚Äò‚àº‚Äô connects the realization of a ran-",0.0,0.74,0.26,28.0,7.0,0.0,0.25742574257425743
the top galaxies until we achieve the expected DESI density is re-            dom variable on the left hand side with the probability density,0.0,0.7659574468085106,0.23404255319148937,23.0,7.0,0.0,0.301980198019802
"peated again for the LRGs, this time with stellar mass as our proxy           function (PDF) on the right hand side from which this realization is",0.0,0.7671232876712328,0.23287671232876717,25.0,6.0,0.0,0.27722772277227725
value. Both the ELG star formation and QSO selection are excluded             drawn.,0.0,0.7261904761904762,0.27380952380952384,12.0,7.0,0.0,0.5841584158415842
"from the LRG selection, ensuring that the samples are independent.                   The random variable ùúñ ùëó is assumed to be identically and in-",0.0,0.7310344827586207,0.2689655172413793,22.0,10.0,0.0,0.2821782178217822
"We calculate values for these cuts on a ‚àº50 deg2 test area in the             dependently distributed, as well as independent of ùëç ùëó . These as-",0.0,0.7430555555555556,0.2569444444444444,26.0,7.0,0.0,0.28712871287128716
"CosmoDC2 simulations and apply them to the full 300 deg2 area.                sumptions do not hold in the photometric redshift scenario, as the",0.0,0.75,0.25,22.0,9.0,0.0,0.28712871287128716
"                                                                              noise very clearly depends on the color, and therefore redshift, of",78.0,0.3931034482758621,0.6068965517241379,11.0,1.0,0.38613861386138615,0.2821782178217822
"                                                                              the galaxy. However, in the following toy model, we adopt these as-",78.0,0.38620689655172413,0.6137931034482759,12.0,1.0,0.38613861386138615,0.2821782178217822
                                                                              sumptions for simplicity. The theory can be easily extended towards,78.0,0.4,0.6,10.0,1.0,0.38613861386138615,0.2821782178217822
3   INTRODUCTION TO DECONVOLUTION PROBLEMS                                    input-dependent noise (see e.g. Meister 2009) without changing the,0.0,0.6527777777777778,0.3472222222222222,14.0,20.0,0.0,0.28712871287128716
                                                                              intuition presented in this section.,78.0,0.2807017543859649,0.7192982456140351,5.0,1.0,0.38613861386138615,0.4356435643564357
"As we will see in detail in the following sections, the photometric                  In order to derive an estimator for ùëù ùëß , we use the convolution",0.0,0.7181208053691275,0.2818791946308725,26.0,10.0,0.0,0.2623762376237624
"redshift problem is a deconvolution problem, where the redshift               theorem4 that connects the PDF of the sum of independent random",0.0,0.7659574468085106,0.23404255319148937,20.0,8.0,0.0,0.301980198019802
distribution of a sample of photometrically observed galaxies is              variables with the convolution of their densities. We can therefore,0.0,0.7862068965517242,0.21379310344827585,19.0,8.0,0.0,0.2821782178217822
inferred from their noisy photometric measurements. To give the               write:,0.0,0.7261904761904762,0.27380952380952384,10.0,8.0,0.0,0.5841584158415842
"reader an intuitive understanding of deconvolution problems, we",0.0,0.8888888888888888,0.11111111111111116,8.0,1.0,0.0,0.6881188118811881
                                                                                                  ‚à´                             ‚à´,98.0,0.015503875968992248,0.9844961240310077,2.0,15.0,0.48514851485148514,0.3613861386138614
present a short introduction into the classical deconvolution prob-              ùëù,0.0,0.7317073170731707,0.2682926829268293,10.0,8.0,0.0,0.594059405940594
"                                                                              ùëùùëß = ùëùùëß ‚àó ùëù ùúñ =         ùëù ùëß (ùëß ùëù ‚àí ùëß) ùëù ùúñ (ùëß)dùëß =      ùëù ùúñ (ùëß ùëù ‚àí ùëß) ùëù ùëß (ùëß) dùëß ,",78.0,0.2578616352201258,0.7421383647798743,28.0,8.0,0.38613861386138615,0.21287128712871284
lem. A similar description in the context of photometric redshift,0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
estimation can be found in Padmanabhan et al. (2005). We close this                                                                                        (5),0.0,0.37341772151898733,0.6265822784810127,13.0,45.0,0.0,0.2178217821782178
section by discussing the limitations of the toy model considered,0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
here and motivate the likelihood inference framework presented in,0.0,0.8769230769230769,0.12307692307692308,9.0,1.0,0.0,0.6782178217821782
the following.                                                                3                                                 ùëù,0.0,0.11627906976744186,0.8837209302325582,4.0,57.0,0.0,0.3613861386138614
                                                                                 Note that the probability densities ùëùùëß and ùëùùëß are both redshift distribu-,81.0,0.4025974025974026,0.5974025974025974,12.0,1.0,0.400990099009901,0.2376237623762376
                                                                                                                                  ùëù,130.0,0.007633587786259542,0.9923664122137404,1.0,1.0,0.6435643564356436,0.35148514851485146
"                                                                              tions of samples of galaxies. They differ since ( ùëùùëß , ùëùùëß ) denotes the sample",78.0,0.40384615384615385,0.5961538461538461,16.0,1.0,0.38613861386138615,0.2277227722772277
"                                                                              distribution of (photometric, true or spectroscopic) galaxy redshifts. Thus",78.0,0.43790849673202614,0.5620915032679739,9.0,1.0,0.38613861386138615,0.24257425742574257
3.1   A Toy Model                                                                ùëù,0.0,0.15853658536585366,0.8414634146341463,5.0,34.0,0.0,0.594059405940594
"                                                                              ùëùùëß would be broader, since the error in the redshift, drawn from ùëù ùúñ , is",78.0,0.3841059602649007,0.6158940397350994,16.0,1.0,0.38613861386138615,0.2524752475247525
                                                                              convolved with the true redshift.,78.0,0.26126126126126126,0.7387387387387387,5.0,1.0,0.38613861386138615,0.45049504950495045
"Consider three vectors of random variables Z, Z ùëù and ùùê with di-              4 A Fourier-based approach is not necessary. Concretely, the likelihood",0.0,0.7651006711409396,0.2348993288590604,23.0,8.0,0.0,0.2623762376237624
"mension ùëÅgal , which denotes the photometric sample size. Z and               framework presented in the following section works in real space. A Fourier",0.0,0.7647058823529411,0.23529411764705888,23.0,8.0,0.0,0.24257425742574257
"Z ùëù denote the true and photometric redshifts of the galaxies in the          description for the classical deconvolution problem is, however, analytically",0.0,0.8064516129032258,0.19354838709677424,22.0,6.0,0.0,0.23267326732673266
sample and ùùê the residual error between both quantities. The addi-            tractable and provides a clear picture of the nature of the problem and the,0.0,0.7712418300653595,0.2287581699346405,25.0,7.0,0.0,0.24257425742574257
tive noise model that connects these random variables is given as:            importance of regularization.,0.0,0.7757009345794392,0.22429906542056077,14.0,7.0,0.0,0.47029702970297027
"                                                                                                                                 MNRAS 000, 1‚Äì22 (2015)",129.0,0.12582781456953643,0.8741721854304636,4.0,1.0,0.6386138613861386,0.2524752475247525
avr_spaces,22.55555555555556,1.0,0.0,1.0,1.0,0.11166116611661168,0.9504950495049505
                                                                                                  Likelihood Inference under Photo-z error                       5,98.0,0.22839506172839505,0.7716049382716049,6.0,12.0,0.48514851485148514,0.19801980198019797
       The Fourier transform of a probability distribution is the char-                    non-vanishing ùêæ ft . The bandwidth parameter governs the tradeoff,7.0,0.7115384615384616,0.28846153846153844,20.0,11.0,0.034653465346534656,0.2277227722772277
"acteristic function. We will denote the characteristic functions of                        between the bias, or ‚Äòsmoothness‚Äô, of the density estimate, and its",0.0,0.7341772151898734,0.26582278481012656,20.0,13.0,0.0,0.2178217821782178
"         ùëù                         p,ft",9.0,0.1282051282051282,0.8717948717948718,2.0,13.0,0.04455445544554455,0.806930693069307
"(ùëù ùëß , ùëù ùëß , ùëù ùúñ ) as (ùëù ftùëß , ùëù ùëß , ùëù ftùúñ ). Given a sample drawn from a PDF,             variance. Choosing a larger bandwidth washes out small scale noise",0.0,0.7006369426751592,0.2993630573248408,36.0,7.0,0.0,0.22277227722772275
"e.g., the sample of photometric redshifts of ùëÅgal galaxies, we can                         in the reconstructed density. In the limit of vanishing bandwidth,",0.0,0.7197452229299363,0.28025477707006374,21.0,13.0,0.0,0.22277227722772275
"               p,ft                                                                        we would again obtain an ill-posed inverse Fourier transformation.",15.0,0.39490445859872614,0.6050955414012739,10.0,37.0,0.07425742574257425,0.22277227722772275
estimate ùëù ùëß          as5,0.0,0.52,0.48,4.0,6.0,0.0,0.8762376237623762
"                                                                                                  In the following sections, we will apply regularization tech-",98.0,0.3333333333333333,0.6666666666666667,9.0,1.0,0.48514851485148514,0.21287128712871284
                        ùëÅgal,24.0,0.14285714285714285,0.8571428571428572,1.0,1.0,0.1188118811881188,0.8613861386138614
"  p,ft            1 ‚àëÔ∏Å               ",2.0,0.21052631578947367,0.7894736842105263,4.0,14.0,0.009900990099009901,0.8118811881188119
                                              ùëù,46.0,0.02127659574468085,0.9787234042553191,1.0,1.0,0.22772277227722773,0.7673267326732673
"                                                                                          niques that restrict the functional form of the redshift distribution,",49.0,0.38509316770186336,0.6149068322981366,11.0,21.0,0.24257425742574257,0.20297029702970293
ùëùÀÜ ùëß (ùë°)   =                    exp ùëñùë°ùëç ùëó .                                            (6) following a similar idea as presented in closed form in Eq. (10) for,0.0,0.46540880503144655,0.5345911949685535,22.0,34.0,0.0,0.21287128712871284
                ùëÅgal,16.0,0.2,0.8,1.0,1.0,0.07920792079207921,0.900990099009901
                         ùëó=1                                                               the classical deconvolution problem.,25.0,0.28346456692913385,0.7165354330708662,5.0,32.0,0.12376237623762376,0.3712871287128713
The argument ùë° of the characteristic function could be interpreted,0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
as a kind of redshift-frequency if we treat the redshift of a galaxy as,0.0,0.8169014084507042,0.18309859154929575,14.0,1.0,0.0,0.6485148514851485
a ‚Äòtime parameter‚Äô. Under the assumption of independence between                           3.2     Towards the Photometric Redshift Problem,0.0,0.6834532374100719,0.3165467625899281,15.0,16.0,0.0,0.31188118811881194
Z and ùúñ we can write:                                                                      We note that inverse problems like the classical deconvolution prob-,0.0,0.4716981132075472,0.5283018867924528,16.0,36.0,0.0,0.21287128712871284
"  p,ft",2.0,0.6666666666666666,0.33333333333333337,1.0,1.0,0.009900990099009901,0.9702970297029703
ùëù ùëß (ùë°)    =   ùëùÀÜftùëß (ùë°) ùëùÀÜftùúñ (ùë°) =   ùëù ftùëß (ùë°) ùëù ftùúñ (ùë°) .                           (7) lem also appear in several other scenarios like the measurements,0.0,0.6193548387096774,0.38064516129032255,27.0,18.0,0.0,0.23267326732673266
"                                                                                           of shapes, where the point-spread function (PSF) of galaxies con-",91.0,0.358974358974359,0.641025641025641,10.0,1.0,0.4504950495049505,0.2277227722772277
Therefore an estimator for                 ùëù ftùëß (ùë°)   is given as:                        volves the galaxies‚Äô light profiles and leads to a loss of information.,0.0,0.6172839506172839,0.3827160493827161,22.0,22.0,0.0,0.19801980198019797
                                 ùëÅ,33.0,0.029411764705882353,0.9705882352941176,1.0,1.0,0.16336633663366337,0.8316831683168316
                                                                                           While the considered toy model of the photometric redshift problem,91.0,0.3630573248407643,0.6369426751592357,10.0,1.0,0.4504950495049505,0.22277227722772275
                                   gal                   ,35.0,0.0847457627118644,0.9152542372881356,3.0,10.0,0.17326732673267325,0.7079207920792079
   ùëìùë°                  1         ‚àëÔ∏Å,3.0,0.14285714285714285,0.8571428571428572,3.0,14.0,0.01485148514851485,0.8267326732673268
"                                                        ùëù                                  is analytically tractable, it does not describe the realistic situation.",56.0,0.39263803680981596,0.6073619631901841,11.0,18.0,0.27722772277227725,0.19306930693069302
"ùëùÀÜ ùëß (ùë°) =                             exp ùëñùë°ùëç ùëó ,                                     (8)",0.0,0.2,0.8,9.0,33.0,0.0,0.5544554455445545
              ùëù ftùúñ (ùë°)ùëÅgal ùëó=1                                                            Besides the relatively simple extension towards a galaxy-dependent,14.0,0.46496815286624205,0.535031847133758,12.0,31.0,0.06930693069306931,0.22277227722772275
"                                                                                           photometric noise, the noise distribution ùëù ùúñ is, in photometric red-",91.0,0.36875,0.63125,11.0,1.0,0.4504950495049505,0.20792079207920788
"where we assume ùëù ftùúñ (ùë°) is known and nonzero everywhere. We note                         shift estimation, given as a joint likelihood between the photometry",0.0,0.710691823899371,0.289308176100629,23.0,13.0,0.0,0.21287128712871284
"that this estimator is consistent and unbiased (Meister 2009). The                         of all galaxies in the sample, that depends on the additional pa-",0.0,0.7115384615384616,0.28846153846153844,22.0,13.0,0.0,0.2277227722772277
error term ùëù ftùúñ (ùë°) here acts as a ‚Äòfilter‚Äô to weight down small scale                    rameters that enter the SED modelling. The redshift of each galaxy,0.0,0.7197452229299363,0.28025477707006374,26.0,11.0,0.0,0.22277227722772275
"modes in the distribution. However, we note that this term 1/ùëù ftùúñ can                     is a parameter that enters its likelihood and the sample redshift",0.0,0.7243589743589743,0.27564102564102566,24.0,11.0,0.0,0.2277227722772277
"become large when ùëù ftùúñ is small.                                                          distribution is its prior. Furthermore, the model does not properly",0.0,0.5379746835443038,0.4620253164556962,17.0,30.0,0.0,0.2178217821782178
       As a consequence the inverse Fourier transform                                      account for the spatial distribution of galaxies. The clustering of,7.0,0.620253164556962,0.379746835443038,17.0,20.0,0.034653465346534656,0.2178217821782178
"                    ‚à´                                                                      galaxies does not only constrain their redshift distribution, but con-",20.0,0.38509316770186336,0.6149068322981366,11.0,36.0,0.09900990099009901,0.20297029702970293
              1                               ùëìùë°,14.0,0.0625,0.9375,2.0,16.0,0.06930693069306931,0.7623762376237624
"ùëù ùëß (ùëß) =               exp (‚àíùëñùë°ùëß) ùëùÀÜ ùëß (ùë°) dùë° ,                                       (9) nects to SED modelling, with nuisance parameters that describe,",0.0,0.5324675324675324,0.4675324675324676,21.0,27.0,0.0,0.2376237623762376
             2ùúã,13.0,0.13333333333333333,0.8666666666666667,1.0,1.0,0.06435643564356436,0.9257425742574258
"                                                                                           e.g., galaxy-dark matter bias.",91.0,0.2231404958677686,0.7768595041322314,4.0,1.0,0.4504950495049505,0.400990099009901
is neither integrable nor square integrable. Loosely speaking this                                We structure the discussion of the likelihoods used in this work,0.0,0.691358024691358,0.308641975308642,20.0,17.0,0.0,0.19801980198019797
implies that the parameter space that describes the shape of ùëù ùëß (ùëß)                       in practice based on the following roadmap: we first describe our,0.0,0.7115384615384616,0.28846153846153844,24.0,12.0,0.0,0.2277227722772277
does not have to be bounded. We will see this effect also for the more                     likelihood framework for the photometry of galaxies given a set of,0.0,0.7133757961783439,0.2866242038216561,26.0,11.0,0.0,0.22277227722772275
complex model considered in the later sections of this work. We                            templates in ¬ß 4. We reiterate that in contrast to the classical de-,0.0,0.6855345911949685,0.3144654088050315,24.0,15.0,0.0,0.21287128712871284
"reiterate that while the estimator of ùëùÀÜftùëß has very desirable properties,                 convolution problem, the ‚Äòerror distribution‚Äô in the full photometric",0.0,0.78125,0.21875,20.0,9.0,0.0,0.20792079207920788
"the inverse transformation is not well defined, hence deconvolution                        redshift problem is based on the joint photometric likelihood. We",0.0,0.7371794871794872,0.2628205128205128,19.0,13.0,0.0,0.2277227722772277
problems are part of a larger class of ‚Äòinverse problems‚Äô.                                 will therefore base our estimator and inference on this likelihood,0.0,0.6751592356687898,0.32484076433121023,20.0,17.0,0.0,0.22277227722772275
"       In order to obtain well-defined results, we therefore have to per-                  instead of the characteristic function. Despite these methodological",7.0,0.7358490566037735,0.26415094339622647,19.0,10.0,0.034653465346534656,0.21287128712871284
"form regularization either by regulating the shape/parametrization                         differences, we note that the necessity for regularization is the same",0.0,0.7453416149068323,0.25465838509316774,18.0,13.0,0.0,0.20297029702970293
       ùëù,7.0,0.125,0.875,1.0,1.0,0.034653465346534656,0.9603960396039604
"of ùëù ùëß (e.g. using Kernel methods), projecting ùëù ùëß onto a suitable                         as in the analytically tractable classical deconvolution problem. The",0.0,0.71875,0.28125,22.0,13.0,0.0,0.20792079207920788
"basis like wavelet functions or by directly restricting the 1/ùëù ftùúñ term,                  considered regularization schemes are described in ¬ß 4.2. A partic-",0.0,0.759493670886076,0.240506329113924,22.0,10.0,0.0,0.2178217821782178
"as implemented in a Ridge method (e.g. Meister 2009, ¬ß 2.2.3).                             ular challenge in the context of large area photometric surveys is",0.0,0.6878980891719745,0.3121019108280255,22.0,15.0,0.0,0.22277227722772275
We will not discuss the details of these methods and refer to the                          the necessity to scale the inference to a large number of galaxies. In,0.0,0.6894409937888198,0.31055900621118016,26.0,14.0,0.0,0.20297029702970293
"literature for a more detailed explanation (e.g. Meister 2009). It is,                     Appendices ¬ß A and ¬ß B we derive an efficient inference framework",0.0,0.7307692307692307,0.2692307692307693,23.0,11.0,0.0,0.2277227722772277
"however, instructive to study the functional form of one of these reg-                     based on the Laplace approximation that facilitates fast probabilistic",0.0,0.7515527950310559,0.24844720496894412,21.0,11.0,0.0,0.20297029702970293
ularized estimators. Making the ansatz of a kernel density estimate                        deconvolution. We will use this deconvolution methodology in the,0.0,0.7354838709677419,0.2645161290322581,19.0,13.0,0.0,0.23267326732673266
"for the photometric redshift PDF, one can show that the deconvolved                        following sections ¬ß 4 to ¬ß 8.",0.0,0.6694214876033058,0.3305785123966942,18.0,13.0,0.0,0.400990099009901
density ùëùÀÜ ùëß can be estimated as (e.g. Meister 2009):,0.0,0.8301886792452831,0.16981132075471694,10.0,1.0,0.0,0.7376237623762376
                    ‚à´                                      !      ùëÅgal,20.0,0.08571428571428572,0.9142857142857143,3.0,23.0,0.09900990099009901,0.6534653465346535
              1                              ùêæ ft (ùë°ùëè)        1 ‚àëÔ∏Å        ,14.0,0.16,0.84,7.0,24.0,0.06930693069306931,0.6287128712871287
                                                                               ùëù,79.0,0.0125,0.9875,1.0,1.0,0.3910891089108911,0.6039603960396039
                                                                                 ,81.0,0.012195121951219513,0.9878048780487805,1.0,1.0,0.400990099009901,0.594059405940594
                                                                                           4     PHOTOMETRIC LIKELIHOOD,91.0,0.18487394957983194,0.8151260504201681,3.0,3.0,0.4504950495049505,0.4108910891089109
"ùëùÀÜ ùëß (ùëß) =              exp (‚àíùëñùë°ùëß)                                     exp ùëñùë°ùëç ùëó dùë° ,",0.0,0.3058823529411765,0.6941176470588235,11.0,26.0,0.0,0.5792079207920793
             2ùúã                                 ùëù ftùúñ (ùë°)    ùëÅgal,13.0,0.2,0.8,5.0,19.0,0.06435643564356436,0.6782178217821782
                                                                  ùëó=1,66.0,0.043478260869565216,0.9565217391304348,1.0,1.0,0.32673267326732675,0.6584158415841583
                                                                                           The spectral energy distributions of distant galaxies are a complex,91.0,0.3670886075949367,0.6329113924050633,10.0,1.0,0.4504950495049505,0.2178217821782178
                                                                                      (10) superposition of spectral components from their stellar populations.,86.0,0.4088050314465409,0.5911949685534591,9.0,1.0,0.42574257425742573,0.21287128712871284
where ùëè denotes the bandwidth and ùêæ ft the fourier transform of                                   The SED of the galaxy can be uniquely mapped to a given,0.0,0.6274509803921569,0.37254901960784315,24.0,18.0,0.0,0.24257425742574257
"the kernel function that enters the kernel density estimation ansatz                       redshift ùëß, which allows us to predict the galaxy flux as a function",0.0,0.7232704402515723,0.2767295597484277,23.0,12.0,0.0,0.21287128712871284
        ùëù,8.0,0.1111111111111111,0.8888888888888888,1.0,1.0,0.039603960396039604,0.9554455445544554
for ùëù ùëß . We see that by restricting the shape of the density ùëù ùëß,0.0,0.7692307692307693,0.23076923076923073,16.0,1.0,0.0,0.6782178217821782
                                                                                         ùëù of redshift in a given optical filter band F (ùúÜ) by,89.0,0.29577464788732394,0.704225352112676,12.0,1.0,0.4405940594059406,0.29702970297029707
                                                                                                        ‚à´,104.0,0.009523809523809525,0.9904761904761905,1.0,1.0,0.5148514851485149,0.4801980198019802
to a kernel density estimate whose smoothness is governed by the,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
"parameter ùëè, we regularize the 1/ùëù ftùúñ (ùë°) term by a multiplicative fac-                    ùëìùëñ (ùëß, ùõº) =    F (ùúÜ) SEDùúÜ (ùúÜ, ùëß, ùõº) dùúÜ .                           (11)",0.0,0.5521472392638037,0.4478527607361963,26.0,26.0,0.0,0.19306930693069302
"tor, that renders the inverse Fourier transformation both integrable",0.0,0.8823529411764706,0.11764705882352944,9.0,1.0,0.0,0.6633663366336633
"                                                                                           where SEDùúÜ (ùúÜ,         is",91.0,0.1282051282051282,0.8717948717948718,5.0,5.0,0.4504950495049505,0.42079207920792083
"                                                                                                            ùëß, ùõº)   the Spectral Energy Distribution template",107.0,0.27044025157232704,0.729559748427673,9.0,2.0,0.5297029702970297,0.21287128712871284
"and square integrable assuming bounded, compactly supported and",0.0,0.8888888888888888,0.11111111111111116,8.0,1.0,0.0,0.6881188118811881
                                                                                           in units of erg cm2 s √Ö. The parameter ùõº denotes additional free,91.0,0.33548387096774196,0.6645161290322581,13.0,1.0,0.4504950495049505,0.23267326732673266
"                                                                                           parameters in the SED template models, such as galaxy age, type, or",91.0,0.35443037974683544,0.6455696202531646,12.0,1.0,0.4504950495049505,0.2178217821782178
"5   Here,ÀÜdenotes an estimator for the respective function.                                red continuum slope. For a given set of photometric filters F (ùúÜ) we",0.0,0.6666666666666666,0.33333333333333337,21.0,18.0,0.0,0.21287128712871284
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,23.43820224719101,1.0,0.0,1.0,1.0,0.11603070419401491,0.9504950495049505
6,0.0,1.0,0.0,1.0,1.0,0.0,0.995049504950495
                                                                                     redshift bins. The vector œÄ ùë© has the properties ùëñ=1,85.0,0.31386861313868614,0.6861313868613139,10.0,1.0,0.4207920792079208,0.32178217821782173
                                                                                                                                                √ç ùëÅtot ùêµ,144.0,0.039473684210526314,0.9605263157894737,3.0,1.0,0.7128712871287128,0.24752475247524752
obtain a mapping between the redshift ùëß of the galaxy and a vector                                                                                      ùúãùëñ = 1 and,0.0,0.3765432098765432,0.6234567901234568,17.0,44.0,0.0,0.19801980198019797
"of fluxes f. We will denote this mapping as T (ùëß, ùõº).                                0 ‚â§ ùúãùëñùêµ ‚â§ 1, and therefore lies on the simplex. Our first choice",0.0,0.6241610738255033,0.37583892617449666,26.0,17.0,0.0,0.2623762376237624
       Assuming that the measurements of photometry for different                    for a distribution on the simplex for ùëù(ùùÖ ùë© ) (and therefore ùëù(n ùêµ )),7.0,0.6883116883116883,0.3116883116883117,23.0,11.0,0.034653465346534656,0.2376237623762376
galaxies are independent6 we can make the ansatz for the joint                       was the Dirichlet distribution7 . During the course of this project we,0.0,0.7161290322580646,0.28387096774193543,23.0,12.0,0.0,0.23267326732673266
likelihood of fluxes of a galaxy sample FÃÇ                                           have applied a mean field variational inference scheme that uses the,0.0,0.6078431372549019,0.3921568627450981,19.0,22.0,0.0,0.24257425742574257
               ùëÅgal,15.0,0.21052631578947367,0.7894736842105263,1.0,1.0,0.07425742574257425,0.905940594059406
               √ñ                                                                     Dirichlet as the variational distribution as well as a Gibbs sampling,15.0,0.38961038961038963,0.6103896103896104,12.0,35.0,0.07425742574257425,0.2376237623762376
"ùëù( FÃÇ|z, ùú∂) =       N ( fÃÇi |T (ùëß ùëñ , ùõºùëñ ), ùö∫ùëñ ) .                              (12) scheme based on the Dirichlet-Multinomial cojugacy for posterior",0.0,0.6040268456375839,0.3959731543624161,25.0,19.0,0.0,0.2623762376237624
               ùëñ=1                                                                   inference. We found that the variational inference scheme yielded,15.0,0.4,0.6,10.0,34.0,0.07425742574257425,0.25742574257425743
"Here, ùö∫ùíä denotes the measurement covariance matrix of the flux                       underestimated error bars, likely due to the restricted covariance",0.0,0.7350993377483444,0.26490066225165565,19.0,12.0,0.0,0.2524752475247525
"measurements fÃÇi , and FÃÇ denotes the set of all flux measurements                   structure of the dirichlet. Moreover, the sampling approach did not",0.0,0.743421052631579,0.256578947368421,22.0,10.0,0.0,0.24752475247524752
"of the galaxies. We assume Gaussian uncertainties here, where                        scale well to the large galaxy samples expected for the first-year",0.0,0.7218543046357616,0.2781456953642384,20.0,13.0,0.0,0.2524752475247525
"N (ùë•, ùúá, Œ£) denotes the Normal distribution. The parameter ùõº can                     LSST observations. Specifically, the computational workload to up-",0.0,0.7417218543046358,0.2582781456953642,20.0,11.0,0.0,0.2524752475247525
"either be a galaxy-specific index that selects a certain template from               date redshift variables for 106 ‚àí 1010 galaxies seems very large, and",0.0,0.7662337662337663,0.23376623376623373,23.0,8.0,0.0,0.2376237623762376
"a pre-specified number of models, or a physical property of galaxies.                while subsampling techniques provide a possible mitigation, they",0.0,0.7785234899328859,0.2214765100671141,19.0,9.0,0.0,0.2623762376237624
       The prior on the parameters ùëß and ùõº must account for their                    can lead to biased inferences (Quiroz et al. 2018). Furthermore the,7.0,0.6842105263157895,0.3157894736842105,23.0,11.0,0.034653465346534656,0.24752475247524752
correlation. An example for a possible parametrization in the case                   application of sampling techniques requires a sufficiently large trace,0.0,0.7677419354838709,0.23225806451612907,19.0,10.0,0.0,0.23267326732673266
of a galaxy-specific template index would be a two-dimensional                       to ensure convergence. This can be difficult to ensure in this case.,0.0,0.7254901960784313,0.27450980392156865,21.0,12.0,0.0,0.24257425742574257
"histogram. However, other parametrizations are possible, especially                  In order to provide a more flexible distributional ansatz than the",0.0,0.7748344370860927,0.22516556291390732,18.0,10.0,0.0,0.2524752475247525
"if additional parameters that change the shape of the base templates                 dirichlet, while still maintaining the computational advantages of",0.0,0.7748344370860927,0.22516556291390732,19.0,9.0,0.0,0.2524752475247525
"are included in the template set. In this work, we will consider the                 a mean field variational inference scheme, we decided to develop",0.0,0.7449664429530202,0.25503355704697983,23.0,9.0,0.0,0.2623762376237624
"simplest case, where we use a multidimensional histogram prior                       a scheme that is based on the logit-normal distribution (Atchison",0.0,0.7333333333333333,0.2666666666666667,19.0,12.0,0.0,0.25742574257425743
"where each histogram cell denotes a combination of redshift bin                      & Shen 1980), as explained in the following section. While these",0.0,0.7248322147651006,0.2751677852348994,21.0,12.0,0.0,0.2623762376237624
"and discretized ùõº parameter value, that for example could indicate                   considerations motivate our choice of method, we note that this",0.0,0.75,0.25,20.0,10.0,0.0,0.26732673267326734
a template selection. The histogram index ùëñ runs over all histogram                  should not discredit alternative approaches based on sampling or,0.0,0.7583892617449665,0.24161073825503354,20.0,10.0,0.0,0.2623762376237624
"bins {ùëñ : 0 < ùëñ ‚â§ ùëÅtot }, where ùëÅtot = ùëÅbins √ó ùëÅparameters . The                     variational inference in general. We will perform a more detailed",0.0,0.6933333333333334,0.30666666666666664,27.0,11.0,0.0,0.25742574257425743
"prior on the corresponding histogram heights, denoted as ùëõùëñùêµ cor-                    analysis of convergence and probability coverage of multiple infer-",0.0,0.756578947368421,0.24342105263157898,19.0,11.0,0.0,0.24752475247524752
"responding to the interval ùêºùëñ in the ùëß ‚àí ùõº parameter space, reads:                   ence techniques in future work.",0.0,0.6982758620689655,0.3017241379310345,18.0,10.0,0.0,0.4257425742574258
            ùëÅtot,12.0,0.25,0.75,1.0,1.0,0.0594059405940594,0.9207920792079208
            ‚àëÔ∏Å                                                                       4.1    Photometric Redshift inference,12.0,0.27049180327868855,0.7295081967213115,5.0,38.0,0.0594059405940594,0.39603960396039606
"ùëù(ùëß, ùõº) =        ùëõùëñùêµ [(ùëß, ùõº) ‚àà ùêºùëñ ] .                                           (13)",0.0,0.2976190476190476,0.7023809523809523,11.0,26.0,0.0,0.5841584158415842
            ùëñ=1                                                                      The problem specified by Eq. (14) is a deconvolution problem that,12.0,0.38666666666666666,0.6133333333333333,12.0,36.0,0.0594059405940594,0.25742574257425743
"Here [ùêæ] denotes the Iverson bracket, that is (0, 1) if the proposition              extends the simple toy model considered in ¬ß 3. The ‚Äònoise‚Äô PDF is",0.0,0.7483443708609272,0.2516556291390728,26.0,8.0,0.0,0.2524752475247525
"ùêæ is (false, true). We note that nB parametrizes the joint distribution              now given by a joint likelihood that can depend on a complex set",0.0,0.7516778523489933,0.24832214765100669,25.0,8.0,0.0,0.2623762376237624
"of redshift histograms and ùú∂ parameter. For simplicity we will in                    of parameters. Furthermore, while the discussion in ¬ß 3 focused on",0.0,0.7350993377483444,0.26490066225165565,22.0,11.0,0.0,0.2524752475247525
"the following omit the marginalization over ùú∂ and refer to nB as the                 deriving an estimator for the deconvolved density, the focus here is",0.0,0.7450980392156863,0.2549019607843137,24.0,9.0,0.0,0.24257425742574257
parameters of the sample redshift distribution. The reason is that in                to infer posteriors using efficient inference techniques. We present,0.0,0.7777777777777778,0.2222222222222222,20.0,9.0,0.0,0.24257425742574257
this paper we do not add additional parameters to parametrize the                    the detailed description and derivation of the inference pipeline in,0.0,0.7450980392156863,0.2549019607843137,21.0,11.0,0.0,0.24257425742574257
SEDs over which we need to marginalize. In applications like weak                    Appendices A and B. The final form of Eq. (14) is then given in the,0.0,0.7105263157894737,0.2894736842105263,26.0,11.0,0.0,0.24752475247524752
gravitational lensing and galaxy clustering we are mainly interested                 form of a logit-normal posterior:,0.0,0.7542372881355932,0.2457627118644068,14.0,9.0,0.0,0.4158415841584159
"in estimating the redshift distribution of a sample of galaxies, here",0.0,0.855072463768116,0.14492753623188404,11.0,1.0,0.0,0.6584158415841583
                                                                                                        1                1,104.0,0.01639344262295082,0.9836065573770492,2.0,9.0,0.5148514851485149,0.39603960396039606
referred to as the base sample and parametrized by the vector nB .                   ùëù(nB | FÃÇ) ‚âà ‚àöÔ∏Å                    √é ùëÅbins ùêµ,0.0,0.5581395348837209,0.4418604651162791,21.0,20.0,0.0,0.3613861386138614
It is therefore useful to marginalize over the redshifts of individual                               |2ùúãùö∫y | Œîùëß ùëÅbins             ùëõùëñ,0.0,0.5681818181818182,0.43181818181818177,16.0,22.0,0.0,0.3465346534653465
                                                                                                                           ùëñ=1,123.0,0.023809523809523808,0.9761904761904762,1.0,1.0,0.6089108910891089,0.37623762376237624
                                                                                                                    !            !                         !         !!,116.0,0.029940119760479042,0.9700598802395209,4.0,23.0,0.5742574257425742,0.1732673267326733
galaxies. We note that if the posterior of individual galaxy redshifts,0.0,0.8571428571428571,0.1428571428571429,11.0,1.0,0.0,0.6534653465346535
                                                                                              1          ùíè ùë© ‚àíNbins                  ‚àí1         ùíè ùë© ‚àíNbins,94.0,0.12337662337662338,0.8766233766233766,8.0,19.0,0.46534653465346537,0.2376237623762376
"is important, we can always post-sample using the final posterior                     exp ‚àí log                       ‚àí ùùÅy,ML ùö∫y log                         ‚àí ùùÅy,ML ,",0.0,0.4879518072289157,0.5120481927710843,20.0,34.0,0.0,0.17821782178217827
"on nB , based on Eq. (34), that then also includes information from",0.0,0.8208955223880597,0.17910447761194026,13.0,1.0,0.0,0.6683168316831682
                                                                                              2            ùëõùêµ,94.0,0.027522935779816515,0.9724770642201834,2.0,7.0,0.46534653465346537,0.46039603960396036
                                                                                                            ùëÅ                                     ùëõùêµùëÅ,108.0,0.026845637583892617,0.9731543624161074,2.0,19.0,0.5346534653465347,0.2623762376237624
                                                                                                              bins                                   bins,110.0,0.05228758169934641,0.9477124183006536,2.0,18.0,0.5445544554455446,0.24257425742574257
galaxy clustering. The posterior distribution of the sample redshift                                                                                            (16),0.0,0.3902439024390244,0.6097560975609756,10.0,47.0,0.0,0.18811881188118806
distribution given FÃÇ is then:,0.0,0.8666666666666667,0.1333333333333333,5.0,1.0,0.0,0.8514851485148515
                                                                                     where Œîùëß denotes the histogram bin width. The estimation of the,85.0,0.3581081081081081,0.6418918918918919,11.0,1.0,0.4207920792079208,0.26732673267326734
                      ùëÅgal ‚à´ ‚àû,22.0,0.2,0.8,3.0,1.0,0.10891089108910891,0.8514851485148515
"                      √ñ                                                              covariance ùö∫y and mean vector ùùÅy,ML are detailed in Appendices",22.0,0.3673469387755102,0.6326530612244898,11.0,32.0,0.10891089108910891,0.2722772277227723
"ùëù(nB | FÃÇ) ‚àù ùëù(nB )                  dùëß ùëñ ùëù(ùëß ùëñ |nB ) N ( fÃÇi |T (ùëß ùëñ ), Œ£ùëñ ) . (14) A and B. However, we note that this formalism derives the hessian",0.0,0.66,0.33999999999999997,35.0,10.0,0.0,0.25742574257425743
                              0,30.0,0.03225806451612903,0.967741935483871,1.0,1.0,0.1485148514851485,0.8465346534653465
                      ùëñ=1                                                            H = ‚àíùö∫ùíö ‚àí1 and obtaining the covariance matrix ùö∫ùíö requires matrix,22.0,0.38,0.62,13.0,31.0,0.10891089108910891,0.25742574257425743
       Discretizing the integral and using Eq. (13) we obtain                        inversion. The subscript ‚Äòy‚Äô here refers to the variable transforma-,7.0,0.6862745098039216,0.3137254901960784,19.0,13.0,0.034653465346534656,0.24257425742574257
                      ùëÅgal ‚àëÔ∏ÅùëÅtot      ‚à´ ùëßùëó                                          tion:,22.0,0.2,0.8,5.0,25.0,0.10891089108910891,0.5544554455445545
                      √ñ                      ùëÖ,22.0,0.043478260869565216,0.9565217391304348,2.0,12.0,0.10891089108910891,0.7722772277227723
"ùëù(nB | FÃÇ) ‚àù ùëù(nB )               ùëõBùëó          dùëß ùëñ ùëù( fÃÇi |T (ùëß ùëñ ), Œ£ùëñ ) .",0.0,0.47368421052631576,0.5263157894736843,18.0,13.0,0.0,0.6237623762376238
                                                                                                                                                  ,94.0,0.013513513513513514,0.9864864864864865,2.0,27.0,0.46534653465346537,0.26732673267326734
                                           ùëó,43.0,0.022727272727272728,0.9772727272727273,1.0,1.0,0.21287128712871287,0.7821782178217822
"                                                                                (15) y(ùùÖ) = log (ùúã1 /ùúã ùëÅbins ), . . . , log (ùúã ùëÅbins ‚àí1 /ùúã ùëÅbins ) ,            (17)",80.0,0.3231707317073171,0.6768292682926829,21.0,7.0,0.39603960396039606,0.18811881188118806
                      ùëñ=1 ùëó=1            ùëßùêø,22.0,0.18604651162790697,0.813953488372093,3.0,7.0,0.10891089108910891,0.7871287128712872
                                             ,45.0,0.021739130434782608,0.9782608695652174,1.0,1.0,0.22277227722772278,0.7722772277227723
 The histogram heights ùëõùëñùêµ = ùúãùëñùêµ Œîùëß can be expressed as the ra-,1.0,0.7936507936507936,0.2063492063492064,13.0,1.0,0.0049504950495049506,0.6881188118811881
                                                                                     7,85.0,0.011627906976744186,0.9883720930232558,1.0,1.0,0.4207920792079208,0.5742574257425743
"tio between œÄ and the histogram width Œîùëß, assuming equal-sized                          The Dirichlet is the conjugate prior to the multinominal distribution, which",0.0,0.725609756097561,0.27439024390243905,21.0,14.0,0.0,0.18811881188118806
"                                                                                     can make sampling and inference easier. Concretely, if a Dirichlet prior is set",85.0,0.40853658536585363,0.5914634146341464,13.0,1.0,0.4207920792079208,0.18811881188118806
"                                                                                     on the probabilities of the multinomial likelihood (which are its parameters),",85.0,0.4171779141104294,0.5828220858895705,11.0,1.0,0.4207920792079208,0.19306930693069302
6  This assumption can be violated due to effects such as blending of nearby         the posterior over these probabilities is again a Dirichlet. However conjugacy,0.0,0.7975460122699386,0.2024539877300614,25.0,6.0,0.0,0.19306930693069302
galaxy light profiles on flux calibration errors..                                   does not imply that the prior is ideal in all circumstances.,0.0,0.6482758620689655,0.3517241379310345,18.0,18.0,0.0,0.2821782178217822
"                                                                                                                                         MNRAS 000, 1‚Äì22 (2015)",137.0,0.11949685534591195,0.8805031446540881,4.0,1.0,0.6782178217821783,0.21287128712871284
avr_spaces,24.170731707317078,1.0,0.0,1.0,1.0,0.11965708765998553,0.9504950495049505
                                                                                                        Likelihood Inference under Photo-z error                                                   7,104.0,0.18877551020408162,0.8112244897959184,6.0,26.0,0.5148514851485149,0.02970297029702973
that we discuss in more detail in Appendix B. The vector nB ‚àíùëÅbins                                                                  1.4                                        True Distribution,0.0,0.3802083333333333,0.6197916666666667,16.0,54.0,0.0,0.04950495049504955
denotes here the vector of nB excluding the last entry ùëõN,0.0,0.8245614035087719,0.17543859649122806,11.0,1.0,0.0,0.7178217821782178
                                                                                      Sample Photometric Redshift Distribution nB,86.0,0.3023255813953488,0.6976744186046512,5.0,1.0,0.42574257425742573,0.3613861386138614
"                                                           ùêµ , where",59.0,0.10294117647058823,0.8970588235294118,3.0,1.0,0.29207920792079206,0.6633663366336633
                                                                                                                                                                               Fiducial,175.0,0.04371584699453552,0.9562841530054644,1.0,1.0,0.8663366336633663,0.09405940594059403
we assume equal sized redshift histogram bin width.,0.0,0.8627450980392157,0.13725490196078427,8.0,1.0,0.0,0.7475247524752475
                                                             bins,61.0,0.06153846153846154,0.9384615384615385,1.0,1.0,0.30198019801980197,0.6782178217821782
                                                                                                                                    1.2                                        Merging Bin,132.0,0.06989247311827956,0.9301075268817205,3.0,21.0,0.6534653465346535,0.07920792079207917
"     Like the classical deconvolution problem, the inference of",5.0,0.8095238095238095,0.19047619047619047,8.0,1.0,0.024752475247524754,0.6881188118811881
                                                                                                                                    1.0,132.0,0.022222222222222223,0.9777777777777777,1.0,1.0,0.6534653465346535,0.33168316831683164
Eq. (14) is an inverse problem. We can therefore expect that there,0.0,0.8333333333333334,0.16666666666666663,12.0,1.0,0.0,0.6732673267326732
"exists a parameter vector ùùÖ ‚àà Œî, where Œî denotes the simplex                                                                        0.8",0.0,0.3851851851851852,0.6148148148148148,13.0,37.0,0.0,0.33168316831683164
"space, that has a high likelihood (relative to the maximum likeli-",0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"hood value), but a large distance from the true ùùÖ opt .                                                                             0.6",0.0,0.34814814814814815,0.6518518518518519,13.0,39.0,0.0,0.33168316831683164
"     Furthermore, as we have seen in ¬ß 3, the solutions of inverse",5.0,0.7575757575757576,0.24242424242424243,12.0,1.0,0.024752475247524754,0.6732673267326732
"problems do not have to be bounded8 (or even well defined), which                                                                   0.4",0.0,0.4222222222222222,0.5777777777777777,13.0,34.0,0.0,0.33168316831683164
"implies that uncertainties can be arbitrarily large (see, e.g., Kuusela                                                             0.2",0.0,0.48148148148148145,0.5185185185185186,11.0,31.0,0.0,0.33168316831683164
"2016). Regularization, detailed in the following section, is therefore",0.0,0.8857142857142857,0.11428571428571432,9.0,1.0,0.0,0.6534653465346535
a key aspect in our inference pipeline.                                                                                             0.0,0.0,0.26666666666666666,0.7333333333333334,8.0,47.0,0.0,0.33168316831683164
                                                                                                                                          0.0   0.5   1.0      1.5       2.0      2.5        3.0,138.0,0.109375,0.890625,7.0,16.0,0.6831683168316832,0.04950495049504955
                                                                                                                                                            Redshift z,156.0,0.05421686746987952,0.9457831325301205,2.0,1.0,0.7722772277227723,0.17821782178217827
4.2     Regularization                                                            Figure 2. Illustration of the impact of the ‚ÄòMerging Bin‚Äô regularization,0.0,0.512987012987013,0.487012987012987,13.0,33.0,0.0,0.2376237623762376
                                                                                  on the posterior of the sample photometric redshift distribution. We show,82.0,0.4064516129032258,0.5935483870967742,11.0,1.0,0.40594059405940597,0.23267326732673266
"In this section we describe techniques that we employ to regularize9              1ùúé intervals. The x-axis shows the redshift value ùëß, the y-axis the value of",0.0,0.7658227848101266,0.23417721518987344,25.0,8.0,0.0,0.2178217821782178
"the deconvolution problem. As instabilities arise when the histogram              the nB parameters. The errorbars are the [16, 84] percentiles, which would",0.0,0.7884615384615384,0.21153846153846156,21.0,8.0,0.0,0.2277227722772277
width is of the same order as the uncertainty in the redshift of the              correspond to 1ùúé intervals for a normal distribution. The black dashed,0.0,0.756578947368421,0.24342105263157898,25.0,8.0,0.0,0.24752475247524752
"individual galaxies, picking broader bins reduces these artifacts                 curve shows the spectroscopic redshift distribution. The red contour shows",0.0,0.7884615384615384,0.21153846153846156,18.0,9.0,0.0,0.2277227722772277
"(see e.g. Kuusela 2016). Considering our toy model in Eq. (10), we                the result of the ‚ÄòMerging Bin‚Äô regularization with 30 bins applied to the",0.0,0.75,0.25,25.0,9.0,0.0,0.2277227722772277
"see that if ùêæ ft (ùë°ùëè) is narrower than ùëù ftùúñ (ùë°), there can be values of ùë°        ‚ÄòFiducial‚Äô contours that are binned using 50 bins. We refer for a detailed",0.0,0.7628205128205128,0.23717948717948723,31.0,5.0,0.0,0.2277227722772277
"where their ratio, and therefore the integrand in Eq. (10), can become            explanation to ¬ß 8 and Fig. 7, which shows and discusses the ‚ÄòFiducial‚Äô case",0.0,0.7721518987341772,0.22784810126582278,26.0,7.0,0.0,0.2178217821782178
                                                                                  as ‚ÄòSmall Sample (50k)‚Äô.,82.0,0.19811320754716982,0.8018867924528301,4.0,1.0,0.40594059405940597,0.4752475247524752
"large or even unbounded. Subject to the aforementioned limitations,",0.0,0.8805970149253731,0.11940298507462688,9.0,1.0,0.0,0.6683168316831682
this behaviour generalizes to the deconvolution problem considered,0.0,0.8939393939393939,0.10606060606060608,8.0,1.0,0.0,0.6732673267326732
"here. In the following, we will denote this scheme as the ‚ÄòWide                   absolute values) in its inverse. As a regularization, one can add a",0.0,0.7248322147651006,0.2751677852348994,24.0,10.0,0.0,0.2623762376237624
"Bin‚Äô method. As will be seen in the following section, this simple                penalty term and reformulate the problem as a minimization",0.0,0.75,0.25,21.0,9.0,0.0,0.306930693069307
scheme can lead to posteriors that can be biased and too narrow. We                   n                             o,0.0,0.48717948717948717,0.5128205128205128,15.0,24.0,0.0,0.42079207920792083
"therefore consider alternative approaches.                                        min ||Haùëñ ‚àí 1ùëñ || 22 + ||ùöºaùëñ || 22 ,                           (18)",0.0,0.46308724832214765,0.5369127516778524,16.0,34.0,0.0,0.2623762376237624
                                                                                  where ùëñ denotes column ùëñ of the inverse hessian and the unit matrix,82.0,0.3691275167785235,0.6308724832214765,13.0,1.0,0.40594059405940597,0.2623762376237624
"                                                                                  respectively. The matrix ùöº = ùõº1 is the Tikhonov matrix, ùõº the",82.0,0.34965034965034963,0.6503496503496504,12.0,1.0,0.40594059405940597,0.2920792079207921
4.2.1    Merging Bin Regularization                                               regularization parameter and 1 the unit matrix. The regularization,0.0,0.5878378378378378,0.41216216216216217,13.0,26.0,0.0,0.26732673267326734
"The ‚ÄòMerging Bin Regularization‚Äô scheme (Kuusela 2016) uses a                     term penalizes large values for ai , which regularizes the inversion",0.0,0.74,0.26,20.0,11.0,0.0,0.25742574257425743
very thin initial histogram binning. This will likely result in the               and reduces the condition number. The analytic solution to this,0.0,0.7655172413793103,0.23448275862068968,21.0,8.0,0.0,0.2821782178217822
"aforementioned typical instabilities of inverse problems, but can                 minimization problem is given as:",0.0,0.7565217391304347,0.24347826086956526,13.0,9.0,0.0,0.43069306930693074
avoid biases of the Wide-Bin regularization (or other smoothing)                                     ‚àí1,0.0,0.5714285714285714,0.4285714285714286,12.0,18.0,0.0,0.4801980198019802
"schemes. However, we must ensure that the optimization of the                     cùëñ = HT H + ùöºT ùöº        HT 1i .                                 (19)",0.0,0.47333333333333333,0.5266666666666666,21.0,31.0,0.0,0.25742574257425743
maximum-likelihood solution converges to a global maximum. We                           We note that we introduce the Tikhonov regularization here,0.0,0.7123287671232876,0.28767123287671237,17.0,14.0,0.0,0.27722772277227725
therefore run multiple optimizations with different initial conditions            predominantly as a way to regularize the matrix inversion of the,0.0,0.8013698630136986,0.1986301369863014,19.0,7.0,0.0,0.27722772277227725
"and pick the best solution. Furthermore, the hessian H can have a                 hessian. We recommend selecting the parameter ùõº to be just as large",0.0,0.738255033557047,0.261744966442953,24.0,9.0,0.0,0.2623762376237624
very high condition number. Even though it is possible to sam-                    as necessary to perform this inversion accurately. Tikhonov regular-,0.0,0.7466666666666667,0.2533333333333333,20.0,11.0,0.0,0.25742574257425743
ple from the resulting posteriors without the matrix inverse using                ization can be used as the main regularization in inverse problems;,0.0,0.7651006711409396,0.2348993288590604,21.0,9.0,0.0,0.2623762376237624
"MCMC sampling (only the inverse covariance enters the ùúí2 ), sam-                  however, we find that the merging bin regularization scheme per-",0.0,0.7465753424657534,0.2534246575342466,21.0,10.0,0.0,0.27722772277227725
pling is more efficient using the standard Box-Mueller method (Box                forms much better in terms of producing well-calibrated probability,0.0,0.7785234899328859,0.2214765100671141,19.0,9.0,0.0,0.2623762376237624
"& Muller 1958), which requires an inverse.                                        nB posteriors. We reiterate that the idea of the merging bin reg-",0.0,0.6122448979591837,0.3877551020408163,19.0,21.0,0.0,0.2722772277227723
                                                                                  ularization scheme proposed by Kuusela (2016) is to deliberately,82.0,0.3835616438356164,0.6164383561643836,9.0,1.0,0.40594059405940597,0.27722772277227725
Tikhonov Regularization We perform the matrix inversion of the                    start with histogram bins that are too small and lead to a noisy de-,0.0,0.7266666666666667,0.2733333333333333,23.0,11.0,0.0,0.25742574257425743
"hessian H using Tikhonov regularization (see e.g. Kress 1998, pp.                 convolved density. We then exploit the characteristic noise pattern",0.0,0.7718120805369127,0.22818791946308725,19.0,9.0,0.0,0.2623762376237624
"86-90). Here, we treat the matrix inversion as a system of linear                 in the deconvolved distribution, where bins that overshoot, i.e. are",0.0,0.7533333333333333,0.2466666666666667,22.0,9.0,0.0,0.25742574257425743
"equations constructed from the hessian and the column-wise inverse                larger than the true value, are immediately followed by those that",0.0,0.7702702702702703,0.22972972972972971,20.0,9.0,0.0,0.26732673267326734
hessian/unit matrix respectively. The instability of the problem can              undershoot. This results in an alternating or ‚Äòzig-zag‚Äô pattern of the,0.0,0.7894736842105263,0.21052631578947367,20.0,8.0,0.0,0.24752475247524752
lead to very small entries in the hessian that imply large entries (in            deconvolved density. Merging these neighboring bins then helps to,0.0,0.782312925170068,0.217687074829932,22.0,7.0,0.0,0.2722772277227723
                                                                                  ‚Äòstabilize‚Äô the deconvolved distribution. We therefore sample from,82.0,0.39864864864864863,0.6013513513513513,8.0,1.0,0.40594059405940597,0.26732673267326734
                                                                                  a posterior obtained assuming a finely binned histogram and merge,82.0,0.38095238095238093,0.6190476190476191,10.0,1.0,0.40594059405940597,0.2722772277227723
"8                                                                                 neighboring bins, which compensates the noise effect. We can then",0.0,0.3877551020408163,0.6122448979591837,11.0,41.0,0.0,0.2722772277227723
"   In our case we note that all parameter values ùùÖ ‚àà Œî are bounded, because",3.0,0.7733333333333333,0.22666666666666668,15.0,1.0,0.01485148514851485,0.6287128712871287
Œî (with a chosen metric) is a bounded metric space. However these solutions       in principle directly use these samples in the cross-correlation like-,0.0,0.8157894736842105,0.1842105263157895,23.0,4.0,0.0,0.24752475247524752
"in logit space (see ¬ß B) do not have to be bounded.                               lihood. Nonetheless, it is computationally more efficient to remap",0.0,0.6621621621621622,0.33783783783783783,21.0,16.0,0.0,0.26732673267326734
9 We will use the term ‚Äòregularization‚Äô not only in the context of Bayesian       these samples to a regular grid with the same or very similar resolu-,0.0,0.7880794701986755,0.21192052980132448,27.0,4.0,0.0,0.2524752475247525
"statistics, where it‚Äôs often implemented in the form of a prior, but in general   tion than the binning used for the cross-correlations, since treating",0.0,0.8344370860927153,0.16556291390728473,24.0,2.0,0.0,0.2524752475247525
to describe methods that restrict the complexity of parameters or functions.      the finely binned histogram heights as free parameters would not,0.0,0.8287671232876712,0.17123287671232879,21.0,4.0,0.0,0.27722772277227725
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,22.63888888888889,1.0,0.0,1.0,1.0,0.11207370737073707,0.9504950495049505
8,0.0,1.0,0.0,1.0,1.0,0.0,0.995049504950495
"add more information due to the resolution loss. We found that the        normal distribution, we finally reparametrize our model on the final",0.0,0.8028169014084507,0.19718309859154926,22.0,5.0,0.0,0.29702970297029707
template fitting posterior after merging bin regularization can again     redshift grid.,0.0,0.8409090909090909,0.15909090909090906,11.0,3.0,0.0,0.5643564356435644
be well-described by a logit normal distribution that we fit using              The merging process described above is largely based on in-,0.0,0.762589928057554,0.237410071942446,21.0,8.0,0.0,0.31188118811881194
Assumed Density filtering.                                                specting when the instabilities vanish. There are certainly more,0.0,0.5797101449275363,0.42028985507246375,12.0,25.0,0.0,0.3168316831683168
"                                                                          principled alternatives. In a classical deconvolution problem, like",74.0,0.425531914893617,0.574468085106383,8.0,1.0,0.36633663366336633,0.301980198019802
"Assumed Density Filtering To fit the logit normal distribution to         the one presented in ¬ß 3, one could use a bootstrap estimate of the",0.0,0.7801418439716312,0.21985815602836878,24.0,5.0,0.0,0.301980198019802
"the sampled and merged posterior samples, we work in logit space          bias and variance of the reconstruction with respect to the over-",0.0,0.7841726618705036,0.2158273381294964,22.0,6.0,0.0,0.31188118811881194
and make a gaussian ansatz                                                smoothed photometric redshift distribution. This is consistent with,0.0,0.5815602836879432,0.4184397163120568,13.0,25.0,0.0,0.301980198019802
                                                                          the approach taken by Padmanabhan et al. (2005) based on the rec-,74.0,0.38848920863309355,0.6115107913669064,12.0,1.0,0.36633663366336633,0.31188118811881194
"ùëû(y) = N (y| ùùÅ, ùö∫) .                                                (20)  ommendation in Craig & Brown (1986). We use a joint likelihood",0.0,0.5147058823529411,0.4852941176470589,19.0,26.0,0.0,0.3267326732673267
                                                                          between the photometry and spatial information to produce posteri-,74.0,0.4142857142857143,0.5857142857142856,9.0,1.0,0.36633663366336633,0.306930693069307
We can directly generate samples from the true distribution by,0.0,0.8548387096774194,0.14516129032258063,10.0,1.0,0.0,0.693069306930693
                                                                          ors for the photometric sample redshift distribution and not a ‚Äòpoint,74.0,0.4125874125874126,0.5874125874125874,11.0,1.0,0.36633663366336633,0.2920792079207921
"sampling from the original, finely binned, logit-normal distribution",0.0,0.8970588235294118,0.1029411764705882,8.0,1.0,0.0,0.6633663366336633
                                                                          prediction‚Äô. Furthermore our ‚Äòmeasured data‚Äô is the photometry and,74.0,0.4142857142857143,0.5857142857142856,9.0,1.0,0.36633663366336633,0.306930693069307
"with subsequent merging, i.e. averaging, of neighboring bins, and",0.0,0.8769230769230769,0.12307692307692308,9.0,1.0,0.0,0.6782178217821782
"                                                                          spatial information of galaxies. Accordingly our model selection, of",74.0,0.4225352112676056,0.5774647887323944,9.0,1.0,0.36633663366336633,0.29702970297029707
then transforming back to logit space. We will denote this true,0.0,0.8412698412698413,0.15873015873015872,11.0,1.0,0.0,0.6881188118811881
"                                                                          which regularization is a part, must reproduce the measured pho-",74.0,0.39855072463768115,0.6014492753623188,10.0,1.0,0.36633663366336633,0.3168316831683168
distribution as ùëù true (y). Assumed density filtering then commences,0.0,0.8676470588235294,0.13235294117647056,10.0,1.0,0.0,0.6633663366336633
"                                                                          tometry and spatial distribution, e.g., measured by the correlation",74.0,0.41843971631205673,0.5815602836879432,9.0,1.0,0.36633663366336633,0.301980198019802
by minimizing the Kullback-Leibler divergence between our ansatz,0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
"                                                                          functions of galaxies. In the Bayesian context, this would trans-",74.0,0.4028776978417266,0.5971223021582734,10.0,1.0,0.36633663366336633,0.31188118811881194
"ùëû(y) and ùëù(y),",0.0,0.8571428571428571,0.1428571428571429,3.0,1.0,0.0,0.9306930693069306
              ‚à´                                                           late into the usage of posterior predictive checks (PPC) discussed,14.0,0.4142857142857143,0.5857142857142856,11.0,30.0,0.06930693069306931,0.306930693069307
                                                                          in ¬ß 7.1. While the path to development of a more principled se-,74.0,0.37681159420289856,0.6231884057971014,13.0,1.0,0.36633663366336633,0.3168316831683168
KL( ùëù||ùëû) =      dy ( ùëù(y) log ùëù(y) ‚àí ùëù(y) log ùëû(y)) .              (21),0.0,0.5694444444444444,0.4305555555555556,14.0,11.0,0.0,0.6435643564356436
"                                                                          lection of the hyperparameters of regularization is known, it will",74.0,0.40714285714285714,0.5928571428571429,10.0,1.0,0.36633663366336633,0.306930693069307
"                                                                          require a thorough investigation. We defer this to future work, us-",74.0,0.40425531914893614,0.5957446808510638,11.0,1.0,0.36633663366336633,0.301980198019802
"After optimizing ùêæ ùêø( ùëù||ùëû) for ùùÅ and ùö∫, we can show that the",0.0,0.7868852459016393,0.21311475409836067,14.0,1.0,0.0,0.698019801980198
                                                                          ing the aforementioned ‚Äòrule-of-thumb‚Äô methodology as an interim,74.0,0.41304347826086957,0.5869565217391304,8.0,1.0,0.36633663366336633,0.3168316831683168
optimium is reached if,0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
‚à´                                                                         solution.,0.0,0.12048192771084337,0.8795180722891567,2.0,37.0,0.0,0.5891089108910892
"    dy ùëù(y) y = ùùÅ ,                                                 (22)",4.0,0.19444444444444445,0.8055555555555556,7.0,25.0,0.019801980198019802,0.6435643564356436
and                                                                       5   CLUSTERING LIKELIHOOD,0.0,0.24242424242424243,0.7575757575757576,4.0,37.0,0.0,0.5099009900990099
      ‚à´,6.0,0.14285714285714285,0.8571428571428572,1.0,1.0,0.0297029702970297,0.9653465346534653
                                    T,36.0,0.02702702702702703,0.972972972972973,1.0,1.0,0.1782178217821782,0.8168316831683169
ùö∫=        dy ùëù(y) (y ‚àí ùùÅ) (y ‚àí ùùÅ)                                   (23)  In order to include information about the spatial distribution of,0.0,0.5611510791366906,0.4388489208633094,20.0,23.0,0.0,0.31188118811881194
"                                                                          galaxies into the likelihood, we consider spatial cross-correlations",74.0,0.4295774647887324,0.5704225352112676,8.0,1.0,0.36633663366336633,0.29702970297029707
We see that assumed density filtering reduces to moment matching          between photometric and spectroscopic samples. Spatial correla-,0.0,0.8175182481751825,0.18248175182481752,17.0,6.0,0.0,0.32178217821782173
"in logit space, when we apply the sample mean and sample covari-          tions measure the excess probability over random to find two galax-",0.0,0.7801418439716312,0.21985815602836878,23.0,6.0,0.0,0.301980198019802
ance estimators to samples from ùëù true (y). We note that this is in       ies separated by a certain distance. This can be exploited to extract,0.0,0.7832167832167832,0.21678321678321677,26.0,4.0,0.0,0.2920792079207921
"general true for distributions of the exponential family (see, e.g.,      redshift information for galaxy samples (see e.g. Newman 2008;",0.0,0.8308823529411765,0.16911764705882348,19.0,4.0,0.0,0.3267326732673267
Ranganathan 2004).                                                        M√©nard et al. 2013; McQuinn & White 2013; Scottez et al. 2016;,0.0,0.5,0.5,14.0,29.0,0.0,0.3267326732673267
"      To summarize, we perform the inference scheme described in          Raccanelli et al. 2017; Morrison et al. 2017; Davis et al. 2017; Gatti",6.0,0.75,0.25,22.0,6.0,0.0297029702970297,0.28712871287128716
the previous section using a fine histogram binning. Subsequently         et al. 2018) for which we do not have accurate redshift informa-,0.0,0.7971014492753623,0.2028985507246377,21.0,5.0,0.0,0.3168316831683168
"we sample from the posterior after regularizing the inverse hessian       tion, i.e. photometric galaxy samples, using spatially overlapping",0.0,0.8357142857142857,0.16428571428571426,18.0,4.0,0.0,0.306930693069307
using Tikhonov regularization. We merge neighboring bins from             spectroscopic catalogs.,0.0,0.7835051546391752,0.21649484536082475,10.0,7.0,0.0,0.5198019801980198
each posterior draw until the noise is reduced and we obtain a smooth           The idea is to select the spectroscopic samples in thin redshift,0.0,0.7708333333333334,0.22916666666666663,24.0,6.0,0.0,0.28712871287128716
"probability distribution. We illustrate this process in Fig. 2, which     slices and estimate the cross-correlation between these redshift-",0.0,0.8489208633093526,0.15107913669064743,18.0,3.0,0.0,0.31188118811881194
illustrates the impact of the ‚ÄòMerging Bin‚Äô regularization scheme         selected samples and the full photometric galaxy sample. As dis-,0.0,0.8115942028985508,0.18840579710144922,19.0,5.0,0.0,0.3168316831683168
"on the posterior of the sample photometric redshift distribution.         cussed in the following, the resulting signal will then be proportional",0.0,0.8137931034482758,0.18620689655172418,20.0,5.0,0.0,0.2821782178217822
Comparing the grey contours (‚ÄòFiducial‚Äô) that uses 50 bins with           to the photometric redshift distribution at that redshift.,0.0,0.7954545454545454,0.20454545454545459,18.0,6.0,0.0,0.3465346534653465
the red contours (‚ÄòMerging Bin‚Äô) that merges neighboring bins to                Fig. 3 illustrates the basic idea of cross-correlation redshift,0.0,0.7692307692307693,0.23076923076923073,19.0,9.0,0.0,0.2920792079207921
"a binning of 30 bins, we see the much smoother shape and the              inference. We consider two galaxy samples: a reference sample",0.0,0.7481481481481481,0.2518518518518519,22.0,8.0,0.0,0.33168316831683164
elimination of the ‚Äòzig-zag‚Äô pattern present in the grey contours.        ‚ÄòR‚Äô and a base galaxy sample ‚ÄòB‚Äô. The reference sample contains,0.0,0.8029197080291971,0.1970802919708029,21.0,5.0,0.0,0.32178217821782173
"We defer a more thorough explanation of the methodology and               galaxies with accurate, often spectroscopic, redshift measurements;",0.0,0.7872340425531915,0.21276595744680848,17.0,8.0,0.0,0.301980198019802
"sample to ¬ß 8 and Fig. 7, which discusses the result shown in the         the base galaxy sample consists of galaxies observed in broad band",0.0,0.7714285714285715,0.22857142857142854,25.0,5.0,0.0,0.306930693069307
grey contours under the abbreviation ‚ÄòSmall Sample (50k)‚Äô.                photometric filters. As the base/reference samples are typically pho-,0.0,0.7832167832167832,0.21678321678321677,17.0,9.0,0.0,0.2920792079207921
"      Based on our experience we propose to initially merge neigh-        tometric/spectroscopic samples, we use these terms interchangably",6.0,0.7913669064748201,0.2086330935251799,17.0,5.0,0.0297029702970297,0.31188118811881194
boring bins until we obtain a bin size of the order of the average        in text10 . The redshift distribution of the base sample is illustrated,0.0,0.7793103448275862,0.2206896551724138,26.0,5.0,0.0,0.2821782178217822
"¬±2ùúé range of the individual galaxy redshift distributions. Subse-         by the red distribution, while the binned reference sample redshift",0.0,0.8156028368794326,0.18439716312056742,19.0,5.0,0.0,0.301980198019802
quently we merge fewer bins until the aforementioned character-           distributions for simplicity are shown as tophat functions (unlike,0.0,0.8071428571428572,0.19285714285714284,18.0,6.0,0.0,0.306930693069307
istic ‚Äòzig-zag‚Äô noise pattern appears. This can be identified as the      the simulated samples we use to test our methodology). A sin-,0.0,0.8074074074074075,0.19259259259259254,22.0,4.0,0.0,0.33168316831683164
limiting resolution we can obtain. We note that it is important to        gle cross-correlation is then obtained by cross-correlating a single,0.0,0.8098591549295775,0.1901408450704225,21.0,5.0,0.0,0.29702970297029707
distinguish patterns due to ‚Äòreal‚Äô line of sight structure and due to     tophat selection with the full base sample. Multiple measurements,0.0,0.8273381294964028,0.17266187050359716,21.0,3.0,0.0,0.31188118811881194
the aforementioned noise in the deconvolution. If the pattern ap-,0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
"pears gradually with increasing resolution (merging fewer bins),",0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
"it is indicative of statistically significant line-of-sight structure. If 10  We note, however, that the reference sample does not have to be a spectro-",0.0,0.8421052631578947,0.1578947368421053,24.0,2.0,0.0,0.24752475247524752
"the deconvolved density suddenly becomes unstable in a ‚Äòzig-zag‚Äô          scopic dataset, as multi-band, narrow filter photometric observations (Alar-",0.0,0.8266666666666667,0.17333333333333334,18.0,6.0,0.0,0.25742574257425743
"pattern when fewer bins are merged, we have reached a resolution          con et al. 2020a), or photometric redshifts of redMaGiC samples (see e.g.",0.0,0.7891156462585034,0.2108843537414966,23.0,6.0,0.0,0.2722772277227723
"limit. Using assumed density filtering under the ansatz of a logit        Gatti et al. 2018), also allow for reasonable redshift accuracy.",0.0,0.8043478260869565,0.19565217391304346,21.0,5.0,0.0,0.3168316831683168
"                                                                                                                            MNRAS 000, 1‚Äì22 (2015)",124.0,0.13013698630136986,0.8698630136986302,4.0,1.0,0.6138613861386139,0.27722772277227725
avr_spaces,16.426666666666666,1.0,0.0,1.0,1.0,0.08132013201320132,0.9504950495049505
                                                                                        Likelihood Inference under Photo-z error                                   9,88.0,0.22560975609756098,0.774390243902439,6.0,18.0,0.43564356435643564,0.18811881188118806
                                                                                 surements (wÃÇRB and wÃÇRR ) just described are assumed to individu-,81.0,0.38095238095238093,0.6190476190476191,11.0,1.0,0.400990099009901,0.2722772277227723
                                                                                 ally follow a Gaussian likelihood11 .,81.0,0.2711864406779661,0.728813559322034,6.0,1.0,0.400990099009901,0.4158415841584159
                                                                                        Based on these definitions and approximations and the consid-,88.0,0.35570469798657717,0.6442953020134228,9.0,1.0,0.43564356435643564,0.2623762376237624
"                                                                                 erations in the previous section, we construct a likelihood based on",81.0,0.38926174496644295,0.610738255033557,11.0,1.0,0.400990099009901,0.2623762376237624
                                                                                 the ratio between wÃÇRB and wÃÇRR . Under the assumption of a diag-,81.0,0.363013698630137,0.636986301369863,13.0,1.0,0.400990099009901,0.27722772277227725
"                                                                                 onal covariance matrix12 for wÃÇRB and wÃÇRR , we can construct the",81.0,0.3698630136986301,0.6301369863013699,12.0,1.0,0.400990099009901,0.27722772277227725
                                                                                 random variable ùö™ for bin ùëñ with components,81.0,0.2903225806451613,0.7096774193548387,8.0,1.0,0.400990099009901,0.38613861386138615
                                                                                                         !,105.0,0.009433962264150943,0.9905660377358491,1.0,1.0,0.5198019801980198,0.4752475247524752
                                                                                   meas,83.0,0.04597701149425287,0.9540229885057472,1.0,1.0,0.41089108910891087,0.5693069306930694
                                                                                                ùë§ÀÜ ùëñùëÖùêµ,96.0,0.049019607843137254,0.9509803921568627,2.0,1.0,0.4752475247524752,0.49504950495049505
                                                                                 Œìùëñ       =                 .                                                    (26),81.0,0.048484848484848485,0.9515151515151515,4.0,38.0,0.400990099009901,0.18316831683168322
                                                                                                ùë§ÀÜ ùëñùëÖùëÖ,96.0,0.049019607843137254,0.9509803921568627,2.0,1.0,0.4752475247524752,0.49504950495049505
                                                                                 We reiterate that both ùë§ÀÜ ùëñùëÖùêµ and ùë§ÀÜ ùëñùëÖùëÖ are described by a Gaus-,81.0,0.3561643835616438,0.6438356164383562,14.0,1.0,0.400990099009901,0.27722772277227725
                                                                                 sian Likelihood. Their respective means and standard deviations,81.0,0.3888888888888889,0.6111111111111112,8.0,1.0,0.400990099009901,0.28712871287128716
"Figure 3. Illustration of the construction of the cross-correlation data vector. are given as ùúáRB,i , ùúáRR,i , ùúéRB,i , ùúéRR,i respectively. The theoretical",0.0,0.8496732026143791,0.15032679738562094,24.0,1.0,0.0,0.24257425742574257
A ‚ÄòReference Sample‚Äô that can be precisely selected in redshift is moved over    prediction for the transformed random variable Œìmeas              ùëñ     is then,0.0,0.7375,0.26249999999999996,23.0,12.0,0.0,0.20792079207920788
"a ‚ÄòBase Sample‚Äô, which can either be a sample without redshift information",0.0,0.8513513513513513,0.14864864864864868,12.0,1.0,0.0,0.6336633663366337
(photometric sample) or the ‚ÄòReference Sample‚Äô itself. In this illustration                                              ùëè ùëñùêµ ùúãùëñùêµ,0.0,0.5581395348837209,0.4418604651162791,13.0,24.0,0.0,0.3613861386138614
"10 cross-correlations would be estimated, constituting the cross-correlation",0.0,0.9078947368421053,0.09210526315789469,8.0,1.0,0.0,0.6237623762376238
                                                                                 Œìtheo,81.0,0.05813953488372093,0.9418604651162791,1.0,1.0,0.400990099009901,0.5742574257425743
                                                                                   ùëñ    (ùëè ùêµ ùëÖ ùêµ ùëÖ,83.0,0.07142857142857142,0.9285714285714286,6.0,3.0,0.41089108910891087,0.5148514851485149
"                                                                                           ùëñ  , ùëè ùëñ  , ùúã ùëñ  , ùúã ùëñ  )  =            ,                             (27)",91.0,0.10303030303030303,0.896969696969697,14.0,26.0,0.4504950495049505,0.18316831683168322
                                                                                                                         ùëè ùëñùëÖ ùúãùëñùëÖ,121.0,0.046511627906976744,0.9534883720930233,3.0,1.0,0.599009900990099,0.3613861386138614
data vector.,0.0,0.9166666666666666,0.08333333333333337,2.0,1.0,0.0,0.9405940594059405
                                                                                 and its likelihood:,81.0,0.17,0.83,3.0,1.0,0.400990099009901,0.504950495049505
                                                                                                              ùëè(Œìtheo,110.0,0.05982905982905983,0.9401709401709402,1.0,1.0,0.5445544554455446,0.42079207920792083
                                                                                                                   ùëñ )ùëë (Œìùëñ ),115.0,0.056,0.944,4.0,1.0,0.5693069306930693,0.3811881188118812
                                                                                                                               theo,127.0,0.030534351145038167,0.9694656488549618,1.0,1.0,0.6287128712871287,0.35148514851485146
                                                                                                                                              1,142.0,0.006993006993006993,0.993006993006993,1.0,1.0,0.7029702970297029,0.2920792079207921
"therefore ‚Äòslice‚Äô through the redshift distribution of the base sample,          ùëù(Œìmeas",0.0,0.7840909090909091,0.21590909090909094,11.0,6.0,0.0,0.5643564356435644
                                                                                      ùëñ      |Œìtheo,86.0,0.0707070707070707,0.9292929292929293,2.0,4.0,0.42574257425742573,0.5099009900990099
                                                                                                 ùëñ ) =                                 ‚àö               √ó,97.0,0.03289473684210526,0.9671052631578947,5.0,24.0,0.4801980198019802,0.24752475247524752
illustrated here by the arrows and the grey hatched tophat slices.                                                 ùëé 3 (Œìtheo,0.0,0.512,0.488,14.0,25.0,0.0,0.3811881188118812
"                                                                                                                          ùëñ )            2ùúãùúéRB,i ùúéRR,i",122.0,0.09333333333333334,0.9066666666666666,4.0,7.0,0.6039603960396039,0.25742574257425743
                                                                                                       !                         !!,103.0,0.022900763358778626,0.9770992366412213,2.0,13.0,0.5099009900990099,0.35148514851485146
"      As described in detail in Schmidt et al. (2013), Morrison et al.                   ùëè(Œìtheo",6.0,0.625,0.375,13.0,10.0,0.0297029702970297,0.5247524752475248
                                                                                              ùëñ )                     ùëè(Œìtheo,94.0,0.072,0.928,3.0,11.0,0.46534653465346537,0.3811881188118812
                                                                                                                            ùëñ ),124.0,0.015748031496062992,0.984251968503937,2.0,1.0,0.6138613861386139,0.3712871287128713
"(2017) and M√©nard et al. (2013), we measure the over-density, com-                 Œ¶                     ‚àíŒ¶ ‚àí                                                    (28)",0.0,0.3878787878787879,0.6121212121212121,15.0,45.0,0.0,0.18316831683168322
                                                                                         ùëé(Œìtheo,89.0,0.07291666666666667,0.9270833333333334,1.0,1.0,0.4405940594059406,0.5247524752475248
                                                                                              ùëñ )                     ùëé(Œìtheo,94.0,0.072,0.928,3.0,11.0,0.46534653465346537,0.3811881188118812
                                                                                                                            ùëñ ),124.0,0.015748031496062992,0.984251968503937,2.0,1.0,0.6138613861386139,0.3712871287128713
"pared with a spatially random distribution of points, of photometric                                                                      !",0.0,0.4316546762589928,0.5683453237410072,11.0,36.0,0.0,0.31188118811881194
"galaxies around each galaxy in the spectroscopic sample, within                                      1                                ùëê",0.0,0.4222222222222222,0.5777777777777777,11.0,36.0,0.0,0.33168316831683164
"an annulus of physical scale Œîùúí = [ ùúímin , ùúímax ]. The theoretical                +                                      exp ‚àí theo .",0.0,0.47368421052631576,0.5263157894736843,19.0,28.0,0.0,0.34158415841584155
                                                                                     ùëé 2 (Œìtheo,85.0,0.08421052631578947,0.9157894736842105,3.0,1.0,0.4207920792079208,0.5297029702970297
"                                                                                            ùëñ )ùúãùúéRB,i ùúéRR,i                       Œìùëñ",92.0,0.11363636363636363,0.8863636363636364,4.0,12.0,0.45544554455445546,0.3465346534653465
model for a cross-correlation function between the spectroscopic,0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
reference sample in tophat bin ùëñ and the photometric base sample is              Here Œ¶(ùëß) denotes the cumulative distribution function of the zero,0.0,0.7687074829931972,0.23129251700680276,22.0,8.0,0.0,0.2722772277227723
given as:                                                                        mean unit variance normal distribution and,0.0,0.36585365853658536,0.6341463414634146,8.0,37.0,0.0,0.3910891089108911
                               !                                                                  ‚àöÔ∏Ñ,31.0,0.03,0.97,2.0,34.0,0.15346534653465346,0.504950495049505
                       ùúãùëñB                                                       ùëé(Œìtheo,23.0,0.11363636363636363,0.8863636363636364,2.0,28.0,0.11386138613861387,0.5643564356435644
                                                                                                          1,106.0,0.009345794392523364,0.9906542056074766,1.0,1.0,0.5247524752475248,0.47029702970297027
                                                                                                                (Œìtheo,112.0,0.05084745762711865,0.9491525423728814,1.0,1.0,0.5544554455445545,0.4158415841584159
                                                                                                                                   1,131.0,0.007575757575757576,0.9924242424242424,1.0,1.0,0.6485148514851485,0.3465346534653465
                                                                                           )  =                     ùëñ ) + 2,91.0,0.04878048780487805,0.9512195121951219,6.0,12.0,0.4504950495049505,0.3910891089108911
   RB     ùëÖ ùêµ                                                                                                             2                                      (29),3.0,0.05454545454545454,0.9454545454545454,5.0,76.0,0.01485148514851485,0.18316831683168322
"ùë§ùëñ ‚àù ùëèùëñ ùëèùëñ                       ùë§ DM,i .                                  (24)       ùëñ                  2",0.0,0.1792452830188679,0.8207547169811321,10.0,41.0,0.0,0.4752475247524752
"                                                                                                      ùúéRB,i                     ùúéRR,i",102.0,0.07518796992481203,0.924812030075188,2.0,11.0,0.504950495049505,0.34158415841584155
                   ùëß ùëñùêª ‚àí ùëßùëñùêø,19.0,0.2413793103448276,0.7586206896551724,4.0,1.0,0.09405940594059406,0.8564356435643564
"                                                                                                   ùúáRB,i             ùúáRR,i",99.0,0.08196721311475409,0.9180327868852459,2.0,7.0,0.4900990099009901,0.39603960396039606
                                                                                 ùëè(Œìtheo,81.0,0.07954545454545454,0.9204545454545454,1.0,1.0,0.400990099009901,0.5643564356435644
                                                                                      ùëñ ) = 2               Œìùëñ + 2                                               (30),86.0,0.07272727272727272,0.9272727272727272,8.0,31.0,0.42574257425742573,0.18316831683168322
"Here, ùëè ùëñùëÖ and ùëè ùëñùêµ denote the value of the redshift-dependent galaxy-                            ùúéRB,i              ùúéRR,i",0.0,0.5573770491803278,0.4426229508196722,15.0,22.0,0.0,0.39603960396039606
dark matter bias of the reference (R) and base (B) samples. The                                                                             !,0.0,0.375886524822695,0.624113475177305,13.0,39.0,0.0,0.301980198019802
"normed histogram bin heights of the base, or photometric, sample                      theo",0.0,0.6555555555555556,0.34444444444444444,11.0,12.0,0.0,0.5544554455445545
                                                                                                           ùëè(Œìtheo      2,107.0,0.06611570247933884,0.9338842975206612,2.0,4.0,0.5297029702970297,0.400990099009901
                                                                                                                  ùëñ ) ‚àí ùëêùëé(Œìùëñ ),114.0,0.07086614173228346,0.9291338582677166,5.0,1.0,0.5643564356435643,0.3712871287128713
                                                                                                                                     theo 2,133.0,0.03597122302158273,0.9640287769784173,2.0,1.0,0.6584158415841584,0.31188118811881194
                                                         √ç                       ùëë (Œìùëñ ) = exp                                                                   (31),57.0,0.08484848484848485,0.9151515151515152,7.0,45.0,0.28217821782178215,0.18316831683168322
"redshift distribution are denoted as ùúãùëñùêµ , where ùëñ ùúãùëñùêµ = 1, and the                                                  2ùëé(Œìtheoùëñ )",0.0,0.5,0.5,16.0,26.0,0.0,0.36633663366336633
                                                                                                                                  2,130.0,0.007633587786259542,0.9923664122137404,1.0,1.0,0.6435643564356436,0.35148514851485146
"size of a redshift bin is given as ùëß ùëñùêª ‚àí ùëß ùëñùêø . The term ùë§ DM,i denotes                             2             2",0.0,0.4827586206896552,0.5172413793103448,21.0,21.0,0.0,0.4257425742574258
"                                                                                                   ùúáRB,i         ùúáRR,i",99.0,0.0847457627118644,0.9152542372881356,2.0,5.0,0.4900990099009901,0.4158415841584159
the contribution of dark-matter clustering to the cross-correlation                        ùëê=                 +           .                                      (32),0.0,0.4121212121212121,0.5878787878787879,12.0,45.0,0.0,0.18316831683168322
"signal, which depends on the cosmological model.                                                     2",0.0,0.4215686274509804,0.5784313725490196,8.0,27.0,0.0,0.49504950495049505
"                                                                                                  ùúéRB,i             2",98.0,0.05128205128205128,0.9487179487179487,2.0,7.0,0.48514851485148514,0.42079207920792083
"                                                                                                                 ùúéRR,i",113.0,0.0423728813559322,0.9576271186440678,1.0,1.0,0.5594059405940595,0.4158415841584159
      We see that the modelling of the cross-correlation signal de-,6.0,0.7761194029850746,0.22388059701492535,10.0,1.0,0.0297029702970297,0.6683168316831682
"pends on the product of two redshift-dependent galaxy-dark matter                For the following discussion we define n = ùëßùêª ùùÖ‚àíùëß ùêø , i.e. the variables",0.0,0.7516339869281046,0.24836601307189543,24.0,9.0,0.0,0.24257425742574257
"bias functions that are completely degenerate with the set of pa-                ùùÖ, n refer to histogram heights normalized to sum to unity and to",0.0,0.7397260273972602,0.26027397260273977,24.0,9.0,0.0,0.27722772277227725
rameters ùúã B that parametrizes the redshift distribution of the base             unit area respectively. The variable nB and nR refer to the histogram,0.0,0.7733333333333333,0.22666666666666668,23.0,7.0,0.0,0.25742574257425743
"sample. Furthermore, since ùë§ DM,i depends on the cosmological                    heights of the base and reference samples. This likelihood assumes",0.0,0.7482993197278912,0.2517006802721088,19.0,11.0,0.0,0.2722772277227723
"model, it will be computationally expensive to sample over these                 independence between neighboring redshift bins. We can, however,",0.0,0.7724137931034483,0.22758620689655173,18.0,9.0,0.0,0.2821782178217822
parameters.                                                                      expect a degree of correlation especially for lower redshift bins due,0.0,0.4666666666666667,0.5333333333333333,12.0,36.0,0.0,0.25742574257425743
"      To reduce the impact of the cosmological model, we want to                 to magnification effects.",6.0,0.6698113207547169,0.33018867924528306,14.0,9.0,0.0297029702970297,0.4752475247524752
combine the cross-correlations wRB with the correlations wRR of                         Eq. (28) is approximately independent of the modelling of the,0.0,0.7181208053691275,0.2818791946308725,19.0,13.0,0.0,0.2623762376237624
"the spectroscopic sample. We therefore correlate the spectroscopic               ùë§ DM term, assuming that we pick sufficiently thin redshift bins to",0.0,0.777027027027027,0.22297297297297303,20.0,8.0,0.0,0.26732673267326734
"sample with itself in a manner analogous to what was just described,             ‚Äòdivide-out‚Äô the redshift-dependence of the dark matter clustering",0.0,0.7891156462585034,0.2108843537414966,20.0,7.0,0.0,0.2722772277227723
"i.e., by correlating tophat selected spectroscopic samples with the              term ùë§ DM . Based on the aforementioned independence assumption",0.0,0.7847222222222222,0.2152777777777778,19.0,8.0,0.0,0.28712871287128716
full spectroscopic sample. The corresponding theory prediction then,0.0,0.8955223880597015,0.10447761194029848,8.0,1.0,0.0,0.6683168316831682
reads,0.0,1.0,0.0,1.0,1.0,0.0,0.9752475247524752
"                               !                                                 11  In reality, we expect that the likelihood will deviate from the Gaussian",31.0,0.40764331210191085,0.5923566878980892,14.0,26.0,0.15346534653465346,0.22277227722772275
   RR       ùëÖ 2,3.0,0.26666666666666666,0.7333333333333334,3.0,4.0,0.01485148514851485,0.9257425742574258
                       ùúãùëñùëÖ,23.0,0.11538461538461539,0.8846153846153846,1.0,1.0,0.11386138613861387,0.8712871287128713
"ùë§ ùëñ ‚àù (ùëè ùëñ )                     ùë§ DM,i                                    (25)  assumption (see e.g. Hahn et al. 2019).",0.0,0.4083333333333333,0.5916666666666667,16.0,30.0,0.0,0.40594059405940597
"                   ùëß ùëñùêª ‚àí ùëß ùëñùêø                                                   12 While the covariance matrix will be dominated by the diagonal, we",19.0,0.42953020134228187,0.5704697986577181,17.0,26.0,0.09405940594059406,0.2623762376237624
"                                                                                 can expect, that the cross-correlation measurements in different bins will",81.0,0.41935483870967744,0.5806451612903225,10.0,1.0,0.400990099009901,0.23267326732673266
where ùúãùëñùëÖ is the normalized histogram height of the spectroscopic                be correlated. Thus the assumption of a diagonal covariance matrix is an,0.0,0.7647058823529411,0.23529411764705888,22.0,9.0,0.0,0.24257425742574257
(full) sample redshift distribution. Both correlation function mea-              approximation.,0.0,0.7789473684210526,0.2210526315789474,9.0,8.0,0.0,0.5297029702970297
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,51.02912621359224,1.0,0.0,1.0,1.0,0.2526194367009517,0.9504950495049505
10,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
"between redshift bins, the joint likelihood for all bins ùëñ now reads:       7.1    Model Evaluation: Posterior Predictive Checks",0.0,0.796875,0.203125,18.0,6.0,0.0,0.36633663366336633
                             ùëÅ,29.0,0.03333333333333333,0.9666666666666667,1.0,1.0,0.14356435643564355,0.8514851485148515
                             √ñbins                                          The idea of posterior predictive checks (PPC) is to simulate syn-,29.0,0.425531914893617,0.574468085106383,12.0,22.0,0.14356435643564355,0.301980198019802
"ùëù(ùö™|bb , bR , nR , nB ) =          ùëù(Œìùëñ |ùëè ùëñùêµ , ùëè ùëñùëÖ , ùëõùëñùëÖ , ùëõùëñùêµ )     (33) thetic data from a fitted model, that is then compared with the",0.0,0.6762589928057554,0.3237410071942446,33.0,8.0,0.0,0.31188118811881194
                             ùëñ=1                                            original measurements to serve as an internal consistency check.,29.0,0.42142857142857143,0.5785714285714285,10.0,23.0,0.14356435643564355,0.306930693069307
                                                                            For example there exist several approaches that allow us to estimate,76.0,0.4027777777777778,0.5972222222222222,11.0,1.0,0.37623762376237624,0.28712871287128716
The function that describes the set of ratios ùëè ùëñùêµ /ùëè ùëñùëÖ will be denoted    the quality of probability calibration based on the distribution of,0.0,0.8111888111888111,0.18881118881118886,25.0,3.0,0.0,0.2920792079207921
"as ùê∂ (ùëß, Œîùúí‚ä• ) and depends both on redshift and the size of the             posterior predictive ùëù-values (e.g. Gelman et al. 1996). This paper",0.0,0.7482517482517482,0.2517482517482518,25.0,7.0,0.0,0.2920792079207921
"annulus Œîùúí. For a selected annulus size we will use the abbreviation        will only provide a short discussion of posterior predictive testing,",0.0,0.8068965517241379,0.19310344827586212,22.0,5.0,0.0,0.2821782178217822
ùê∂ (ùëß).                                                                      which is still an area of active research. The basic idea of model,0.0,0.4154929577464789,0.5845070422535211,15.0,36.0,0.0,0.29702970297029707
                                                                            checking is to investigate if data predicted by the fitted model is,76.0,0.3916083916083916,0.6083916083916083,12.0,1.0,0.37623762376237624,0.2920792079207921
"                                                                            representative of the observed data. The classical approach, for ex-",76.0,0.4097222222222222,0.5902777777777778,10.0,1.0,0.37623762376237624,0.28712871287128716
"                                                                            ample developed for linear regression, uses an analytical probability",76.0,0.4206896551724138,0.5793103448275863,9.0,1.0,0.37623762376237624,0.2821782178217822
6    THE COMPOSITE LIKELIHOOD                                               distribution for the test statistic (for example the ùúí2 distribution) and,0.0,0.5771812080536913,0.42281879194630867,15.0,26.0,0.0,0.2623762376237624
                                                                            evaluates the tail probability to test how much of an ‚Äòoutlier‚Äô the,76.0,0.3916083916083916,0.6083916083916083,12.0,1.0,0.37623762376237624,0.2920792079207921
"To formulate a joint likelihood for the data vector of both galaxy po-      observed data is, given the fitted model. This approach can be prob-",0.0,0.7986111111111112,0.20138888888888884,25.0,4.0,0.0,0.28712871287128716
"sitions and photometry, we use the composite likelihood ansatz (e.g.        lematic if the model is complex13 , which makes it difficult to derive",0.0,0.8013698630136986,0.1986301369863014,23.0,5.0,0.0,0.27722772277227725
Varin et al. 2011) that uses the product of marginal likelihoods for        an analytic sampling distribution for a suitable statistic given a fitted,0.0,0.8053691275167785,0.19463087248322153,23.0,5.0,0.0,0.2623762376237624
both the photometry FÃÇ and the vector of cross-correlation functions        model. Further problems arise due to significant influence of out-,0.0,0.8169014084507042,0.18309859154929575,20.0,5.0,0.0,0.29702970297029707
"ùö™:                                                                          liers, or if parameters are subject to boundary conditions. Posterior",0.0,0.42758620689655175,0.5724137931034483,11.0,38.0,0.0,0.2821782178217822
                                                                            predictive checks are extensions to this classical approach in the,76.0,0.4014084507042254,0.5985915492957746,10.0,1.0,0.37623762376237624,0.29702970297029707
"ùëù( FÃÇ, ùö™|nB,sys , nB , nR , C(z)) = ùëù( FÃÇ|n ùêµ ) ùúê1 ùëù(ùö™|nB,sys , C(z)) ùúê2 ,  Bayesian framework.",0.0,0.7684210526315789,0.2315789473684211,22.0,2.0,0.0,0.5297029702970297
"                                                                       (34)       Starting from the composite likelihood defined in Eq. (34), the",71.0,0.4,0.6,11.0,4.0,0.35148514851485146,0.2821782178217822
                                                                            posterior predictive distribution reads,76.0,0.3130434782608696,0.6869565217391305,4.0,1.0,0.37623762376237624,0.43069306930693074
where ùùä are weights that can be selected to improve the efficiency of,0.0,0.8260869565217391,0.17391304347826086,13.0,1.0,0.0,0.6584158415841583
                                                                                             ‚à¨,93.0,0.010638297872340425,0.9893617021276596,1.0,1.0,0.4603960396039604,0.5346534653465347
the estimation (see e.g. Varin et al. 2011) by increasing the influence,0.0,0.8450704225352113,0.15492957746478875,12.0,1.0,0.0,0.6485148514851485
"of one part of the composite likelihood over the other. Furthermore         ùëù(Drep |D) =         dnB dC(z) ùëù(D rep |nB , C(z)) ùëù(nB , C(z)|D) ,",0.0,0.7202797202797203,0.2797202797202797,25.0,9.0,0.0,0.2920792079207921
the composite likelihood can be conditioned on auxiliary parameters                                                                               (35),0.0,0.42,0.5800000000000001,10.0,40.0,0.0,0.25742574257425743
such as the field. For simplicity we consider here only the simple,0.0,0.8333333333333334,0.16666666666666663,12.0,1.0,0.0,0.6732673267326732
"case of ùùä = 1 and refer for an additional discussion to ¬ß 10.               where D = {Œì(ùë§ BR , ùë§ RR ), FÃÇ} and D rep denote the replicated, or",0.0,0.6923076923076923,0.3076923076923077,31.0,8.0,0.0,0.2920792079207921
"       We note that measurements of LSS and weak lensing often              predicted, measurements sampled from the fitted model. We note",7.0,0.7246376811594203,0.2753623188405797,19.0,8.0,0.034653465346534656,0.3168316831683168
"use galaxy samples that are selected by increasing redshift, to form        that our model specifies only the ratio between ùë§ RB and ùë§ RR . How-",0.0,0.7777777777777778,0.2222222222222222,26.0,5.0,0.0,0.28712871287128716
"tomographic bins. This analysis methodology can be incorporated             ever, we can always sample replications for one of these quantities",0.0,0.7902097902097902,0.2097902097902098,19.0,7.0,0.0,0.2920792079207921
into Eq. (34) by replacing FÃÇ and ùö™ with the joint data vectors of the      using the measurement of the other via the data transformation,0.0,0.7898550724637681,0.21014492753623193,25.0,4.0,0.0,0.3168316831683168
"selected galaxy samples, which would include covariances between            specified in Eq. (26).",0.0,0.7755102040816326,0.22448979591836737,12.0,7.0,0.0,0.5148514851485149
the ùö™ measurements for different tomographic bins. Furthermore                    Posterior predictive checking is particularly useful as it allows,0.0,0.7619047619047619,0.23809523809523814,17.0,11.0,0.0,0.2722772277227723
the quality and number of available photometric bands can change            us to access model calibration quality and predictive accuracy with-,0.0,0.7916666666666666,0.20833333333333337,20.0,7.0,0.0,0.28712871287128716
for different spatial areas. Similarly we need to construct a joint data    out spectroscopic (or accurate multiband photometric) validation,0.0,0.85,0.15000000000000002,19.0,3.0,0.0,0.306930693069307
vector of FÃÇ and ùö™ that incorporates these covariances. This can be         data. This is a decisive advantage of specifying the photometric,0.0,0.7928571428571428,0.20714285714285718,22.0,5.0,0.0,0.306930693069307
modelled either analytically (e.g. Stoyan & Stoyan 1994; S√°nchez            likelihood over empirical approaches based on machine learning,0.0,0.8043478260869565,0.19565217391304346,17.0,7.0,0.0,0.3168316831683168
"et al. 2020) or by using spatial resampling techniques. In this work        or, more specifically, conditional density estimation. By modelling",0.0,0.8181818181818182,0.18181818181818177,20.0,5.0,0.0,0.2920792079207921
"we will concentrate on the composite likelihood as given in Eq. (34)        the data generating process of SED evolution and redshifting, we",0.0,0.8,0.19999999999999996,22.0,5.0,0.0,0.306930693069307
"and refer extensions of the method to future work.                          can generate new photometry using a fitted physical model, giving",0.0,0.6950354609929078,0.3049645390070922,19.0,14.0,0.0,0.301980198019802
                                                                            us the opportunity to develop statistical tests based on the predic-,76.0,0.4027777777777778,0.5972222222222222,11.0,1.0,0.37623762376237624,0.28712871287128716
                                                                            tive distribution to probe the quality of the photometric likelihood,76.0,0.4097222222222222,0.5902777777777778,10.0,1.0,0.37623762376237624,0.28712871287128716
                                                                            calibration.,76.0,0.13636363636363635,0.8636363636363636,1.0,1.0,0.37623762376237624,0.5643564356435644
"                                                                                  To avoid confusion, it is important to clarify that posterior",82.0,0.36363636363636365,0.6363636363636364,10.0,1.0,0.40594059405940597,0.2920792079207921
7    MODEL EVALUATION AND PARAMETRIZATION OF,0.0,0.8181818181818182,0.18181818181818177,6.0,3.0,0.0,0.7821782178217822
"                                                                            predictive checking and model comparison, while often method-",76.0,0.39416058394160586,0.6058394160583942,8.0,1.0,0.37623762376237624,0.32178217821782173
     SYSTEMATICS,5.0,0.6875,0.3125,1.0,1.0,0.024752475247524754,0.9207920792079208
"                                                                            ologically similar, have different goals. Posterior predictive checks",76.0,0.42758620689655175,0.5724137931034483,8.0,1.0,0.37623762376237624,0.2821782178217822
Parameter inference is only a single step in a full statistical analysis    aim to provide internal consistency tests for a given model and in-,0.0,0.8181818181818182,0.18181818181818177,24.0,3.0,0.0,0.2920792079207921
and needs to be combined with additional analysis steps. We need            ference framework. Model comparison/combination has the goal to,0.0,0.7913669064748201,0.2086330935251799,19.0,7.0,0.0,0.31188118811881194
to ensure that parameters can be uniquely inferred and the posterior        compare/combine multiple models based on some measure of fitting,0.0,0.8142857142857143,0.18571428571428572,20.0,5.0,0.0,0.306930693069307
"does not exhibit flat regions or strong degeneracies, which can make        accuracy. However, model comparison and combination can also be",0.0,0.8129496402877698,0.18705035971223016,20.0,5.0,0.0,0.31188118811881194
the application of MCMC techniques difficult (see e.g. Rothenberg           based on posterior predictive accuracy (see e.g. Gelman et al. 2013).,0.0,0.8,0.19999999999999996,20.0,6.0,0.0,0.2821782178217822
"1971; Raue et al. 2013). Furthermore, one needs to investigate the          In the development of new models and the evaluation of directions",0.0,0.7872340425531915,0.21276595744680848,22.0,6.0,0.0,0.301980198019802
"sensitivity of the results against changes in the prior and likelihood.     for improvement, both of these concepts work together.",0.0,0.8307692307692308,0.16923076923076918,19.0,3.0,0.0,0.3564356435643564
"Finally, one has to judge if the inferred posteriors are sensible in              An important prerequisite for the fitting of complex statis-",0.0,0.7676056338028169,0.23239436619718312,21.0,8.0,0.0,0.29702970297029707
the context of the cosmological/astrophysical model and evaluate if         tical models is the evaluation of model parameter degeneracies.,0.0,0.8201438848920863,0.17985611510791366,18.0,5.0,0.0,0.31188118811881194
the fitted model is a good representation of the observed data. The         We have discussed the fact that the parameters that describe the,0.0,0.7857142857142857,0.2142857142857143,23.0,5.0,0.0,0.306930693069307
last step will be the topic of this section. ¬ß 7.1 describes posterior,0.0,0.8285714285714286,0.17142857142857137,13.0,1.0,0.0,0.6534653465346535
predictive checks as a means to evaluate the goodness of fit of the,0.0,0.8208955223880597,0.17910447761194026,13.0,1.0,0.0,0.6683168316831682
model and in ¬ß 7.2 we propose a method to parametrize systematics           13  An example are models that do not have the form of a generalized linear,0.0,0.7549668874172185,0.2450331125827815,27.0,7.0,0.0,0.2524752475247525
"due to biased photometric likelihoods.                                      model (see, e.g., Gelman et al. 1996).",0.0,0.5789473684210527,0.42105263157894735,12.0,20.0,0.0,0.4356435643564357
"                                                                                                                            MNRAS 000, 1‚Äì22 (2015)",124.0,0.13013698630136986,0.8698630136986302,4.0,1.0,0.6138613861386139,0.27722772277227725
avr_spaces,20.014492753623188,1.0,0.0,1.0,1.0,0.09908164729516429,0.9504950495049505
                                                                                   Likelihood Inference under Photo-z error                            11,83.0,0.24836601307189543,0.7516339869281046,6.0,15.0,0.41089108910891087,0.24257425742574257
redshift-dependent galaxy-dark matter bias and the sample redshift,0.0,0.8939393939393939,0.10606060606060608,8.0,1.0,0.0,0.6732673267326732
distribution enter the clustering likelihood in a completely degener-,0.0,0.8840579710144928,0.1159420289855072,9.0,1.0,0.0,0.6584158415841583
"ate way. Accordingly, completely different nB -C(z) combinations                                                                         nR",0.0,0.4244604316546763,0.5755395683453237,9.0,37.0,0.0,0.31188118811881194
will produce the same data distribution. This therefore limits the,0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
information that can be obtained on nB depending on the prior in-,0.0,0.8307692307692308,0.16923076923076918,12.0,1.0,0.0,0.6782178217821782
"formation imposed on C(z). A combination with the photometric                              FÃÇ          z         nB        nB,sys         Œì",0.0,0.4676258992805755,0.5323741007194245,14.0,33.0,0.0,0.31188118811881194
"likelihood can help to break these degeneracies, as long as the SED",0.0,0.835820895522388,0.16417910447761197,12.0,1.0,0.0,0.6683168316831682
"modelling itself does not exhibit strong degeneracies, e.g. between                     NFilter                                               Nz‚àíhist",0.0,0.4899328859060403,0.5100671140939597,11.0,34.0,0.0,0.2623762376237624
the SED type and the redshift of galaxies. A dedicated study of,0.0,0.8253968253968254,0.17460317460317465,12.0,1.0,0.0,0.6881188118811881
model checking in color space is left for future work.                                 NGalaxy,0.0,0.5531914893617021,0.44680851063829785,11.0,17.0,0.0,0.5346534653465347
                                                                                                                             œÑ          C(z),125.0,0.03571428571428571,0.9642857142857143,2.0,6.0,0.6188118811881188,0.306930693069307
                                                                                                                                                 Ntomo,145.0,0.03333333333333333,0.9666666666666667,1.0,1.0,0.7178217821782178,0.25742574257425743
7.2    Parametrizing Systematics: Smoothing Kernel,0.0,0.86,0.14,5.0,3.0,0.0,0.7524752475247525
"In ¬ß8.3, we will discuss how miscalibrated likelihoods can lead to             Figure 4. Directed graphical representation of the statistical model de-",0.0,0.7880794701986755,0.21192052980132448,21.0,7.0,0.0,0.2524752475247525
systematic biases and uncertainties in the deconvolution operation.            scribed in this paper. Empty/filled circles denote random variables that,0.0,0.8145695364238411,0.1854304635761589,18.0,7.0,0.0,0.2524752475247525
Our goal in this section is to include a simple transformation into the        are latent/observed. ùëÅ (‚àó) denotes the dimensionality of the random vari-,0.0,0.8026315789473685,0.19736842105263153,24.0,5.0,0.0,0.24752475247524752
model that parametrizes these systematics. A simple choice is the              able. Boxes encapsulate random variables with the same dimensionality.,0.0,0.7919463087248322,0.20805369127516782,19.0,8.0,0.0,0.2623762376237624
"Gaussian convolution kernel, which modifies the sample redshift                Solid/dotted lines indicate random/deterministic relationships between ran-",0.0,0.8116883116883117,0.18831168831168832,15.0,9.0,0.0,0.2376237623762376
                                                                               dom variables.,79.0,0.13978494623655913,0.8602150537634409,2.0,1.0,0.3910891089108911,0.5396039603960396
distribution as,0.0,0.9333333333333333,0.06666666666666665,2.0,1.0,0.0,0.9257425742574258
                ‚à´             ‚à´,16.0,0.06451612903225806,0.935483870967742,2.0,7.0,0.07920792079207921,0.8465346534653465
"ùëù(ùëß|nB,sys ) =      dùùâ ùëù(ùùâ)        ùëù(ùëß|ùëß, ùùâ) ùëù(ùëß|nB ) dùëß .           (36)      sizes Œîùúéùëñ and Œîùúá = 0",0.0,0.5555555555555556,0.4444444444444444,18.0,16.0,0.0,0.5099009900990099
                                                                                                        ‚àëÔ∏Å,104.0,0.018867924528301886,0.9811320754716981,1.0,1.0,0.5148514851485149,0.4752475247524752
" Here nB,sys denotes the parameters that describe the sample red-              ùëù(nz ùêµ , C(z)|ùö™, FÃÇ) =        ùëù(Œîùúéùëñ |ùö™, FÃÇ) ùëù(nzB , C(z)|ùö™, FÃÇ, Œîùúéùëñ ) .",1.0,0.6933333333333334,0.30666666666666664,26.0,12.0,0.0049504950495049506,0.25742574257425743
shift distribution after the convolution is applied to the original                                     Œîùúéùëñ,0.0,0.5700934579439252,0.4299065420560748,11.0,19.0,0.0,0.47029702970297027
"sample redshift distribution ùëù(ùëß|nB ), where the convolution ker-                                                                                    (39)",0.0,0.39869281045751637,0.6013071895424836,10.0,43.0,0.0,0.24257425742574257
nel is a gaussian with standard deviation and shift in the mean,0.0,0.8253968253968254,0.17460317460317465,12.0,1.0,0.0,0.6881188118811881
                                                                               This assumes that there is no systematic shift in the sample redshift,79.0,0.3918918918918919,0.6081081081081081,12.0,1.0,0.3910891089108911,0.26732673267326734
"ùùâ = (Œîùúá, Œîùúé):",0.0,0.7692307692307693,0.23076923076923073,4.0,1.0,0.0,0.9356435643564356
"                                                                               distribution, and deviations from the true underlying distribution are",79.0,0.4161073825503356,0.5838926174496644,9.0,1.0,0.3910891089108911,0.2623762376237624
"                                 ""                    #                       due to miscalibrated but on average unbiased individual galaxy like-",33.0,0.4217687074829932,0.5782312925170068,13.0,21.0,0.16336633663366337,0.2722772277227723
                                     1 ùëß ‚àí ùëß + Œîùúá 2,37.0,0.1568627450980392,0.8431372549019608,7.0,1.0,0.18316831683168316,0.7475247524752475
                                       ,39.0,0.025,0.975,1.0,1.0,0.19306930693069307,0.801980198019802
                   1,19.0,0.05,0.95,1.0,1.0,0.09405940594059406,0.900990099009901
"ùëù(ùëß|ùëß, ùùâ) = ‚àöÔ∏É              exp ‚àí                                    (37)      lihoods. Furthermore, we will assume that ùëù(Œîùúéùëñ |ùö™, FÃÇ) = ùëù(Œîùúéùëñ ),",0.0,0.5103448275862069,0.4896551724137931,19.0,29.0,0.0,0.2821782178217822
                                     2       Œîùúé,37.0,0.06382978723404255,0.9361702127659575,2.0,4.0,0.18316831683168316,0.7673267326732673
"                (2ùúãŒîùúé) 2                                                       i.e., the smoothing size is a prior choice independent of the data that",16.0,0.44,0.56,15.0,28.0,0.07920792079207921,0.25742574257425743
                                                                               can be calibrated on simulations. For simplicity we will use a flat,79.0,0.3835616438356164,0.6164383561643836,12.0,1.0,0.3910891089108911,0.27722772277227725
 Assuming the same histogram parametrization for ùëù(ùëß|nB ) as for               prior ùëù(Œîùúé) here.,1.0,0.71875,0.28125,13.0,8.0,0.0049504950495049506,0.5247524752475248
"ùëù(ùëß|nB,sys ), we see that this implies an affine transformation nB ‚Üí   ‚àí",0.0,0.8055555555555556,0.19444444444444442,13.0,2.0,0.0,0.6435643564356436
A(ùúè) ¬∑ nB where the matrix A is given as,0.0,0.775,0.22499999999999998,10.0,1.0,0.0,0.801980198019802
                                                                               7.3     Complete model summary,79.0,0.21100917431192662,0.7889908256880733,4.0,3.0,0.3910891089108911,0.46039603960396036
                  ùõΩ     ùõΩ               !             ùõΩ     ùõΩ          !,18.0,0.08333333333333333,0.9166666666666666,6.0,23.0,0.0891089108910891,0.6435643564356436
              ùëó  ùëßùêª  ‚àí ùëßùêø                        ùëó ùëß     ‚àí ùëßùêø                  Here we review and summarize our complete model. We review,14.0,0.43795620437956206,0.5620437956204379,18.0,26.0,0.06930693069306931,0.32178217821782173
"ùê¥ùõΩ ùëó = Œ¶ ùëß ùêª                + Œîùúá, Œîùúé ‚àí Œ¶        ùëßùêø ùêª          + Œîùúá, Œîùúé         the structure of all components in ¬ß 7.3.1 and review the inference",0.0,0.547945205479452,0.452054794520548,28.0,22.0,0.0,0.27722772277227725
                     2                                   2,21.0,0.034482758620689655,0.9655172413793104,2.0,18.0,0.10396039603960396,0.7128712871287128
                                                          ùõΩ ùõΩ              strategy in ¬ß 7.3.2.,24.0,0.23232323232323232,0.7676767676767677,9.0,24.0,0.1188118811881188,0.5099009900990099
                            ùõΩ    ùõΩ,28.0,0.058823529411764705,0.9411764705882353,2.0,3.0,0.13861386138613863,0.8316831683168316
                   ùëó      ùëß ùêª ‚àíùëß ùêø                     ùëó    ùëß ‚àíùëß,19.0,0.15625,0.84375,8.0,16.0,0.09405940594059406,0.6831683168316831
            ¬© ¬© ùëßùêª    ‚àí       2      ‚àí Œîùúá  ¬™       ¬© ùëß ‚àí ùêª 2 ùêø ‚àí Œîùúá ¬™¬™,12.0,0.3,0.7,17.0,13.0,0.0594059405940594,0.6534653465346535
         1 ¬≠¬≠ ¬≠¬≠                           ¬Æ       ¬≠ ùêø                    ¬Æ¬Æ,9.0,0.13157894736842105,0.868421052631579,7.0,27.0,0.04455445544554455,0.6237623762376238
"      = ¬≠erf ¬≠                 ‚àö           ¬Æ ‚àí erf ¬≠           ‚àö          ¬Æ¬Æ , 7.3.1     Model Structure",6.0,0.34615384615384615,0.6538461538461539,14.0,26.0,0.0297029702970297,0.48514851485148514
         2¬≠ ¬≠             Œîùúé 2                              Œîùúé 2,9.0,0.140625,0.859375,6.0,22.0,0.04455445544554455,0.6831683168316831
                                           ¬Æ       ¬≠                      ¬Æ¬Æ,43.0,0.05263157894736842,0.9473684210526316,3.0,15.0,0.21287128712871287,0.6237623762376238
                                           ¬Æ       ¬≠                      ¬Æ¬Æ,43.0,0.05263157894736842,0.9473684210526316,3.0,15.0,0.21287128712871287,0.6237623762376238
            ¬´ ¬´                            ¬¨       ¬´                      ¬¨¬¨   Fig. 4 summarizes the joint inference strategy presented in the previ-,12.0,0.4429530201342282,0.5570469798657718,16.0,30.0,0.0594059405940594,0.2623762376237624
                                                                     (38)      ous sections in a directed graphical model. Each random variable is,69.0,0.4178082191780822,0.5821917808219178,12.0,4.0,0.3415841584158416,0.27722772277227725
"                                                                               denoted as a circle, probabilistic/deterministic relationships are de-",79.0,0.4228187919463087,0.5771812080536913,8.0,1.0,0.3910891089108911,0.2623762376237624
where Œ¶ denotes the cumulative distribution function of a nor-                 noted as solid/dotted lines. Boxes around random variables denote,0.0,0.7638888888888888,0.23611111111111116,19.0,9.0,0.0,0.28712871287128716
mal distribution and erf the error function. We choose a Gaussian              the dimensionality of the random variable. For example the color,0.0,0.7692307692307693,0.23076923076923073,21.0,8.0,0.0,0.2920792079207921
smoothing kernel since it has been shown that unbiased cosmologi-              vector fùëñ is an ùëÅfilter dimensional random variable for ùëÅgalaxies in,0.0,0.7755102040816326,0.22448979591836737,21.0,8.0,0.0,0.2722772277227723
cal inference from measurements of weak lensing and LSS critically             ùëÅtomo tomographic bins. Filled circles denote observed random,0.0,0.7928571428571428,0.20714285714285718,18.0,7.0,0.0,0.306930693069307
"depends on accurate recovery on the mean and standard deviation of             variables, in our case the photometry FÃÇ and the cross correlation",0.0,0.7724137931034483,0.22758620689655173,22.0,7.0,0.0,0.2821782178217822
the photometric sample redshift distribution. Biases in both of these          ratios ùö™.,0.0,0.7727272727272727,0.2272727272727273,12.0,6.0,0.0,0.5643564356435644
statistics can be parametrized using this kernel. In contrast to the                  The graphical model is structured into three parts: the left,0.0,0.7465753424657534,0.2534246575342466,21.0,10.0,0.0,0.27722772277227725
"normal distribution, which exhibits a closed form solution under an            part represents the photometric likelihood, the middle bullets de-",0.0,0.8,0.19999999999999996,19.0,7.0,0.0,0.2821782178217822
"affine transformation, the logit-normal does not have this property.           scribe our treatment of systematics, and the right part describes the",0.0,0.8040540540540541,0.19594594594594594,20.0,6.0,0.0,0.26732673267326734
"However we empirically find that we can approximate the shape                  clustering redshift likelihood, which depends on the spectroscopic",0.0,0.7655172413793103,0.23448275862068968,18.0,10.0,0.0,0.2821782178217822
of the distribution after an affine transformation as a logit-normal           redshift distribution and the redshift-dependent galaxy-dark matter,0.0,0.821917808219178,0.17808219178082196,17.0,6.0,0.0,0.27722772277227725
"distribution to good accuracy. For a given set of ùùâ, we can find the           bias ratio.",0.0,0.7222222222222222,0.2777777777777778,16.0,6.0,0.0,0.5544554455445545
updated parameter values by assumed density filtering.                                The structure of the graph illustrates the construction of the,0.0,0.6824324324324325,0.31756756756756754,17.0,17.0,0.0,0.26732673267326734
"      While marginalization using sampling techniques is possible,             model via the composite likelihood ansatz discussed in ¬ß 6. It sep-",6.0,0.7534246575342466,0.2465753424657534,19.0,7.0,0.0297029702970297,0.27722772277227725
we choose a computationally efficient approximation and marginal-              arates the two data sources FÃÇ and ùö™ in the left and right part of,0.0,0.7586206896551724,0.24137931034482762,23.0,8.0,0.0,0.2821782178217822
ize over a discrete model set that consists of different smoothing             the graph. As we are mainly interested in performing inferences on,0.0,0.7724137931034483,0.22758620689655173,22.0,7.0,0.0,0.2821782178217822
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,19.0,1.0,0.0,1.0,1.0,0.09405940594059406,0.9504950495049505
12,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
"the nB variables, we marginalize over the ùëß variables, which pro-",0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
vides significant computational advantages. The mapping between,0.0,0.9047619047619048,0.09523809523809523,7.0,1.0,0.0,0.6881188118811881
"nB and nB,sys takes the form of a deterministic transformation and",0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
is therefore indicated by a dotted line.,0.0,0.85,0.15000000000000002,7.0,1.0,0.0,0.801980198019802
"      While n ùëÖ is here treated as a random variable, its ‚Äòshot noise‚Äô",6.0,0.7428571428571429,0.2571428571428571,13.0,1.0,0.0297029702970297,0.6534653465346535
uncertainties are very small for the considered sample sizes of the,0.0,0.8507462686567164,0.14925373134328357,11.0,1.0,0.0,0.6683168316831682
spectroscopic sample. We therefore decided to fix its value to the,0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"maximum likelihood value, i.e., the histogram height.",0.0,0.8867924528301887,0.1132075471698113,7.0,1.0,0.0,0.7376237623762376
7.3.2    Model Inference,0.0,0.7916666666666666,0.20833333333333337,3.0,3.0,0.0,0.8811881188118812
The presented model consists of two likelihood terms and a de-,0.0,0.8387096774193549,0.16129032258064513,11.0,1.0,0.0,0.693069306930693
"terministic transformation nB ‚Üí nB,sys . Starting with the pho-",0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"tometric likelihood, we employ the inference scheme detailed in",0.0,0.873015873015873,0.12698412698412698,9.0,1.0,0.0,0.6881188118811881
Appendices A and B that results in a posterior ùëù(nB | FÃÇ) de-,0.0,0.8032786885245902,0.19672131147540983,13.0,1.0,0.0,0.698019801980198
fined in Eq. (16). We then employ the transformation detailed in,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
¬ß 7.2 to parametrize systematics in the inferred posterior from,0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
biased photometric likelihoods. This yields a systematics cor-                Figure 5. The top three panels show cross-correlation measurements be-,0.0,0.7837837837837838,0.21621621621621623,18.0,9.0,0.0,0.26732673267326734
"rected posterior ùëù(nB,sys | FÃÇ) using the methodology described in            tween the photometric base sample and the spectroscopic reference sample",0.0,0.8,0.19999999999999996,20.0,7.0,0.0,0.25742574257425743
¬ß 7.2. The final combination with the clustering likelihood term              ùë§ RB and correlation function measurements of the spectroscopic reference,0.0,0.7880794701986755,0.21192052980132448,20.0,8.0,0.0,0.2524752475247525
"ùëù(nB,sys , C(z)| FÃÇ, ùö™) ‚àù ùëù(ùö™|nB,sys , C(z)) ùëù(nB,sys | FÃÇ) is then per-      sample ùë§ RR for 3 different annuli (see ¬ß 5) as a function of redshift. The",0.0,0.7712418300653595,0.2287581699346405,31.0,4.0,0.0,0.24257425742574257
formed using a Monte Carlo Markov chain (MCMC) sampling ap-                   errorbars correspond to the ¬±1ùúé measurement errors of the correlation,0.0,0.7482993197278912,0.2517006802721088,20.0,10.0,0.0,0.2722772277227723
proach.                                                                       function measurements. The lowest panel plots the true sample redshift,0.0,0.4594594594594595,0.5405405405405406,11.0,36.0,0.0,0.26732673267326734
"      We update the parameters (nB,sys , C(z)) in two sampling                probability density function of the spectroscopic reference sample (‚ÄòSpec.‚Äô)",6.0,0.7467532467532467,0.2532467532467533,19.0,9.0,0.0297029702970297,0.2376237623762376
blocks: the set of parameters that describe the redshift distribu-            and the photometric base sample (‚ÄòPhot.‚Äô).,0.0,0.7833333333333333,0.21666666666666667,16.0,7.0,0.0,0.40594059405940597
"tion of the base sample nB,sys and the parameters c that describe the",0.0,0.8260869565217391,0.17391304347826086,13.0,1.0,0.0,0.6584158415841583
evolution of the redshift-dependent galaxy-dark matter bias ratio,0.0,0.8923076923076924,0.10769230769230764,8.0,1.0,0.0,0.6782178217821782
                                                                              therefore study the impact of likelihood mis-specification on the,78.0,0.3986013986013986,0.6013986013986015,9.0,1.0,0.38613861386138615,0.2920792079207921
C(z).,0.0,1.0,0.0,1.0,1.0,0.0,0.9752475247524752
                                                                              inference in ¬ß 8.3. In particular we will evaluate the performance,78.0,0.3888888888888889,0.6111111111111112,11.0,1.0,0.38613861386138615,0.28712871287128716
"      Concretely, we iteratively sample from the conditional distribu-",6.0,0.8142857142857143,0.18571428571428572,8.0,1.0,0.0297029702970297,0.6534653465346535
                                                                              of our methodology by comparing with science requirements of the,78.0,0.3873239436619718,0.6126760563380282,10.0,1.0,0.38613861386138615,0.29702970297029707
"tions ùëù(nB,sys | FÃÇ, ùö™, c) and then from ùëù(c| FÃÇ, ùö™,",0.0,0.7884615384615384,0.21153846153846156,12.0,1.0,0.0,0.7425742574257426
"                                                  ÀÜ nB,sys ). This means",50.0,0.25,0.75,5.0,1.0,0.24752475247524752,0.6435643564356436
                                                                              first year (‚ÄòLSST Y1‚Äô) and the 10th year (‚ÄòLSST Y10‚Äô) of the LSST,78.0,0.3706293706293706,0.6293706293706294,13.0,1.0,0.38613861386138615,0.2920792079207921
"that we iteratively sample each parameter block in turn, while hold-",0.0,0.8529411764705882,0.1470588235294118,11.0,1.0,0.0,0.6633663366336633
                                                                              data release defined in The LSST Dark Energy Science Collabora-,78.0,0.3829787234042553,0.6170212765957447,10.0,1.0,0.38613861386138615,0.301980198019802
ing the other parameter block fixed. The sampling method that can,0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
                                                                              tion et al. (2018). We note that we will utilize a mock simulation of,78.0,0.38095238095238093,0.6190476190476191,14.0,1.0,0.38613861386138615,0.2722772277227723
be employed to update each parameter blocks is flexible14 . We use a,0.0,0.8235294117647058,0.17647058823529416,13.0,1.0,0.0,0.6633663366336633
                                                                              galaxy photometry likelihoods in ¬ß 8.2 instead of SED likelihoods,78.0,0.3916083916083916,0.6083916083916083,10.0,1.0,0.38613861386138615,0.2920792079207921
Metropolis-Hastings sampling scheme to sample the c parameters.,0.0,0.8888888888888888,0.11111111111111116,8.0,1.0,0.0,0.6881188118811881
"                                                                              constructed on the simulated photometry, because the simulated",78.0,0.39285714285714285,0.6071428571428572,8.0,1.0,0.38613861386138615,0.306930693069307
"To sample from the conditional ùëù(nB,sys | FÃÇ, ùö™, c) we also employ a",0.0,0.8088235294117647,0.19117647058823528,14.0,1.0,0.0,0.6633663366336633
                                                                              photometry of the DC2 simulations showed a discontinuous color-,78.0,0.3900709219858156,0.6099290780141844,9.0,1.0,0.38613861386138615,0.301980198019802
"Metropolis scheme, however we perform the sampling not in terms",0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"                                                                              redshift mapping, which induced an unrealistically large error in",78.0,0.3986013986013986,0.6013986013986015,9.0,1.0,0.38613861386138615,0.2920792079207921
"of the nB,sys parameters, but in logit space, i.e. in terms of the",0.0,0.8181818181818182,0.18181818181818177,13.0,1.0,0.0,0.6732673267326732
"                                                                              our template fitting results. In ¬ß 8.3, which will discuss aspects",78.0,0.3888888888888889,0.6111111111111112,11.0,1.0,0.38613861386138615,0.28712871287128716
"y parameters that are connected with nB,sys , or their normalized",0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
                                                                              of model checking and will not interpret results in the context of,78.0,0.3819444444444444,0.6180555555555556,12.0,1.0,0.38613861386138615,0.28712871287128716
"analog ùúã sys , via Eq. (B1). In this way we can utilize proposal dis-",0.0,0.7971014492753623,0.2028985507246377,15.0,1.0,0.0,0.6584158415841583
"                                                                              LSST science requirements, we will use both Machine Learning",78.0,0.37681159420289856,0.6231884057971014,9.0,1.0,0.38613861386138615,0.3168316831683168
tributions that are defined in real space to sample a distribution,0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
                                                                              and Template Fitting methods described in ¬ß 2.1.,78.0,0.3253968253968254,0.6746031746031746,8.0,1.0,0.38613861386138615,0.37623762376237624
"defined on the simplex. We reiterate that the posterior ùëù(nB | FÃÇ) has,",0.0,0.8309859154929577,0.16901408450704225,13.0,1.0,0.0,0.6485148514851485
"in our framework, an analytical form and sampling is therefore very",0.0,0.8507462686567164,0.14925373134328357,11.0,1.0,0.0,0.6683168316831682
efficient. However if we include a treatment of systematics or a              8.1    Measuring Cross-Correlations,0.0,0.7433628318584071,0.2566371681415929,14.0,10.0,0.0,0.44059405940594054
"clustering redshift likelihood into the inference, we need to employ",0.0,0.8676470588235294,0.13235294117647056,10.0,1.0,0.0,0.6633663366336633
sampling approaches because the posterior has no longer a closed              We use the software package ‚Äòthe-wizz‚Äô15 (Morrison et al. 2017) to,0.0,0.7708333333333334,0.22916666666666663,21.0,8.0,0.0,0.28712871287128716
form solution.                                                                measure cross-correlations between the reference (spectroscopic),0.0,0.5070422535211268,0.49295774647887325,8.0,33.0,0.0,0.29702970297029707
                                                                              and base (photometric) samples ùë§ RB and correlations of the refer-,78.0,0.3888888888888889,0.6111111111111112,11.0,1.0,0.38613861386138615,0.28712871287128716
"                                                                              ence sample ùë§ RR in 20 equally spaced redshift bins from ùëß ‚àà (0, 3),",78.0,0.3698630136986301,0.6301369863013699,15.0,1.0,0.38613861386138615,0.27722772277227725
                                                                              corresponding to 3042 Mpc comoving distance at the mean redshift,78.0,0.3873239436619718,0.6126760563380282,10.0,1.0,0.38613861386138615,0.29702970297029707
8    FORECAST USING SIMULATION DATA                                           of hùëßi = 0.88. Fig. 5 shows these measurements in the three top pan-,0.0,0.5684931506849316,0.43150684931506844,19.0,24.0,0.0,0.27722772277227725
"To demonstrate the effectiveness of our inference methodology, we             els for three annuli (see ¬ß 5) of 0.01 ‚àí 0.1 Mpc, 0.1 ‚àí 1.0 Mpc and",0.0,0.7448275862068966,0.2551724137931034,26.0,7.0,0.0,0.2821782178217822
consider an idealized setup which allows us to forecast the con-              1.0‚àí10 Mpc. In the lowest panel we show the sample redshift proba-,0.0,0.7569444444444444,0.24305555555555558,23.0,8.0,0.0,0.28712871287128716
straints on the sample redshift distribution that we can expect from          bility density functions for the reference and base samples. The cor-,0.0,0.7959183673469388,0.20408163265306123,22.0,6.0,0.0,0.2722772277227723
a DESI-like spectroscopic survey overlapping with the LSST Y10                relations wRR are larger than the cross-correlations wRB in all three,0.0,0.7687074829931972,0.23129251700680276,20.0,9.0,0.0,0.2722772277227723
"footprint. We assume in this section that the composite likelihood            panels, implying on average a lower than unity ratio ùëè B (ùëß)/ùëè R (ùëß).",0.0,0.7687074829931972,0.23129251700680276,24.0,7.0,0.0,0.2722772277227723
"is well calibrated, both in the clustering and in the template fit-           The errorbars increase with redshift due to the decreasing number",0.0,0.7832167832167832,0.21678321678321677,22.0,6.0,0.0,0.2920792079207921
"ting part. This assumption will likely not hold in practice and we            of galaxies, leading to a larger shot noise error. Consider the shape",0.0,0.7687074829931972,0.23129251700680276,24.0,7.0,0.0,0.2722772277227723
"                                                                              of wRR and wRB for the largest annuli [1.0 ‚àí 10.] Mpc, in the low",78.0,0.35664335664335667,0.6433566433566433,15.0,1.0,0.38613861386138615,0.2920792079207921
                                                                              redshift range of ùëß < 1.0. We see that the measurements of wRB,78.0,0.35714285714285715,0.6428571428571428,13.0,1.0,0.38613861386138615,0.306930693069307
14  We tried several approaches like Hamiltonian MCMC or Elliptical Slice,0.0,0.8493150684931506,0.15068493150684936,11.0,2.0,0.0,0.6386138613861386
sampling. All approaches work well; we discuss here the structurally simplest,0.0,0.8701298701298701,0.1298701298701299,11.0,1.0,0.0,0.6188118811881188
scheme.                                                                       15  https://github.com/morriscb/the-wizz,0.0,0.3813559322033898,0.6186440677966102,3.0,37.0,0.0,0.4158415841584159
"                                                                                                                               MNRAS 000, 1‚Äì22 (2015)",127.0,0.12751677852348994,0.87248322147651,4.0,1.0,0.6287128712871287,0.2623762376237624
avr_spaces,21.5,1.0,0.0,1.0,1.0,0.10643564356435643,0.9504950495049505
                                                                                                Likelihood Inference under Photo-z error                                      13,96.0,0.2159090909090909,0.7840909090909091,6.0,20.0,0.4752475247524752,0.12871287128712872
and wRR roughly resemble the shape of the reference and base sam-                                               Galaxy-DM Bias Ratio Scale/z-Dependence (¬±1 ),0.0,0.5987261146496815,0.4012738853503185,18.0,24.0,0.0,0.22277227722772275
"ple redshift distributions (lowest panel), implying a roughly linear                                          2.0",0.0,0.5575221238938053,0.4424778761061947,10.0,22.0,0.0,0.44059405940594054
ratio ùëè ùêµ (ùëß)/ùëè ùëÖ (ùëß) in this redshift range (compare with Fig. 6).,0.0,0.8059701492537313,0.19402985074626866,14.0,1.0,0.0,0.6683168316831682
"For smaller annuli, the change in slope around ùëß = 0.5 is less pro-                                           1.5",0.0,0.504424778761062,0.49557522123893805,15.0,22.0,0.0,0.44059405940594054
                                                                                  Bias Ratio b B(z)/b R(z),82.0,0.18867924528301888,0.8113207547169812,5.0,1.0,0.40594059405940597,0.4752475247524752
"nounced, producing a step around ùëß = 0.5 in the galaxy-dark matter",0.0,0.8333333333333334,0.16666666666666663,12.0,1.0,0.0,0.6732673267326732
"bias ratio. At the high-redshift tail, where the redshift distribution                                        1.0     Mag-Lim LRG         ELG         QSO",0.0,0.5228758169934641,0.4771241830065359,15.0,31.0,0.0,0.24257425742574257
"of the reference sample flattens out, we see that wRB and wRR are",0.0,0.8153846153846154,0.18461538461538463,13.0,1.0,0.0,0.6782178217821782
"approximately equal. Here, the sample redshift distribution of the                                            0.5",0.0,0.5398230088495575,0.4601769911504425,10.0,23.0,0.0,0.44059405940594054
base sample is larger than the one of the reference sample. Since,0.0,0.8307692307692308,0.16923076923076918,12.0,1.0,0.0,0.6782178217821782
the QSO sample will have a larger galaxy-dark matter bias than the                                            0.0,0.0,0.5132743362831859,0.48672566371681414,13.0,23.0,0.0,0.44059405940594054
"base sample, we can expect ùëè ùêµ (ùëß)/ùëè ùëÖ (ùëß) < 1.0 at high redshift.",0.0,0.7878787878787878,0.21212121212121215,15.0,1.0,0.0,0.6732673267326732
In order to represent a 5000 deg2 overlap between DESI and LSST                                               0.5         0.01 0.10 Mpc,0.0,0.4888888888888889,0.5111111111111111,16.0,28.0,0.0,0.33168316831683164
                                                                                                                          0.1 1.0 Mpc (Fiducial Choice),122.0,0.16556291390728478,0.8344370860927153,5.0,1.0,0.6039603960396039,0.2524752475247525
"Y10, using measurements obtained on the the 300 deg2 CosmoDC2                                                             1.00 10.00 Mpc",0.0,0.47058823529411764,0.5294117647058824,13.0,31.0,0.0,0.3267326732673267
"simulations, we scale the error on these measurements by a factor                                                   0.0     0.5        1.0        1.5       2.0   2.5   3.0",0.0,0.4444444444444444,0.5555555555555556,18.0,41.0,0.0,0.1534653465346535
of 4 in the following analyses.                                                                                                               Redshift z,0.0,0.23026315789473684,0.7697368421052632,8.0,56.0,0.0,0.24752475247524752
      We would like to generate a cross-correlation likelihood that,6.0,0.7910447761194029,0.20895522388059706,9.0,1.0,0.0297029702970297,0.6683168316831682
allows us full control over the imposed redshift-dependent galaxy-               Figure 6. Galaxy-dark matter bias ratio as a function of redshift for different,0.0,0.78125,0.21875,22.0,8.0,0.0,0.20792079207920788
"dark matter bias ratio model and that has roughly16 the correct                  scales. We show here the [16, 84] percentiles, that correspond to ¬±1ùúé for",0.0,0.7402597402597403,0.2597402597402597,24.0,10.0,0.0,0.2376237623762376
"width of the full DESI area. Furthermore, since the mean of the                  a Normal distribution. The redshift ranges of the different spectroscopic",0.0,0.7532467532467533,0.24675324675324672,22.0,10.0,0.0,0.2376237623762376
"ratio distribution depends on both the mean and the variance of                  subsamples are plotted by vertical lines. Within these ranges, the bias ratio",0.0,0.7531645569620253,0.24683544303797467,23.0,10.0,0.0,0.2178217821782178
"wRB and wRR , scaling the measurement error will induce biases                   is a relatively smooth function of redshift, indicating a smooth redshift",0.0,0.7467532467532467,0.2532467532467533,22.0,10.0,0.0,0.2376237623762376
in the mean of this ratio and therefore in the reconstructed sample              dependence of the galaxy-dark matter bias of the photometric sample. At,0.0,0.7697368421052632,0.23026315789473684,23.0,8.0,0.0,0.24752475247524752
"                                                                                 the borders of these ranges, the bias ratio curves are discontinuous.",81.0,0.3933333333333333,0.6066666666666667,11.0,1.0,0.400990099009901,0.25742574257425743
photometric redshift distribution.,0.0,0.9411764705882353,0.05882352941176472,3.0,1.0,0.0,0.8316831683168316
      To correct for possible biases that would occur when the mea-,6.0,0.7611940298507462,0.23880597014925375,11.0,1.0,0.0297029702970297,0.6683168316831682
surements errors are naively scaled and allow for better control over            Furthermore we want to have control over the underlying redshift,0.0,0.7862068965517242,0.21379310344827585,21.0,7.0,0.0,0.2821782178217822
"the redshift dependent galaxy-dark matter bias ratio, we first fit the           dependent galaxy-dark matter bias model to eliminate any additional",0.0,0.8040540540540541,0.19594594594594594,20.0,6.0,0.0,0.26732673267326734
galaxy-dark matter bias ratio ùê∂ (ùëß) to the original data within these            specification error. It should therefore merely be seen as an approx-,0.0,0.78,0.21999999999999997,23.0,7.0,0.0,0.25742574257425743
20 bins. We show the results of this fit in Fig. 6 for different ranges          imate forecast of the constraining power that cross-correlations will,0.0,0.7866666666666666,0.21333333333333337,24.0,6.0,0.0,0.25742574257425743
in physical distance and indicate the redshift range of the differ-              add to the composite likelihood and a demonstration of the inference,0.0,0.7718120805369127,0.22818791946308725,22.0,8.0,0.0,0.2623762376237624
"ent spectroscopic samples by vertical lines, where these limits are              methodology. It is not an accurate treatment of galaxy-dark matter",0.0,0.782312925170068,0.217687074829932,20.0,8.0,0.0,0.2722772277227723
meant to guide the eye and do not constitute sharp breaks (com-                  bias or the correlation function measurements expected in the final,0.0,0.7432432432432432,0.2567567567567568,22.0,10.0,0.0,0.26732673267326734
"pare with Fig. 1). We see that within these redshift ranges, ùê∂ (ùëß) is a          LSST measurement. For this we would require a more realistic sim-",0.0,0.7671232876712328,0.23287671232876717,26.0,6.0,0.0,0.27722772277227725
"smooth function and can be fitted by a 3rd degree Chebychev polyno-              ulation of the DESI-like spectroscopic sample, the final area and a",0.0,0.7635135135135135,0.2364864864864865,23.0,8.0,0.0,0.26732673267326734
              √ç,14.0,0.06666666666666667,0.9333333333333333,1.0,1.0,0.06930693069306931,0.9257425742574258
"mial ùê∂ (ùëß) = 3ùëñ=1 ùëê ùëñ ùëáùëñ (ùëß). Here, ùëáùëñ (ùëß) denote Chebychev functions            much better understanding of the galaxy-dark matter bias of each",0.0,0.7586206896551724,0.24137931034482762,25.0,7.0,0.0,0.2821782178217822
"and ùëê ùëñ denotes the expansion coefficients. Within the three redshift            galaxy population, all of which are subjects of active investigation",0.0,0.7919463087248322,0.20805369127516782,21.0,7.0,0.0,0.2623762376237624
"ranges {[0.0, 0.5], [0.5, 0.8], [0.8, 3.0]}, we perform a regression             in the field.",0.0,0.7340425531914894,0.26595744680851063,14.0,7.0,0.0,0.5346534653465347
fit to the median of the ùê∂ (ùëß) posterior due its heavy tails. For the,0.0,0.7971014492753623,0.2028985507246377,15.0,1.0,0.0,0.6584158415841583
"following analysis we select the median annuli of 0.1‚àí1 Mpc, which",0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"provides good signal-to-noise, while being less sensitive to small               8.2                         Applying the Model",0.0,0.6062992125984252,0.39370078740157477,13.0,20.0,0.0,0.3712871287128713
"scale effects, than the 0.01 ‚àí 0.1 Mpc bin, for which accurate mod-",0.0,0.8208955223880597,0.17910447761194026,13.0,1.0,0.0,0.6683168316831682
                                                                                 For the photometric part of the composite likelihood we assume a,81.0,0.3724137931034483,0.6275862068965516,11.0,1.0,0.400990099009901,0.2821782178217822
"elling of galaxy-dark matter bias will be more difficult. However,",0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
"                                                                                 redshift scaling of ùúé(ùëß) = 0.02 (1 + ùëß), where ùëß denotes the true, or",81.0,0.36666666666666664,0.6333333333333333,15.0,1.0,0.400990099009901,0.25742574257425743
"we are still considering the non-linear regime, in which more work",0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"                                                                                 spectroscopic, redshift. This scaling is a photometric redshift perfor-",81.0,0.4144736842105263,0.5855263157894737,9.0,1.0,0.400990099009901,0.24752475247524752
is needed to model the galaxy-dark matter bias.,0.0,0.851063829787234,0.14893617021276595,8.0,1.0,0.0,0.7673267326732673
                                                                                 mance benchmark for LSST frequently adopted in the literature (e.g.,81.0,0.3918918918918919,0.6081081081081081,10.0,1.0,0.400990099009901,0.26732673267326734
      We scale the correlation functions ùë§ ùëÖùëÖ and ùë§ ùëÖùêµ defined in,6.0,0.7384615384615385,0.2615384615384615,12.0,1.0,0.0297029702970297,0.6782178217821782
                                                                                 Graham et al. 2020) and defined in the LSST science requirements,81.0,0.3724137931034483,0.6275862068965516,11.0,1.0,0.400990099009901,0.2821782178217822
"Eq. (26) and forecast a new data vector for ùë§ ùëÖùêµ , while holding the",0.0,0.7941176470588235,0.20588235294117652,15.0,1.0,0.0,0.6633663366336633
                                                                                 document17 . We then generate a mock catalog by sampling values,81.0,0.3680555555555556,0.6319444444444444,11.0,1.0,0.400990099009901,0.28712871287128716
measurement of ùë§ ùëÖùëÖ fixed. This amounts to multiplying the ratio,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
                                                                                 from the true sample redshift distribution and generate a catalog of,81.0,0.38926174496644295,0.610738255033557,11.0,1.0,0.400990099009901,0.2623762376237624
wRB /wRR by a constant for each redshift bin that compensates for,0.0,0.8307692307692308,0.16923076923076918,12.0,1.0,0.0,0.6782178217821782
                                                                                 mock likelihoods by scattering these values within this redshift error,81.0,0.40397350993377484,0.5960264900662251,10.0,1.0,0.400990099009901,0.2524752475247525
the difference in the mean of the reconstructed sample photometric,0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
                                                                                 model. We reiterate that we assume here that the redshift likelihoods,81.0,0.3933333333333333,0.6066666666666667,11.0,1.0,0.400990099009901,0.25742574257425743
redshift distribution before and after we impose the fitted redshift,0.0,0.8676470588235294,0.13235294117647056,10.0,1.0,0.0,0.6633663366336633
"                                                                                 constructed from the galaxies‚Äô photometry, mimicked here by the",81.0,0.3819444444444444,0.6180555555555556,9.0,1.0,0.400990099009901,0.28712871287128716
dependent galaxy-dark matter bias model and perform the scaling.,0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
"                                                                                 aforementioned redshift error model, is perfectly known. We note",81.0,0.38620689655172413,0.6137931034482759,9.0,1.0,0.400990099009901,0.2821782178217822
In this way we ensure that our ratio distribution is self-consistent,0.0,0.8529411764705882,0.1470588235294118,11.0,1.0,0.0,0.6633663366336633
                                                                                 that this is an idealized assumption that we impose to demonstrate,81.0,0.38095238095238093,0.6190476190476191,11.0,1.0,0.400990099009901,0.2722772277227723
with the photometric sample redshift distribution. We then use,0.0,0.8709677419354839,0.12903225806451613,9.0,1.0,0.0,0.693069306930693
                                                                                 the methodology described in the previous sections.,81.0,0.3409090909090909,0.6590909090909092,7.0,1.0,0.400990099009901,0.3465346534653465
these adjusted measurements in the composite likelihood (Eq. 34).,0.0,0.8769230769230769,0.12307692307692308,9.0,1.0,0.0,0.6782178217821782
                                                                                       Tab. 1 summarizes the different configurations we use in this,87.0,0.35135135135135137,0.6486486486486487,10.0,1.0,0.4306930693069307,0.26732673267326734
This correction is necessary because we would otherwise merely,0.0,0.8709677419354839,0.12903225806451613,9.0,1.0,0.0,0.693069306930693
                                                                                 work. In particular we investigate posteriors obtained using several,81.0,0.40268456375838924,0.5973154362416108,9.0,1.0,0.400990099009901,0.2623762376237624
"use noisy measurements with wrongly decreased errorbars, which",0.0,0.8870967741935484,0.11290322580645162,8.0,1.0,0.0,0.693069306930693
"                                                                                 different sample sizes and regularization techniques. In particular,",81.0,0.40939597315436244,0.5906040268456376,8.0,1.0,0.400990099009901,0.2623762376237624
will lead to biases in the probability calibration of any inference.,0.0,0.8529411764705882,0.1470588235294118,11.0,1.0,0.0,0.6633663366336633
                                                                                 the first and second columns show the abbreviation used in the,81.0,0.36363636363636365,0.6363636363636364,11.0,1.0,0.400990099009901,0.2920792079207921
                                                                                 text and the corresponding figure. The generated sample size of the,81.0,0.38513513513513514,0.6148648648648649,11.0,1.0,0.400990099009901,0.26732673267326734
                                                                                 mock catalog is shown in the third column. The columns ‚ÄòTikhonov,81.0,0.3724137931034483,0.6275862068965516,11.0,1.0,0.400990099009901,0.2821782178217822
16  The uncertainty in the correlation function measurements will likely,0.0,0.8611111111111112,0.13888888888888884,10.0,2.0,0.0,0.6435643564356436
differ from this factor of four scaling in the real data. Our treatment of the,0.0,0.8205128205128205,0.17948717948717952,15.0,1.0,0.0,0.6138613861386139
cross-correlation data vector here is approximate and will be complemented       17 https://docushare.lsst.org/docushare/dsweb/Get/LPM-17,0.0,0.8759124087591241,0.12408759124087587,12.0,4.0,0.0,0.32178217821782173
in future work.                                                                  (page 4),0.0,0.2247191011235955,0.7752808988764045,5.0,34.0,0.0,0.5594059405940595
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,22.76744186046512,1.0,0.0,1.0,1.0,0.11271010822012435,0.9504950495049505
14,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
Figure 7. Left panel: Posteriors of the sample redshift probability density function ùëù (ùëß) of the photometric sample (short: photometric redshift distribution),0.0,0.8679245283018868,0.13207547169811318,22.0,1.0,0.0,0.21287128712871284
"parametrized by the parameters nB for different setups listed in Tab. 1. The x-axis shows the redshift value ùëß, the y-axis the value of the nB parameters. The",0.0,0.8291139240506329,0.1708860759493671,28.0,1.0,0.0,0.2178217821782178
"errorbars are the [16, 84] percentiles, which would correspond to 1ùúé intervals for a normal distribution. The black dashed curve shows the spectroscopic",0.0,0.8552631578947368,0.14473684210526316,23.0,1.0,0.0,0.24752475247524752
"redshift distribution in the binning used by the cross-correlation measurements. We consider four cases, and refer to Tab. 1 and ¬ß 8 for details on the experimental",0.0,0.8414634146341463,0.1585365853658537,27.0,1.0,0.0,0.18811881188118806
"setup. We highlight a variance-dominated posterior ‚ÄòSmall Sample (50k)‚Äô, which shows a characteristic alternating, or ‚Äòzig-zag‚Äô pattern, as well as a comparison",0.0,0.86875,0.13124999999999998,22.0,1.0,0.0,0.20792079207920788
"between the cyan ‚ÄòMedium Sample (500k)‚Äô and ‚ÄòMedium Sample (500k), Fid. Setup + WX‚Äô posteriors. Here, the latter includes a cross-correlation ‚ÄòWX‚Äô data",0.0,0.8543046357615894,0.14569536423841056,23.0,1.0,0.0,0.2524752475247525
vector in its likelihood. This reduces the error especially in the high-redshift tail of the distributions. Right panel: The y-axis shows the relative difference,0.0,0.8571428571428571,0.1428571428571429,24.0,1.0,0.0,0.20297029702970293
between the posterior of the photometric redshift distribution parametrized by the nB                                                                     B,0.0,0.4838709677419355,0.5161290322580645,13.0,35.0,0.0,0.23267326732673266
                                                                                          post parameters and the spectroscopic redshift distribution ntrue (black,90.0,0.3950617283950617,0.6049382716049383,9.0,1.0,0.44554455445544555,0.19801980198019797
dashed curve in the left panel).,0.0,0.84375,0.15625,6.0,1.0,0.0,0.8415841584158416
                           Abbreviation                    Sample Size    Figure     Tikhonov Reg. ùõº        Initial Binning   Effective Binning       WX,27.0,0.48026315789473684,0.5197368421052632,12.0,23.0,0.13366336633663367,0.24752475247524752
                       Small Sample (50k)                       50k        Fig. 7             0.1                  50                  50               -,23.0,0.20915032679738563,0.7908496732026143,10.0,47.0,0.11386138613861387,0.24257425742574257
                     Medium Sample (500k)                      500k        Fig. 7            0.08                  50                  31               -,21.0,0.23529411764705882,0.7647058823529411,10.0,47.0,0.10396039603960396,0.24257425742574257
             Large Sample (5000k) Oversmoothing                5000k       Fig. 7           0.0001                 25                  25               -,13.0,0.33986928104575165,0.6601307189542484,11.0,41.0,0.06435643564356436,0.24257425742574257
"          Medium Sample (500k), Fid. Setup & WX                 500k       Fig. 7            0.08                  50                  31               X",10.0,0.3202614379084967,0.6797385620915033,14.0,43.0,0.04950495049504951,0.24257425742574257
                         Tik. Regul. Low                       5000k       Fig. 8           0.0001                 50                  25               -,25.0,0.2222222222222222,0.7777777777777778,10.0,44.0,0.12376237623762376,0.24257425742574257
                       Tik. Regul. Medium                      5000k       Fig. 8              1                   50                  25               -,23.0,0.20915032679738563,0.7908496732026143,10.0,47.0,0.11386138613861387,0.24257425742574257
                         Tik. Regul. High                      5000k       Fig. 8              10                  50                  25               -,25.0,0.20261437908496732,0.7973856209150327,10.0,47.0,0.12376237623762376,0.24257425742574257
                          Oversmoothing                        5000k       Fig. 8           0.0001                 25                  25               -,26.0,0.2222222222222222,0.7777777777777778,8.0,45.0,0.12871287128712872,0.24257425742574257
                     Tik. Regul. Low + WX                      5000k       Fig. 8           0.0001                 50                  25               X,21.0,0.24183006535947713,0.7581699346405228,12.0,44.0,0.10396039603960396,0.24257425742574257
"Table 1. Summary of the different configurations that we test in this work. The first column lists the abbreviations, the second refers to the Figure where the",0.0,0.8364779874213837,0.16352201257861632,27.0,1.0,0.0,0.21287128712871284
"setup is analysed. The next columns list the value of the Tikhonov regularization parameter ùõº (see ¬ß 4.2.1), the number of initial bins, the effective bin number",0.0,0.8385093167701864,0.16149068322981364,27.0,1.0,0.0,0.20297029702970293
after (potentially) applying merging bin regularization (see ¬ß 4.2.1) and an indicator if the composite likelihood includes the cross-correlation data (see ¬ß 5).,0.0,0.8633540372670807,0.1366459627329193,23.0,1.0,0.0,0.20297029702970293
"Reg. ùõº‚Äô, ‚ÄòInitial Binning‚Äô and ‚ÄòEffective Binning‚Äô list the value of                  probability density function, the right panel the relative difference",0.0,0.7677419354838709,0.23225806451612907,20.0,10.0,0.0,0.23267326732673266
"the Tikhonov regularization parameter ùõº (see ¬ß 4.2.1), as well as                     between these posteriors and the spectroscopic redshift distribution",0.0,0.7532467532467533,0.24675324675324672,19.0,11.0,0.0,0.2376237623762376
"the used initial and effective bin number18 , i.e., the histogram bin                 that is shown as the black dashed line in both panels. The error",0.0,0.7333333333333333,0.2666666666666667,25.0,9.0,0.0,0.25742574257425743
"number after the merging bin regularization scheme. The final col-                    bars are the [16, 84] percentiles, corresponding to a Gaussian ¬±1ùúé",0.0,0.743421052631579,0.256578947368421,21.0,11.0,0.0,0.24752475247524752
umn indicates whether the cross-correlation data vector is included                   interval.,0.0,0.7157894736842105,0.28421052631578947,10.0,10.0,0.0,0.5297029702970297
in the composite likelihood. Fig. 7 shows a selection of posteriors,0.0,0.8507462686567164,0.14925373134328357,11.0,1.0,0.0,0.6683168316831682
"using setups from Tab. 1. The left hand panel shows the obtained                            The ‚ÄòSmall Sample (50k)‚Äô setup highlights the noisy, i.e.,",0.0,0.6866666666666666,0.31333333333333335,21.0,15.0,0.0,0.25742574257425743
"                                                                                      variance-dominated deconvolution, where we clearly see the com-",86.0,0.37583892617449666,0.6241610738255033,8.0,1.0,0.42574257425742573,0.2623762376237624
                                                                                      paratively large and fluctuating errorbars in Fig. 7. We note that,86.0,0.3684210526315789,0.631578947368421,11.0,1.0,0.42574257425742573,0.24752475247524752
"18  As an approximate rule, one can expect a noisy deconvolution if no                imposing a smoothing method will reduce these features. How-",0.0,0.7465753424657534,0.2534246575342466,22.0,10.0,0.0,0.27722772277227725
"prior is applied, if the size of the bins is smaller than ¬±1ùúé range of the            ever this can come at the expense of additional biases as discussed",0.0,0.7516339869281046,0.24836601307189543,28.0,7.0,0.0,0.24257425742574257
"individual galaxy redshift likelihoods for moderate sample sizes of the order         later, and the characteristic covariance structure in the posterior is",0.0,0.8205128205128205,0.17948717948717952,21.0,5.0,0.0,0.2277227722772277
"105 galaxies. For our redshift range and photometric redshift scatter this            not a priori problematic, as long as draws from the posteriors are",0.0,0.7828947368421053,0.2171052631578947,23.0,7.0,0.0,0.24752475247524752
would imply an effective number of bins of 30 ‚àí 40.                                   bounded and well-defined. Merging bin regularization exploits this,0.0,0.6578947368421053,0.3421052631578947,19.0,18.0,0.0,0.24752475247524752
"                                                                                                                                        MNRAS 000, 1‚Äì22 (2015)",136.0,0.12025316455696203,0.879746835443038,4.0,1.0,0.6732673267326733,0.2178217821782178
avr_spaces,15.3,1.0,0.0,1.0,1.0,0.07574257425742574,0.9504950495049505
                                                                                  Likelihood Inference under Photo-z error                          15,82.0,0.25333333333333335,0.7466666666666666,6.0,14.0,0.40594059405940597,0.25742574257425743
anti-correlation structure to provide an ‚Äòobjective‚Äô regularization           scenarios differ by their value of the Tikhonov regularization pa-,0.0,0.8194444444444444,0.18055555555555558,17.0,6.0,0.0,0.28712871287128716
"without the need to carefully motivate an external prior or smooth-           rameter ùõº. With increasing ùõº, the error bars decrease and the bias in",0.0,0.7755102040816326,0.22448979591836737,24.0,6.0,0.0,0.2722772277227723
ing model choice.                                                             the results increases. When comparing this with the ‚Äòoversmooth-,0.0,0.5,0.5,12.0,31.0,0.0,0.29702970297029707
"      An alternative that provides additional physical motivation is          ing‚Äô results, we see the same pattern. This similarity in behaviors",6.0,0.7724137931034483,0.22758620689655173,19.0,6.0,0.0297029702970297,0.2821782178217822
the inclusion of clustering redshift measurements into the compos-            arises because both a large ùõº and choosing large bins reduces the,0.0,0.7832167832167832,0.21678321678321677,21.0,7.0,0.0,0.2920792079207921
ite likelihood. This can be seen by comparing the posteriors from             variance of each bin.,0.0,0.7373737373737373,0.26262626262626265,15.0,7.0,0.0,0.5099009900990099
"the ‚ÄòMedium Sample (500k)‚Äô and the ‚ÄòMedium Sample (500k), Fid.                      Finally we show the impact of including the cross-correlation",0.0,0.7310344827586207,0.2689655172413793,19.0,12.0,0.0,0.2821782178217822
Setup & WX‚Äô cases. The corresponding results in Fig. 7 show that              measurements into the data vector in the ‚ÄòTik. Regul. Low + WX‚Äô,0.0,0.7446808510638298,0.25531914893617025,24.0,8.0,0.0,0.301980198019802
"for the same regularization, the inclusion of the cross-correlation           scenario, which adds clustering information to the ‚ÄòTik. Regul.",0.0,0.8085106382978723,0.19148936170212771,18.0,6.0,0.0,0.301980198019802
"data into the likelihood decreases the uncertainties, which is espe-          Low‚Äô scenario. When comparing these two cases, we see that the",0.0,0.7928571428571428,0.20714285714285718,21.0,6.0,0.0,0.306930693069307
cially visible in the high-redshift tail. We note that these results are      distribution of the posterior mean is now symmetric and reasonably,0.0,0.8194444444444444,0.18055555555555558,22.0,4.0,0.0,0.28712871287128716
dependent on the chosen galaxy-dark matter bias model. As dis-                centered within the science requirements. In particular we note,0.0,0.7659574468085106,0.23404255319148937,19.0,9.0,0.0,0.301980198019802
"cussed in the beginning of this section, the parametrization used             that the uncertainties are still much larger when compared with",0.0,0.7801418439716312,0.21985815602836878,20.0,7.0,0.0,0.301980198019802
"here is very flexible and the effective number of parameters can              the previously considered, strongly regularized cases. This shows",0.0,0.7832167832167832,0.21678321678321677,19.0,8.0,0.0,0.2920792079207921
"likely be reduced, if a more physical model is chosen. In this regard,        that while the effect of reducing the variance of the posteriors is",0.0,0.7862068965517242,0.21379310344827585,25.0,5.0,0.0,0.2821782178217822
we can view the presented reduction in the statistical error due to           similar when using regularization or including cross-correlation,0.0,0.8028169014084507,0.19718309859154926,19.0,6.0,0.0,0.29702970297029707
"clustering redshifts as conservative. As mentioned previously, bi-            data into the composite likelihood, the posteriors can be much better",0.0,0.8027210884353742,0.19727891156462585,19.0,7.0,0.0,0.2722772277227723
"ases due to ill-motivated regularization choices play an important            calibrated in the latter case. Using a smoothing, or regularization,",0.0,0.8013698630136986,0.1986301369863014,19.0,7.0,0.0,0.27722772277227725
"role, especially for large sample sizes, where the statistical error is       method essentially makes assumptions about the true shape of the",0.0,0.8169014084507042,0.18309859154929575,21.0,4.0,0.0,0.29702970297029707
"small. We illustrate this here in the ‚ÄòLarge Sample (5000k) Over-             distribution without strict data evidence. In contrast, adding cross-",0.0,0.7891156462585034,0.2108843537414966,20.0,7.0,0.0,0.2722772277227723
"smoothing‚Äô case, by deliberately choosing a coarser binning without           correlations to the composite likelihood adds this information in a",0.0,0.8068965517241379,0.19310344827586212,19.0,6.0,0.0,0.2821782178217822
"merging bin regularization. We clearly see that the statistical error         physical, data-driven way.",0.0,0.8076923076923077,0.1923076923076923,13.0,5.0,0.0,0.48514851485148514
is quite small with the bias dominating.                                            Another effect that needs consideration is the increase in the,0.0,0.5958904109589042,0.40410958904109584,17.0,23.0,0.0,0.27722772277227725
"      In order to investigate the quality of probability calibration,         intrinsic estimator bias due to the ‚Äòdownsampling‚Äô of the probabil-",6.0,0.7793103448275862,0.2206896551724138,19.0,5.0,0.0297029702970297,0.2821782178217822
"we consider the posterior distribution over the mean values of pho-           ity density function to a lower resolution, e.g., by picking larger",0.0,0.7862068965517242,0.21379310344827585,22.0,6.0,0.0,0.2821782178217822
tometric sample redshift distributions drawn from the posterior of            bin width or by imposing a different regularization or smoothing,0.0,0.795774647887324,0.204225352112676,19.0,7.0,0.0,0.29702970297029707
"nB .19 This is a reasonable choice, as it has been shown that accurate        scheme. This loss in resolution implies that we inadvertently limit",0.0,0.7931034482758621,0.2068965517241379,24.0,5.0,0.0,0.2821782178217822
modelling of weak lensing and LSS critically depends on accurate              the accuracy with which small scale structure can be reconstructed,0.0,0.7777777777777778,0.2222222222222222,20.0,8.0,0.0,0.28712871287128716
recovery of the posterior mean.                                               in the density field along the line-of-sight. As demonstrated and,0.0,0.5804195804195804,0.4195804195804196,15.0,24.0,0.0,0.2920792079207921
"      Fig. 8 shows five boxplots that each visualize the distribution         studied in detail in Rau et al. (2017), this effect can lead to biases",6.0,0.75,0.25,24.0,5.0,0.0297029702970297,0.26732673267326734
"of the posterior mean that corresponds to a different setup under             in the cosmological parameter inference that are often small, but",0.0,0.7762237762237763,0.22377622377622375,21.0,7.0,0.0,0.2920792079207921
"consideration. The box edges denote the [16, 84] percentiles, and             that would need scrutiny for upcoming data analyses. Since we gave",0.0,0.7777777777777778,0.2222222222222222,21.0,7.0,0.0,0.28712871287128716
"the definition of the whiskers, i.e., the thin vertical lines with short      a detailed description of this effect in Rau et al. (2017) including",0.0,0.8082191780821918,0.1917808219178082,24.0,4.0,0.0,0.27722772277227725
"horizontal edges represent the [2.5, 97.5] percentiles. The horizon-          schemes to detect and mitigate these effects, we do not focus on it",0.0,0.7931034482758621,0.2068965517241379,22.0,6.0,0.0,0.2821782178217822
"tal line within the box represents the median20 . The x-axis shows            in detail here. However, this effect can be illustrated for the current",0.0,0.7718120805369127,0.22818791946308725,24.0,7.0,0.0,0.2623762376237624
"several different scenarios, as listed in Tab. 1; the y-axis shows the        setup, since the merging bin regularization downsamples the reso-",0.0,0.8111888111888111,0.18881118881118886,21.0,5.0,0.0,0.2920792079207921
value of the posterior mean. The middle solid black line corresponds          lution to a relatively coarse grid of 31 bins. Furthermore consider,0.0,0.7931034482758621,0.2068965517241379,22.0,6.0,0.0,0.2821782178217822
"to the mean of the true redshift distribution, shown as the dashed            the redshift distribution of true redshifts discretized using the 20 bin",0.0,0.78,0.21999999999999997,23.0,7.0,0.0,0.25742574257425743
black line in the left panel of Fig. 7. We reiterate that all results         grid used to obtain the cross-correlation measurements. Since we,0.0,0.7887323943661971,0.21126760563380287,23.0,5.0,0.0,0.29702970297029707
"have been obtained using a mock catalog containing 5000k galax-               use this distribution, i.e. the black curve in Fig. 7, as a reference, we",0.0,0.7549668874172185,0.2450331125827815,24.0,8.0,0.0,0.2524752475247525
"ies. The (dashed/dotted), (grey/magenta) horizontal lines represent           also have to consider its intrinsic discretization error. Concretely,",0.0,0.8299319727891157,0.17006802721088432,16.0,6.0,0.0,0.2722772277227723
"the requirement values for (Y1/Y10), (LSS/WL) measurements as                 when comparing the mean estimated from this curve with the sam-",0.0,0.7588652482269503,0.24113475177304966,19.0,9.0,0.0,0.301980198019802
"given in the LSST DESC Science Requirements Document (DESC                    ple mean, we obtain a difference in these values of 0.0079. While",0.0,0.7272727272727273,0.2727272727272727,21.0,11.0,0.0,0.2920792079207921
"SRD The LSST Dark Energy Science Collaboration et al. 2018).                  this is of the same order as the Y1 science requirements in Fig. 8,",0.0,0.7241379310344828,0.27586206896551724,24.0,10.0,0.0,0.2821782178217822
We note that the LSST DESC Science Requirements Documents                     Y10 requirements will necessitate an increase in sample size or,0.0,0.7304964539007093,0.2695035460992907,19.0,11.0,0.0,0.301980198019802
"considers a tomographic analysis and not a single bin, as we do               the inclusion of cross-correlation constraints that will allow us to",0.0,0.7602739726027398,0.23972602739726023,22.0,8.0,0.0,0.27722772277227725
here. We therefore restrict ourselves to a qualitative comparison.            perform inference at a higher resolution. Due to the slow expected,0.0,0.7916666666666666,0.20833333333333337,20.0,7.0,0.0,0.28712871287128716
Furthermore it should be noted that higher order moments of the               convergence of deconvolution estimators with sample size (see e.g.,0.0,0.7708333333333334,0.22916666666666663,20.0,8.0,0.0,0.28712871287128716
"photometric sample redshift distribution will also correlate with             Carroll & Hall 1988), it is likely that several orders of magnitude",0.0,0.7862068965517242,0.21379310344827585,20.0,7.0,0.0,0.2821782178217822
"cosmological parameters, especially for a clustering likelihood (see          increase in sample size will be necessary. This is attainable for the",0.0,0.8095238095238095,0.19047619047619047,20.0,6.0,0.0,0.2722772277227723
"e.g. Nicola et al. 2020; Hadzhiyska et al. 2020), and our metric              large numbers of observed galaxies in LSST Y10, and our method-",0.0,0.75177304964539,0.24822695035460995,23.0,8.0,0.0,0.301980198019802
"is therefore bound to be incomplete. Redefining these metrics and             ology can scale to large sample sizes. However, in order to reach",0.0,0.7692307692307693,0.23076923076923073,22.0,7.0,0.0,0.2920792079207921
"requirements is the subject of ongoing work.                                  the sample sizes that are expected for LSST observations, we need",0.0,0.6503496503496503,0.3496503496503497,18.0,18.0,0.0,0.2920792079207921
"      We consider three scenarios: ‚ÄòTik Regul. Low‚Äô, ‚ÄòTik. Regul.             to develop an implementation that optimizes storage space and uses",6.0,0.75,0.25,19.0,7.0,0.0297029702970297,0.28712871287128716
"Medium‚Äô and Tik. Regul. High‚Äô. As can be seen from Tab. 1 these               an efficient parallelization strategy, which is beyond the scope of",0.0,0.7517241379310344,0.24827586206896557,23.0,8.0,0.0,0.2821782178217822
                                                                              this work.,78.0,0.10227272727272728,0.8977272727272727,2.0,1.0,0.38613861386138615,0.5643564356435644
"19                                                                                  Alternatively, we could use a different scheme that employs a",0.0,0.3724137931034483,0.6275862068965516,11.0,42.0,0.0,0.2821782178217822
"    Concretely, we draw a number of ùëõ ùêµ realizations that each parametrize",4.0,0.7972972972972973,0.20270270270270274,12.0,1.0,0.019801980198019802,0.6336633663366337
a photometric sample redshift distribution and evaluate the mean on each of   continuous model like logistic Gaussian processes (Rau et al. 2020),0.0,0.8413793103448276,0.1586206896551724,22.0,2.0,0.0,0.2821782178217822
these distributions.                                                          or Dirichlet processes. The convergence of these density estimators,0.0,0.5379310344827586,0.4620689655172414,11.0,30.0,0.0,0.2821782178217822
"20 We note that the original definition of the boxplot uses a different defi- will likely be better, however they will also require additional com-",0.0,0.8367346938775511,0.16326530612244894,25.0,1.0,0.0,0.2722772277227723
nition of the box size and the whiskers. We refer to Wickham & Stryjewski     putational overhead in the inference. A detailed study of estimator,0.0,0.8137931034482758,0.18620689655172418,24.0,3.0,0.0,0.2821782178217822
(2012) for more details.                                                      convergence is needed to settle on a recommendation and prove sig-,0.0,0.5347222222222222,0.4652777777777778,15.0,28.0,0.0,0.28712871287128716
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,2.8484848484848486,1.0,0.0,1.0,1.0,0.014101410141014101,0.9504950495049505
16,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
                   0.94,19.0,0.17391304347826086,0.8260869565217391,1.0,1.0,0.09405940594059406,0.8861386138613861
                                                                 DESC SRD Y10 WL                                 0.2,65.0,0.12931034482758622,0.8706896551724138,5.0,17.0,0.3217821782178218,0.4257425742574258
                   0.93                                          DESC SRD Y1 WL,19.0,0.189873417721519,0.810126582278481,5.0,22.0,0.09405940594059406,0.6089108910891089
                   0.92,19.0,0.17391304347826086,0.8260869565217391,1.0,1.0,0.09405940594059406,0.8861386138613861
                                                                 DESC SRD Y10 LSS,65.0,0.16049382716049382,0.8395061728395061,4.0,1.0,0.3217821782178218,0.599009900990099
                                                                 DESC SRD Y1 LSS                                 0.1,65.0,0.12931034482758622,0.8706896551724138,5.0,17.0,0.3217821782178218,0.4257425742574258
Posterior Mean z                                                                              wRB,0.0,0.17525773195876287,0.8247422680412371,4.0,40.0,0.0,0.5198019801980198
                                                                                               PostPred w Meas,95.0,0.11818181818181818,0.8818181818181818,3.0,1.0,0.47029702970297027,0.4554455445544554
                   0.91,19.0,0.17391304347826086,0.8260869565217391,1.0,1.0,0.09405940594059406,0.8861386138613861
                                                                                                         RB,105.0,0.018691588785046728,0.9813084112149533,1.0,1.0,0.5198019801980198,0.47029702970297027
                   0.90                                                                                          0.0,19.0,0.0603448275862069,0.9396551724137931,2.0,46.0,0.09405940594059406,0.4257425742574258
                   0.89,19.0,0.17391304347826086,0.8260869565217391,1.0,1.0,0.09405940594059406,0.8861386138613861
                                                                                                                 0.1         Unbiased,113.0,0.08270676691729323,0.9172932330827068,2.0,5.0,0.5594059405940595,0.34158415841584155
                   0.88                                                                                                      Biased = 0.8 Sys. Marg.,19.0,0.1554054054054054,0.8445945945945946,6.0,52.0,0.09405940594059406,0.26732673267326734
                   0.87,19.0,0.17391304347826086,0.8260869565217391,1.0,1.0,0.09405940594059406,0.8861386138613861
                                                                                                                             Biased Fixed Bias = 0.8,125.0,0.12837837837837837,0.8716216216216216,5.0,1.0,0.6188118811881188,0.26732673267326734
                                                                                                                 0.2         Biased Marg. Bias = 0.8,113.0,0.14864864864864866,0.8513513513513513,6.0,5.0,0.5594059405940595,0.26732673267326734
                          Tik. Regul.   Tik. Regul.   Tik. Regul. Oversmoothing Tik. Regul.,26.0,0.5824175824175825,0.41758241758241754,9.0,3.0,0.12871287128712872,0.5495049504950495
                              Low        Medium          High                   Low + WX                               0.0    0.5      1.0      1.5      2.0     2.5     3.0,30.0,0.23255813953488372,0.7674418604651163,13.0,49.0,0.1485148514851485,0.14851485148514854
                                                                                                                                             Redshift,141.0,0.053691275167785234,0.9463087248322147,1.0,1.0,0.698019801980198,0.2623762376237624
Figure 8. Boxplot illustration of the mean of the posterior sample redshift,0.0,0.8533333333333334,0.1466666666666666,12.0,1.0,0.0,0.6287128712871287
probability density function of the photometric sample (short: posterior,0.0,0.8888888888888888,0.11111111111111116,9.0,1.0,0.0,0.6435643564356436
mean) for different experimental setups listed in Tab. 1 and detailed in ¬ß 8.                 Figure 9. We plot the residual between replicated and true scale-averaged,0.0,0.7604790419161677,0.23952095808383234,25.0,9.0,0.0,0.1732673267326733
"The x-axis lists the different scenarios, the y-axis the value of the posterior               cross-correlation measurement wRB between a DESI-like spectroscopic ref-",0.0,0.7951807228915663,0.20481927710843373,21.0,8.0,0.0,0.17821782178217827
"mean. The box shows the [16, 84] percentiles, the vertical lines with hori-                   erence (‚ÄòR‚Äô) and photometric base (‚ÄòB‚Äô) sample as a function of redshift.",0.0,0.7485029940119761,0.25149700598802394,25.0,10.0,0.0,0.1732673267326733
"zontal edges (whiskers) show the [2.5, 97.5] percentiles, corresponding to                    The horizontal line with errorbars shows the uncertainties in the original",0.0,0.7678571428571429,0.2321428571428571,21.0,11.0,0.0,0.16831683168316836
the 1ùúé and 2ùúé intervals for the normal distribution. The horizontal line in                   measurement. The green/magenta contours show the scenario where we,0.0,0.75625,0.24375000000000002,22.0,10.0,0.0,0.20792079207920788
"the box is the median. The (dashed/dotted), (grey/magenta) lines correspond                   marginalize over all parameters c that parametrize the redshift dependent",0.0,0.7784431137724551,0.22155688622754488,20.0,10.0,0.0,0.1732673267326733
to the requirement on the uncertainty of the posterior mean as quoted in the                  galaxy-dark matter bias ratio function ùê∂ (ùëß) (see ¬ß 8.1) without the sys-,0.0,0.7425149700598802,0.2574850299401198,27.0,10.0,0.0,0.1732673267326733
"LSST DESC Science Requirements Document (DESC SRD, The LSST                                   tematics kernel for the unbiased/biased ( ùëì = 0.8) cases. The yellow/blue",0.0,0.6766467065868264,0.32335329341317365,21.0,18.0,0.0,0.1732673267326733
"Dark Energy Science Collaboration et al. 2018) for (Y1/Y10) (LSS/WL)                          contours consider the biased scenario ( ùëì = 0.8), but fix ùê∂ (ùëß) and do/do",0.0,0.7065868263473054,0.2934131736526946,25.0,14.0,0.0,0.1732673267326733
"measurements. The central, solid grey line is the mean of the true redshift                   not marginalize over the systematics kernel. The error bars and contours",0.0,0.7530120481927711,0.24698795180722888,24.0,10.0,0.0,0.17821782178217827
"distribution, shown as the dashed black line in the left panel of Fig. 7. All                 show the [5, 95] percentiles. We see that the replicated measurements do",0.0,0.7469879518072289,0.2530120481927711,27.0,9.0,0.0,0.17821782178217827
"results have been obtained using a mock catalog of 5000k galaxies with                        not show significant tension with the original measurements, if we either",0.0,0.7305389221556886,0.2694610778443114,23.0,13.0,0.0,0.1732673267326733
photometric redshift scatter that is perfectly calibrated. We highlight the                   marginalize over the systematic (‚ÄòBiased f=0.8 Sys. Marg.‚Äô) or if we use a,0.0,0.7619047619047619,0.23809523809523814,23.0,10.0,0.0,0.16831683168316836
decrease in the statistical error and potential increase in systematic bias for               flexible redshift-dependent galaxy-dark matter bias model (‚ÄòBiased Marg.,0.0,0.8012048192771084,0.1987951807228916,20.0,8.0,0.0,0.17821782178217827
"larger regularization, going from the leftmost to the fourth case. The right-                 Bias f=0.8‚Äô). Only if the form of the galaxy-dark matter bias is known to",0.0,0.7544910179640718,0.2455089820359282,26.0,9.0,0.0,0.1732673267326733
most boxplot shows the impact of including clustering redshift information                    good precision ‚Äì in this case we hold its values fixed ‚Äì are PPCs using,0.0,0.7393939393939394,0.2606060606060606,25.0,11.0,0.0,0.18316831683168322
into the likelihood.                                                                          cross-correlations sensitive in detecting tensions.,0.0,0.4482758620689655,0.5517241379310345,8.0,38.0,0.0,0.2821782178217822
nificant improvement over the simple histogram scheme employed,0.0,0.8870967741935484,0.11290322580645162,8.0,1.0,0.0,0.693069306930693
                                                                                              rameters that describe properties of the Spectral Energy Distribution,94.0,0.37423312883435583,0.6257668711656441,9.0,1.0,0.46534653465346537,0.19306930693069302
here; we will leave this for future work.,0.0,0.8292682926829268,0.1707317073170732,8.0,1.0,0.0,0.7970297029702971
"                                                                                              (SED). In conditional density estimation, non-physical parameters",94.0,0.3710691823899371,0.628930817610063,7.0,1.0,0.46534653465346537,0.21287128712871284
"      Most importantly, however, it is likely that systematic errors",6.0,0.7941176470588235,0.20588235294117652,9.0,1.0,0.0297029702970297,0.6633663366336633
                                                                                              describe a flexible model that provides a mapping between photom-,94.0,0.3522012578616352,0.6477987421383649,10.0,1.0,0.46534653465346537,0.21287128712871284
due to the miscalibration and mis-specification of the composite,0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
                                                                                              etry and redshift. This flexible model is then fitted to known cali-,94.0,0.35185185185185186,0.6481481481481481,12.0,1.0,0.46534653465346537,0.19801980198019797
"likelihood, either by a suboptimal galaxy-dark matter bias model",0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
                                                                                              bration data. Thus while in SED fitting the distribution of redshift,94.0,0.35802469135802467,0.6419753086419753,11.0,1.0,0.46534653465346537,0.19801980198019797
"or due to miscalibrated SED likelihoods, will lead to an error",0.0,0.8387096774193549,0.16129032258064513,11.0,1.0,0.0,0.693069306930693
"                                                                                              constitutes a posterior distribution, conditional density estimation",94.0,0.38271604938271603,0.617283950617284,7.0,1.0,0.46534653465346537,0.19801980198019797
budget that will dominate the aforementioned errors. If the mis-,0.0,0.859375,0.140625,10.0,1.0,0.0,0.6831683168316831
                                                                                              treats it as a predictive distribution (often without marginalizing,94.0,0.36645962732919257,0.6335403726708074,9.0,1.0,0.46534653465346537,0.20297029702970293
"specification can be parametrized and marginalized over, the vari-",0.0,0.8787878787878788,0.12121212121212122,9.0,1.0,0.0,0.6732673267326732
                                                                                              over the modelling uncertainty). However since the goal of this,94.0,0.34394904458598724,0.6560509554140128,10.0,1.0,0.46534653465346537,0.22277227722772275
"ance of the parameter posteriors will be increased, otherwise they",0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
                                                                                              subsection is to demonstrate potential systematic biases and uncer-,94.0,0.36645962732919257,0.6335403726708074,9.0,1.0,0.46534653465346537,0.20297029702970293
will lead to biases in the resulting parameter posteriors. In the,0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
"                                                                                              tainties in the deconvolution operation, this difference is not of great",94.0,0.37349397590361444,0.6265060240963856,11.0,1.0,0.46534653465346537,0.17821782178217827
following section we will discuss these sources of error. We will,0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
                                                                                              importance here.,94.0,0.13636363636363635,0.8636363636363636,2.0,1.0,0.46534653465346537,0.4554455445544554
showcase the usage of posterior predictive checks as a way to detect,0.0,0.8382352941176471,0.16176470588235292,12.0,1.0,0.0,0.6633663366336633
                                                                                                    In order to simulate the impact that a population of galaxies,100.0,0.3167701863354037,0.6832298136645962,11.0,1.0,0.49504950495049505,0.20297029702970293
miscalibration and suggest procedures for consistent model check-,0.0,0.8923076923076924,0.10769230769230764,8.0,1.0,0.0,0.6782178217821782
                                                                                              with inaccurately calibrated photometric redshift likelihoods has on,94.0,0.3765432098765432,0.6234567901234568,8.0,1.0,0.46534653465346537,0.19801980198019797
ing and refinement.,0.0,0.8947368421052632,0.10526315789473684,3.0,1.0,0.0,0.905940594059406
"                                                                                              the deconvolved redshift distribution, we consider a redshift range of",94.0,0.3719512195121951,0.6280487804878049,10.0,1.0,0.46534653465346537,0.18811881188118806
                                                                                              0.2 ‚àí 0.8 and a total of 500k galaxies. We randomly substitute 80%,94.0,0.3375,0.6625,13.0,1.0,0.46534653465346537,0.20792079207920788
                                                                                              of the FlexZboost conditional density predictions with photometric,94.0,0.36875,0.63125,8.0,1.0,0.46534653465346537,0.20792079207920788
8.3                 Testing the Model,0.0,0.4864864864864865,0.5135135135135135,4.0,9.0,0.0,0.8168316831683169
                                                                                              likelihoods obtained using a template fitting run from the BPZ code,94.0,0.35403726708074534,0.6459627329192547,11.0,1.0,0.46534653465346537,0.20297029702970293
We discussed and showcased our inference methodology in the pre-                              by employing a k-nearest neighbor substitution in redshift. The result,0.0,0.7073170731707317,0.29268292682926833,20.0,16.0,0.0,0.18811881188118806
"vious section using idealized data. To complement the discussion,                             is a dataset in which a fraction of 80% ( ùëì = 0.8) of galaxies have a",0.0,0.6748466257668712,0.32515337423312884,26.0,15.0,0.0,0.19306930693069302
"this section highlights how miscalibrated likelihoods can lead to                             likelihood from the BPZ code, and only 20% retain their conditional",0.0,0.7080745341614907,0.2919254658385093,20.0,15.0,0.0,0.20297029702970293
biases in the inferred sample redshift distribution and how posterior                         density predictions from the FlexZboost code. We picked this setup,0.0,0.73125,0.26875000000000004,20.0,13.0,0.0,0.20792079207920788
"predictive checks can be used to detect these issues.                                         because the BPZ predictions within this redshift range, while be-",0.0,0.6352201257861635,0.3647798742138365,19.0,21.0,0.0,0.21287128712871284
"      To mimic well-calibrated photometric likelihoods we use con-                            ing inferior to the FlexZboost predictions, still have an acceptable",6.0,0.691358024691358,0.308641975308642,18.0,15.0,0.0297029702970297,0.19801980198019797
ditional density estimates from the FlexZboost package (Dalmasso                              quality. We perform this experiment by selecting a range in redshift,0.0,0.7098765432098766,0.2901234567901234,19.0,16.0,0.0,0.19801980198019797
et al. 2020). We note that these conditional densities are not photo-                         because we will perform posterior predictive checks (PPC) using,0.0,0.7197452229299363,0.28025477707006374,21.0,13.0,0.0,0.22277227722772275
metric likelihoods in the sense of Eq. (34). The free parameters in                           cross-correlations and need to control where we would expect sys-,0.0,0.7044025157232704,0.2955974842767296,22.0,14.0,0.0,0.21287128712871284
the photometric likelihood are the redshifts of the galaxies and pa-                          tematics. This will allow us to disentangle model misspecification,0.0,0.725,0.275,20.0,14.0,0.0,0.20792079207920788
"                                                                                                                                                        MNRAS 000, 1‚Äì22 (2015)",152.0,0.10919540229885058,0.8908045977011494,4.0,1.0,0.7524752475247525,0.13861386138613863
avr_spaces,34.083333333333336,1.0,0.0,1.0,1.0,0.16872937293729373,0.9504950495049505
                                                                              Likelihood Inference under Photo-z error                       17,78.0,0.26573426573426573,0.7342657342657343,6.0,12.0,0.38613861386138615,0.2920792079207921
"issues from the systematics, e.g. from the ‚Äònoisy‚Äô deconvolution,         the deconvolved density estimate using, e.g., a convolution with a",0.0,0.8142857142857143,0.18571428571428572,19.0,5.0,0.0,0.306930693069307
described previously. We note that the quality of photometric red-        kernel function as described in ¬ß 7.2. We show these results as the,0.0,0.7943262411347518,0.2056737588652482,23.0,5.0,0.0,0.301980198019802
"shift likelihoods does not sharply change with redshift in this way,      yellow lines ‚ÄòBiased ùëì = 0.8 Sys. Marg‚Äô. Here we perform a dis-",0.0,0.7956204379562044,0.2043795620437956,24.0,4.0,0.0,0.32178217821782173
"in real photometric samples. Instead photometric redshift quality         cretized marginalization as described in ¬ß 7.2, by convolving the nB",0.0,0.8169014084507042,0.18309859154929575,19.0,5.0,0.0,0.29702970297029707
"is a complex function in color space that strongly depends e.g. on        vector with a Gaussian kernel function of width Œîùúé ‚àà [0.001, 0.2]",0.0,0.7841726618705036,0.2158273381294964,24.0,5.0,0.0,0.31188118811881194
"the quality of the photometry, the number of available bands, the         in 40 steps. We see that this correction can compensate for the",0.0,0.781021897810219,0.21897810218978098,23.0,5.0,0.0,0.32178217821782173
amount of calibration data and the template set. Modelling this ac-       misspecified likelihoods even in the case of a fixed ùê∂ (ùëß) model.,0.0,0.7985611510791367,0.20143884892086328,23.0,4.0,0.0,0.31188118811881194
curately is beyond the scope of this work and would require the           The degeneracy between the redshift-dependent galaxy-dark matter,0.0,0.7971014492753623,0.2028985507246377,19.0,6.0,0.0,0.3168316831683168
measurement of cross-correlations in color cells and the extension        bias ratio model and the nB parameters highlights the importance,0.0,0.8188405797101449,0.1811594202898551,19.0,5.0,0.0,0.3168316831683168
"of PPC to the full composite likelihood, that includes sampling the       of performing posterior predictive checks in color space to provide",0.0,0.8156028368794326,0.18439716312056742,21.0,4.0,0.0,0.301980198019802
"photometry of galaxies in these color cells. Using the mean of the        additional information on the redshift distribution. However, this",0.0,0.8142857142857143,0.18571428571428572,20.0,5.0,0.0,0.306930693069307
FlexZboost conditional densities for the selection instead of the true    requires careful modelling of SEDs and the development of a trans-,0.0,0.8357142857142857,0.16428571428571426,21.0,3.0,0.0,0.306930693069307
"redshifts would ‚Äòsmooth-out‚Äô the quality of the likelihoods as a func-    parent, reproducible analysis framework that additionally includes",0.0,0.8571428571428571,0.1428571428571429,18.0,3.0,0.0,0.306930693069307
tion of redshift at the boundaries of the 0.2 ‚àí 0.8 redshift interval.    tests for parameter degeneracies and a model comparison frame-,0.0,0.8235294117647058,0.17647058823529416,22.0,3.0,0.0,0.3267326732673267
"However this will also not be representative of the aforementioned        work. This is beyond the scope of this work, but will be addressed",0.0,0.7928571428571428,0.20714285714285718,23.0,5.0,0.0,0.306930693069307
difficulties. We therefore choose an unrealistically simple case that     in a future paper.,0.0,0.8260869565217391,0.17391304347826086,13.0,3.0,0.0,0.5445544554455446
nonetheless illustrates the usefulness of PPC. Furthermore it allows,0.0,0.8823529411764706,0.11764705882352944,9.0,1.0,0.0,0.6633663366336633
us to highlight difficulties in their application in a controlled man-,0.0,0.8571428571428571,0.1428571428571429,11.0,1.0,0.0,0.6534653465346535
"ner, by picking a fixed redshift range in which individual galaxy",0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
likelihoods are biased.                                                   9    SUMMARY AND CONCLUSIONS,0.0,0.4215686274509804,0.5784313725490196,7.0,28.0,0.0,0.49504950495049505
"      In the spirit of PPC, we generate new cross-correlation mea-        Accurate photometric redshift inference is one of the most impor-",6.0,0.7697841726618705,0.2302158273381295,20.0,5.0,0.0297029702970297,0.31188118811881194
"surements using the joint posterior of the sample redshift distribu-      tant challenges in large area photometric surveys like LSST, DES,",0.0,0.8273381294964028,0.17266187050359716,20.0,4.0,0.0,0.31188118811881194
"tion parameters nB and the parameters that govern the galaxy-dark         HSC, or KiDS. As discussed in detail in ¬ß 3, photometric redshift",0.0,0.7913669064748201,0.2086330935251799,22.0,5.0,0.0,0.31188118811881194
"matter bias ratio evolution c, following the Chebychev basis ex-          inference is, from a statistical point of view, a deconvolution prob-",0.0,0.7972027972027972,0.2027972027972028,21.0,6.0,0.0,0.2920792079207921
"pansion described in ¬ß 8.1. For simplicity we will deconvolve the         lem, where an underlying true redshift distribution is convolved",0.0,0.8043478260869565,0.19565217391304346,20.0,5.0,0.0,0.3168316831683168
redshift distribution on the same 20 bin redshift grid used in the        with an SED model-dependent error distribution given by the pho-,0.0,0.7971014492753623,0.2028985507246377,22.0,5.0,0.0,0.3168316831683168
"cross-correlation data vector. For 500k galaxies, this leads to very      tometric likelihood. The deconvolution inference of sample redshift",0.0,0.8439716312056738,0.15602836879432624,18.0,4.0,0.0,0.301980198019802
small statistical errorbars in the deconvolution. As a simplification     distribution is not new (e.g. Padmanabhan et al. 2005; Leistedt et al.,0.0,0.8333333333333334,0.16666666666666663,21.0,3.0,0.0,0.28712871287128716
"we can then fix the nB posterior to its maximum likelihood value.         2016; Malz & Hogg 2020), and spatial information has also been",0.0,0.7794117647058824,0.22058823529411764,23.0,5.0,0.0,0.3267326732673267
"As mentioned in the previous section, this oversmoothing will lead        incorporated into the inference (e.g. Alarcon et al. 2020b; S√°nchez",0.0,0.8156028368794326,0.18439716312056742,20.0,5.0,0.0,0.301980198019802
"to biases in the nB posteriors. However, since we will only perform       & Bernstein 2019; Jones & Heavens 2019; Rau et al. 2020). We ex-",0.0,0.782608695652174,0.21739130434782605,25.0,4.0,0.0,0.3168316831683168
a posterior predictive analysis with respect to the clustering likeli-    tended these prior works by developing a fast approximate inference,0.0,0.8439716312056738,0.15602836879432624,20.0,3.0,0.0,0.301980198019802
"hood, that is less constraining than the photometric likelihood, the      scheme for deconvolution, that combines redshift information from",0.0,0.841726618705036,0.15827338129496404,18.0,4.0,0.0,0.31188118811881194
systematics incurred by these simplifications and the underestima-        both the photometry and the spatial distribution of galaxies in terms,0.0,0.8251748251748252,0.1748251748251748,19.0,5.0,0.0,0.2920792079207921
"tion of statistical error, are sub-dominant compared with the overall     of a composite likelihood ansatz. We particularly provided a discus-",0.0,0.8380281690140845,0.1619718309859155,20.0,3.0,0.0,0.29702970297029707
statistical error budget from the correlation function measurements.      sion on regularization techniques and the tradeoff between bias and,0.0,0.8439716312056738,0.15602836879432624,18.0,4.0,0.0,0.301980198019802
                                                                          variance in the Bayesian context for medium to large sample sizes.,74.0,0.4,0.6,11.0,1.0,0.36633663366336633,0.306930693069307
"      Fig. 9 shows the sampled cross correlation measurements from              In particular, our goal is to include the treatment of photomet-",6.0,0.7361111111111112,0.26388888888888884,20.0,8.0,0.0297029702970297,0.28712871287128716
"the fitted joint model, in residual to the original measurements. We      ric redshift via the likelihood of the galaxies‚Äô photometry into the",0.0,0.8169014084507042,0.18309859154929575,22.0,4.0,0.0,0.29702970297029707
"showcase four scenarios. In the unbiased case we use FlexZBoost           current cosmological inference framework, which is based on cor-",0.0,0.7971014492753623,0.2028985507246377,19.0,6.0,0.0,0.3168316831683168
PDFs and marginalize over all c parameters. Due to the good cal-          relation functions. The main reason for our likelihood choice is to,0.0,0.7801418439716312,0.21985815602836878,23.0,6.0,0.0,0.301980198019802
ibration of these Machine Learning-produced conditional distribu-         allow the easy integration into the likelihood inference framework,0.0,0.8357142857142857,0.16428571428571426,16.0,5.0,0.0,0.306930693069307
"tions, we obtain very similar results compared with the previous          based on two-point statistics of galaxy density and shear fields. This",0.0,0.7986111111111112,0.20138888888888884,21.0,6.0,0.0,0.28712871287128716
"section. The reason for this success is, of course, the representative    is more difficult for other approaches presented in Alarcon et al.",0.0,0.8285714285714286,0.17142857142857137,22.0,3.0,0.0,0.306930693069307
"training set that would not be available in a practical application.      (2020b) and S√°nchez & Bernstein (2019) since, in the currently",0.0,0.8161764705882353,0.18382352941176472,21.0,4.0,0.0,0.3267326732673267
"Furthermore we consider three scenarios with ùëì = 0.8. The sce-            demonstrated form, the redshift information from cross-correlating",0.0,0.8,0.19999999999999996,18.0,7.0,0.0,0.306930693069307
nario shown in yellow fixes the galaxy-dark matter bias parameters        the overlapping spectroscopic sample is included via an estimator,0.0,0.8201438848920863,0.17985611510791366,19.0,5.0,0.0,0.31188118811881194
"(c), but marginalizes over the parameters of the systematics kernel.      and not using a likelihood (that would depend on cosmological",0.0,0.8222222222222222,0.1777777777777778,20.0,4.0,0.0,0.33168316831683164
"The blue/magenta lines fix/marginalize over the c parameters, but         parameters). While the works of Padmanabhan et al. (2005); Leist-",0.0,0.8129496402877698,0.18705035971223016,19.0,5.0,0.0,0.31188118811881194
do not include the systematics kernel correction.                         edt et al. (2016); Malz & Hogg (2020) are structurally similar in,0.0,0.697841726618705,0.302158273381295,19.0,13.0,0.0,0.31188118811881194
"      As can be seen in Fig. 9, the treatment of galaxy-dark matter       terms of the treatment of the photometric likelihood, they do not",6.0,0.7553956834532374,0.24460431654676262,23.0,4.0,0.0297029702970297,0.31188118811881194
bias has a profound impact on the consistency between the replicated      discuss the effect of including clustering information. It is notewor-,0.0,0.8263888888888888,0.17361111111111116,21.0,4.0,0.0,0.28712871287128716
"and original cross-correlation measurements. Within the errors, the       thy that the early work by Padmanabhan et al. (2005) provides an",0.0,0.8188405797101449,0.1811594202898551,20.0,4.0,0.0,0.3168316831683168
"results are consistent for all scenarios except the one without sys-      excellent, explicit discussion of regularization, which is the main",0.0,0.8297872340425532,0.17021276595744683,20.0,4.0,0.0,0.301980198019802
"tematics kernel correction that uses a fixed ùê∂ (ùëß) model. As shown        difficulty in the photometric redshift problem, although not in the",0.0,0.8014184397163121,0.1985815602836879,22.0,5.0,0.0,0.301980198019802
"in the yellow line, these biases can be corrected by the systematics      context of probability calibration and the aforementioned joint in-",0.0,0.8226950354609929,0.17730496453900713,21.0,4.0,0.0,0.301980198019802
kernel marginalization. This illustrates that if sufficient information   ference framework. We summarized our approach to the challenges,0.0,0.8686131386861314,0.13138686131386856,17.0,2.0,0.0,0.32178217821782173
"about ùê∂ (ùëß) is available, the clustering likelihood alone can allow for   that arise in the estimation of redshift distributions for samples of",0.0,0.8321678321678322,0.1678321678321678,23.0,2.0,0.0,0.2920792079207921
"powerful posterior predictive checks. If this is not the case, consis-    galaxies in the context of photometric surveys. Concretely, we con-",0.0,0.8368794326241135,0.16312056737588654,21.0,3.0,0.0,0.301980198019802
tency tests of redshift distributions with respect to clustering redshift sidered the combination of photometric information with two-point,0.0,0.8776978417266187,0.12230215827338131,18.0,1.0,0.0,0.31188118811881194
"measurements can be misleading. Provided sufficient information           statistics, the scalability and regularization of the deconvolution in-",0.0,0.8275862068965517,0.1724137931034483,16.0,6.0,0.0,0.2821782178217822
"on the galaxy-dark matter bias, we can parametrize the biases in          ference in the large sample scenario, and investigate the impact of",0.0,0.7872340425531915,0.21276595744680848,22.0,6.0,0.0,0.301980198019802
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,2.6153846153846154,1.0,0.0,1.0,1.0,0.012947448591012947,0.9504950495049505
18,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
systematics from misspecified individual galaxy photometric like-      measurement to evaluate model goodness-of-fit. Specifically cross-,0.0,0.8686131386861314,0.13138686131386856,14.0,4.0,0.0,0.32178217821782173
"lihoods, proposing parametrizations for these systematics. These       correlation redshift inference is often used to calibrate photometric",0.0,0.85,0.15000000000000002,16.0,4.0,0.0,0.306930693069307
achievements lay the foundations for future extensions that we will    redshifts obtained using photometry (Newman 2008; Johnson et al.,0.0,0.8444444444444444,0.15555555555555556,19.0,3.0,0.0,0.33168316831683164
discuss in the next section.                                           2016; Davis et al. 2017). In ¬ß 8.3 we demonstrated that PPC of,0.0,0.556390977443609,0.443609022556391,18.0,22.0,0.0,0.34158415841584155
      In ¬ß 4.1 we described our inference methodology that is de-      cross-correlation measurements can detect systematic biases in the,6.0,0.7883211678832117,0.21167883211678828,19.0,4.0,0.0297029702970297,0.32178217821782173
signed to facilitate inference on large galaxy catalogs to be expected recovered sample redshift distribution if the galaxy-dark matter bias,0.0,0.8642857142857143,0.13571428571428568,20.0,1.0,0.0,0.306930693069307
in LSST. The scheme uses a Laplace Approximation in logit space        of the photometric and spectroscopic samples is known to sufficient,0.0,0.8043478260869565,0.19565217391304346,21.0,5.0,0.0,0.3168316831683168
and facilitates inference using an iterative scheme of expectation     accuracy.,0.0,0.8375,0.16249999999999998,10.0,3.0,0.0,0.6039603960396039
maximization update equations. This provides computational ad-               In order to parametrize potential biases in the sample redshift,0.0,0.7857142857142857,0.2142857142857143,17.0,8.0,0.0,0.306930693069307
vantages over sampling approaches. Additionally this methodology       distribution posteriors caused by misspecified photometric likeli-,0.0,0.8613138686131386,0.13868613138686137,14.0,4.0,0.0,0.32178217821782173
"facilitates fast joint inference with a cross-correlation data vector  hoods, particularly over-deconvolution effects that lead to overly",0.0,0.8759124087591241,0.12408759124087587,17.0,2.0,0.0,0.32178217821782173
"(see ¬ß 5) that we included in a composite likelihood ansatz. As high-  narrow redshift distributions, we proposed a simple Gaussian filter",0.0,0.8405797101449275,0.1594202898550725,22.0,2.0,0.0,0.3168316831683168
"lighted in ¬ß 6, this provides the possibility of additional extensions that, as demonstrated in ¬ß 8.3, was able to correct these biases.",0.0,0.8382352941176471,0.16176470588235292,23.0,1.0,0.0,0.3267326732673267
that include two-point statistics from cosmological weak lensing,0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
"and galaxy-galaxy lensing measurements. As we discussed in ¬ß 3,",0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
ensemble redshift distribution inference based on a photometric,0.0,0.8888888888888888,0.11111111111111116,8.0,1.0,0.0,0.6881188118811881
"likelihood is a deconvolution problem, which requires regulariza-      10    FUTURE WORK",0.0,0.7954545454545454,0.20454545454545459,11.0,6.0,0.0,0.5643564356435644
"tion to yield bounded and well-defined results. In this context, we",0.0,0.8507462686567164,0.14925373134328357,11.0,1.0,0.0,0.6683168316831682
"                                                                       In future work, it will be important to extend the inference scheme",71.0,0.4057971014492754,0.5942028985507246,12.0,1.0,0.35148514851485146,0.3168316831683168
discussed a regularization scheme that consists of a combination,0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
"                                                                       developed in this paper. We plan to consider a range of extensions,",71.0,0.4057971014492754,0.5942028985507246,12.0,1.0,0.35148514851485146,0.3168316831683168
of Tikhonov regularization with (more importantly) a scheme that,0.0,0.875,0.125,9.0,1.0,0.0,0.6831683168316831
"                                                                       e.g., iterated nested Laplace approximations (Bornkamp 2011) in",71.0,0.417910447761194,0.582089552238806,8.0,1.0,0.35148514851485146,0.3366336633663366
merges neighboring bins to exploit the characteristic covariance,0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
"                                                                       logit space, the usage of more flexible distributions that can be fitted",71.0,0.42657342657342656,0.5734265734265734,12.0,1.0,0.35148514851485146,0.2920792079207921
structure in the deconvolved densities. In agreement with the find-,0.0,0.8656716417910447,0.13432835820895528,10.0,1.0,0.0,0.6683168316831682
"                                                                       using variational inference schemes, as well as the development of",71.0,0.41605839416058393,0.583941605839416,10.0,1.0,0.35148514851485146,0.32178217821782173
ings of the original paper by Kuusela (2016) that proposed and,0.0,0.8387096774193549,0.16129032258064513,11.0,1.0,0.0,0.693069306930693
                                                                       specialized subsampling MCMC schemes. The different techniques,71.0,0.42105263157894735,0.5789473684210527,7.0,1.0,0.35148514851485146,0.34158415841584155
"applied this scheme to the Poisson inverse problem, we find that the",0.0,0.8382352941176471,0.16176470588235292,12.0,1.0,0.0,0.6633663366336633
                                                                       will be evaluated in combination with regularization approaches,71.0,0.417910447761194,0.582089552238806,8.0,1.0,0.35148514851485146,0.3366336633663366
‚ÄòMerging Bin‚Äô scheme leads to better calibrated results as compared,0.0,0.8656716417910447,0.13432835820895528,10.0,1.0,0.0,0.6683168316831682
                                                                       based on the quality of their probability coverage. Another exten-,71.0,0.41605839416058393,0.583941605839416,10.0,1.0,0.35148514851485146,0.32178217821782173
with Tikhonov regularization and with an oversmoothing scheme,0.0,0.8852459016393442,0.11475409836065575,8.0,1.0,0.0,0.698019801980198
"                                                                       sion, particularly to reduce the bias in the density estimation, is to",71.0,0.41843971631205673,0.5815602836879432,12.0,1.0,0.35148514851485146,0.301980198019802
that selects a coarser redshift binning for the sample redshift his-,0.0,0.8529411764705882,0.1470588235294118,11.0,1.0,0.0,0.6633663366336633
                                                                       consider other parametrizations for the deconvolved density either,71.0,0.4306569343065693,0.5693430656934306,8.0,1.0,0.35148514851485146,0.32178217821782173
tograms.,0.0,1.0,0.0,1.0,1.0,0.0,0.9603960396039604
                                                                       by employing density estimators with better mean squared error,71.0,0.40601503759398494,0.5939849624060151,9.0,1.0,0.35148514851485146,0.34158415841584155
      In order to test and discuss the quality of our posterior infer-,6.0,0.7571428571428571,0.24285714285714288,12.0,1.0,0.0297029702970297,0.6534653465346535
"                                                                       scaling like Kernel Density estimators, basis function expansions or",71.0,0.4316546762589928,0.5683453237410072,9.0,1.0,0.35148514851485146,0.31188118811881194
"ence, we used data from the CosmoDC2 simulations to generate a",0.0,0.8387096774193549,0.16129032258064513,11.0,1.0,0.0,0.693069306930693
                                                                       using methods such as logistic Gaussian Processes (e.g. Rau et al.,71.0,0.40875912408759124,0.5912408759124088,11.0,1.0,0.35148514851485146,0.32178217821782173
"spectroscopic DESI-like sample and a photometric mock catalog,",0.0,0.8870967741935484,0.11290322580645162,8.0,1.0,0.0,0.693069306930693
                                                                       2020). The combination of photometric and clustering information,71.0,0.4222222222222222,0.5777777777777777,8.0,1.0,0.35148514851485146,0.33168316831683164
that uses an LSST-like photometric error model. This allowed us to,0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
                                                                       can be extended by connecting the modelling of SEDs and redshift-,71.0,0.40441176470588236,0.5955882352941176,11.0,1.0,0.35148514851485146,0.3267326732673267
test the impact of a spectroscopic calibration sample with an inho-,0.0,0.8507462686567164,0.14925373134328357,11.0,1.0,0.0,0.6683168316831682
                                                                       dependent galaxy-dark matter bias modelling via the luminosity,71.0,0.41353383458646614,0.5864661654135339,8.0,1.0,0.35148514851485146,0.34158415841584155
mogeneous galaxy population as a function of redshift. We found,0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
                                                                       function as shown in van Daalen & White (2018). This also has,71.0,0.3787878787878788,0.6212121212121212,12.0,1.0,0.35148514851485146,0.3465346534653465
that the ratio between the redshift-dependent galaxy-dark matter,0.0,0.890625,0.109375,8.0,1.0,0.0,0.6831683168316831
                                                                       the potential to reduce the degeneracy between SED and redshift-,71.0,0.4074074074074074,0.5925925925925926,10.0,1.0,0.35148514851485146,0.33168316831683164
bias of the photometric and the spectroscopic sample is a smooth,0.0,0.84375,0.15625,11.0,1.0,0.0,0.6831683168316831
"                                                                       dependent galaxy-dark matter bias systematics. Finally, we note that",71.0,0.4316546762589928,0.5683453237410072,9.0,1.0,0.35148514851485146,0.31188118811881194
"function of redshift, if the spectroscopic calibration sample consists",0.0,0.8857142857142857,0.11428571428571432,9.0,1.0,0.0,0.6534653465346535
                                                                       the data quality of the photometry will not be the same in all areas,71.0,0.39568345323741005,0.60431654676259,14.0,1.0,0.35148514851485146,0.31188118811881194
"of a single galaxy population, and is discontinuous if the galaxy",0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
                                                                       on the sky. In order to include these field-to-field variations into the,71.0,0.42657342657342656,0.5734265734265734,12.0,1.0,0.35148514851485146,0.2920792079207921
population strongly changes. We therefore employed a step-wise,0.0,0.8870967741935484,0.11290322580645162,8.0,1.0,0.0,0.693069306930693
"                                                                       composite likelihood framework, we can, for example, condition the",71.0,0.4233576642335766,0.5766423357664234,9.0,1.0,0.35148514851485146,0.32178217821782173
smooth function based on a Chebychev polynomial expansion to,0.0,0.8666666666666667,0.1333333333333333,9.0,1.0,0.0,0.7029702970297029
                                                                       likelihood on the field and include a corresponding data covariance,71.0,0.42028985507246375,0.5797101449275363,10.0,1.0,0.35148514851485146,0.3168316831683168
parametrize this ratio.,0.0,0.9130434782608695,0.08695652173913049,3.0,1.0,0.0,0.8861386138613861
                                                                       into the likelihood by employing either resampling techniques (see,71.0,0.4233576642335766,0.5766423357664234,9.0,1.0,0.35148514851485146,0.32178217821782173
      In ¬ß 8 we performed a forecast of redshift inference perfor-,6.0,0.7575757575757576,0.24242424242424243,11.0,1.0,0.0297029702970297,0.6732673267326732
                                                                       e.g. Davison & Hinkley 2013) or using theoretical modelling (e.g.,71.0,0.4117647058823529,0.5882352941176471,10.0,1.0,0.35148514851485146,0.3267326732673267
"mance on ideal data, assuming perfectly calibrated individual galaxy",0.0,0.8823529411764706,0.11764705882352944,9.0,1.0,0.0,0.6633663366336633
                                                                       Stoyan & Stoyan 1994; S√°nchez et al. 2020).,71.0,0.3157894736842105,0.6842105263157895,8.0,1.0,0.35148514851485146,0.4356435643564357
redshift likelihoods. We found that using the aforementioned merg-,0.0,0.8787878787878788,0.12121212121212122,9.0,1.0,0.0,0.6732673267326732
"                                                                             To conclude, we have presented an efficient photometric red-",77.0,0.3795620437956204,0.6204379562043796,9.0,1.0,0.3811881188118812,0.32178217821782173
"ing bin regularization, we were able to produce accurate posteriors",0.0,0.8656716417910447,0.13432835820895528,10.0,1.0,0.0,0.6683168316831682
                                                                       shift inference framework that combines information from both the,71.0,0.41911764705882354,0.5808823529411764,9.0,1.0,0.35148514851485146,0.3267326732673267
of ensemble redshift distributions. We reiterate that using other reg-,0.0,0.8714285714285714,0.12857142857142856,10.0,1.0,0.0,0.6534653465346535
                                                                       photometry and the spatial distribution of galaxies. The methodol-,71.0,0.4233576642335766,0.5766423357664234,9.0,1.0,0.35148514851485146,0.32178217821782173
"ularization schemes, like an overly large Tikhonov regularization",0.0,0.8923076923076924,0.10769230769230764,8.0,1.0,0.0,0.6782178217821782
                                                                       ogy is designed to scale well to large samples. We complement this,71.0,0.40145985401459855,0.5985401459854014,12.0,1.0,0.35148514851485146,0.32178217821782173
"parameter, or an oversmoothing approach that picks overly wide",0.0,0.8709677419354839,0.12903225806451613,9.0,1.0,0.0,0.693069306930693
"                                                                       framework with methods for regularization, model checking and",71.0,0.4090909090909091,0.5909090909090908,8.0,1.0,0.35148514851485146,0.3465346534653465
"histogram bins, can lead to significant biases in the recovered pos-",0.0,0.8529411764705882,0.1470588235294118,11.0,1.0,0.0,0.6633663366336633
                                                                       redshift systematics parametrization. The forecasts we performed,71.0,0.42962962962962964,0.5703703703703704,7.0,1.0,0.35148514851485146,0.33168316831683164
terior mean.,0.0,0.9166666666666666,0.08333333333333337,2.0,1.0,0.0,0.9405940594059405
"                                                                       using CosmoDC2 data give us confidence that, with the additional",71.0,0.4074074074074074,0.5925925925925926,10.0,1.0,0.35148514851485146,0.33168316831683164
      When compared with the DESC science requirements for WL,6.0,0.7704918032786885,0.2295081967213115,9.0,1.0,0.0297029702970297,0.698019801980198
"                                                                       improvements described here, the methodology presented will en-",71.0,0.417910447761194,0.582089552238806,8.0,1.0,0.35148514851485146,0.3366336633663366
and large scale structure measurements in terms of the mean of,0.0,0.8387096774193549,0.16129032258064513,11.0,1.0,0.0,0.693069306930693
                                                                       able accurate and well-calibrated redshift inference for LSST and,71.0,0.41911764705882354,0.5808823529411764,9.0,1.0,0.35148514851485146,0.3267326732673267
"the photometric sample redshift distribution, we found that we can",0.0,0.8636363636363636,0.13636363636363635,10.0,1.0,0.0,0.6732673267326732
                                                                       other ongoing and future large area photometric surveys.,71.0,0.3858267716535433,0.6141732283464567,8.0,1.0,0.35148514851485146,0.3712871287128713
meet the DESC SRD Y1 goals and remain consistent with the DESC,0.0,0.8225806451612904,0.17741935483870963,12.0,1.0,0.0,0.693069306930693
"SRD Y10 goals with 5000k galaxies, if cross-correlations are in-",0.0,0.859375,0.140625,10.0,1.0,0.0,0.6831683168316831
"cluded in the joint composite likelihood. In practical applications,",0.0,0.8823529411764706,0.11764705882352944,9.0,1.0,0.0,0.6633663366336633
"however, Spectral Energy Distribution (SED) templates for galaxies",0.0,0.8939393939393939,0.10606060606060608,8.0,1.0,0.0,0.6732673267326732
                                                                       SOFTWARE,71.0,0.10126582278481013,0.8987341772151899,1.0,1.0,0.35148514851485146,0.6089108910891089
will be subject to modelling biases that cannot be well calibrated,0.0,0.8484848484848485,0.1515151515151515,11.0,1.0,0.0,0.6732673267326732
"using spectroscopic data (see e.g. Hartley et al. 2020). We therefore  Besides software referenced directly in the text, we performed the",0.0,0.8467153284671532,0.15328467153284675,21.0,2.0,0.0,0.32178217821782173
proposed to use posterior predictive checks (PPC) as a means to        analyses in this work using the following software packages: the,0.0,0.8,0.19999999999999996,21.0,5.0,0.0,0.33168316831683164
"evaluate the quality of our inference. Here, we compared replica-      python language (van Rossum 1995), scipy (Virtanen et al. 2020),",0.0,0.8222222222222222,0.1777777777777778,20.0,4.0,0.0,0.33168316831683164
"tions of the data sampled from the fitted model with the original      numpy (Harris et al. 2020), jupyter notebook (Kluyver et al. 2016),",0.0,0.8043478260869565,0.19565217391304346,23.0,4.0,0.0,0.3168316831683168
"                                                                                                                     MNRAS 000, 1‚Äì22 (2015)",117.0,0.1366906474820144,0.8633093525179856,4.0,1.0,0.5792079207920792,0.31188118811881194
avr_spaces,27.19607843137255,1.0,0.0,1.0,1.0,0.13463405164045816,0.9504950495049505
                                                                         Likelihood Inference under Photo-z error                              19,73.0,0.2620689655172414,0.7379310344827585,6.0,16.0,0.3613861386138614,0.2821782178217822
"ipython (Perez & Granger 2007), matplotlib (Hunter 2007) and         under Contract No. DE-AC02-05CH11231; STFC DiRAC HPC Fa-",0.0,0.808,0.19199999999999995,17.0,5.0,0.0,0.3811881188118812
"pandas (Wes McKinney 2010).                                          cilities, funded by UK BIS National E-infrastructure capital grants;",0.0,0.6131386861313869,0.3868613138686131,13.0,22.0,0.0,0.32178217821782173
"                                                                     and the UK particle physics grid, supported by the GridPP Col-",69.0,0.3969465648854962,0.6030534351145038,11.0,1.0,0.3415841584158416,0.35148514851485146
                                                                     laboration. This work was performed in part under DOE Contract,69.0,0.40458015267175573,0.5954198473282443,10.0,1.0,0.3415841584158416,0.35148514851485146
                                                                     DE-AC02-76SF00515.,69.0,0.20689655172413793,0.7931034482758621,1.0,1.0,0.3415841584158416,0.5693069306930694
DATA AVAILABILITY STATEMENT,0.0,0.9259259259259259,0.07407407407407407,3.0,1.0,0.0,0.8663366336633663
The cosmoDC2 extragalactic catalog is publicly available at,0.0,0.8813559322033898,0.11864406779661019,8.0,1.0,0.0,0.7079207920792079
https://portal.nersc.gov/project/lsst/cosmoDC2/                      REFERENCES,0.0,0.7215189873417721,0.2784810126582279,2.0,12.0,0.0,0.6089108910891089
_README.html. The ancillary catalogs (photo-z and DESI-like,0.0,0.8983050847457628,0.10169491525423724,7.0,1.0,0.0,0.7079207920792079
"                                                                     Abbott T. M. C., et al., 2018a, Phys. Rev. D, 98, 043526",69.0,0.36,0.64,12.0,1.0,0.3415841584158416,0.3811881188118812
selection for cosmoDC2) and other derived data underlying this,0.0,0.8709677419354839,0.12903225806451613,9.0,1.0,0.0,0.693069306930693
"                                                                     Abbott T. M. C., et al., 2018b, ApJS, 239, 18",69.0,0.3157894736842105,0.6842105263157895,10.0,1.0,0.3415841584158416,0.4356435643564357
article will be shared on reasonable request to the corresponding,0.0,0.8615384615384616,0.1384615384615384,10.0,1.0,0.0,0.6782178217821782
"                                                                     Aihara H., et al., 2018, PASJ, 70, S4",69.0,0.2830188679245283,0.7169811320754718,8.0,1.0,0.3415841584158416,0.4752475247524752
"author. The source code that implements the algorithms presented     Alarcon A., et al., 2020a, arXiv e-prints, p. arXiv:2007.11132",0.0,0.8396946564885496,0.16030534351145043,18.0,3.0,0.0,0.35148514851485146
"in this article will be made available via Zenodo.                   Alarcon A., S√°nchez C., Bernstein G. M., Gazta√±aga E., 2020b, MNRAS,",0.0,0.7299270072992701,0.27007299270072993,20.0,10.0,0.0,0.32178217821782173
"                                                                          498, 2614",74.0,0.0963855421686747,0.9036144578313253,2.0,1.0,0.36633663366336633,0.5891089108910892
"                                                                     Albrecht A., et al., 2006, arXiv e-prints, pp astro‚Äìph/0609591",69.0,0.4122137404580153,0.5877862595419847,9.0,1.0,0.3415841584158416,0.35148514851485146
"                                                                     Arnouts S., Cristiani S., Moscardini L., Matarrese S., Lucchin F., Fontana",69.0,0.44755244755244755,0.5524475524475525,11.0,1.0,0.3415841584158416,0.2920792079207921
"ACKNOWLEDGEMENTS                                                          A., Giallongo E., 1999, MNRAS, 310, 540",0.0,0.4336283185840708,0.5663716814159292,8.0,30.0,0.0,0.44059405940594054
"                                                                     Atchison J., Shen S., 1980, Biometrika, 67, 261",69.0,0.3448275862068966,0.6551724137931034,8.0,1.0,0.3415841584158416,0.4257425742574258
"This paper has undergone internal review in the LSST Dark Energy     Ben√≠tez N., 2000, ApJ, 536, 571",0.0,0.8,0.19999999999999996,17.0,3.0,0.0,0.504950495049505
"Science Collaboration. We would like to thank the internal reviewers Benjamin J., et al., 2013, MNRAS, 431, 1547",0.0,0.8482142857142857,0.1517857142857143,18.0,1.0,0.0,0.4455445544554455
"David Alonso, Will Hartley and David Kirkby for their insightful     Benson A. J., 2012, New Astron., 17, 175",0.0,0.8073394495412844,0.19266055045871555,18.0,3.0,0.0,0.46039603960396036
"comments.                                                            Bernstein G., Huterer D., 2010, MNRAS, 401, 1399",0.0,0.42735042735042733,0.5726495726495726,9.0,31.0,0.0,0.42079207920792083
"      MMR led and planned the project from the initial idea and      Bishop C. M., 2006, Pattern Recognition and Machine Learning (Informa-",6.0,0.7769784172661871,0.2230215827338129,21.0,4.0,0.0297029702970297,0.31188118811881194
"motivation to the experimental design. He performed the analyses          tion Science and Statistics). Springer-Verlag, Berlin, Heidelberg",0.0,0.8273381294964028,0.17266187050359716,16.0,6.0,0.0,0.31188118811881194
"                                                                     Bonnett C., 2015, MNRAS, 449, 1043",69.0,0.2815533980582524,0.7184466019417476,6.0,1.0,0.3415841584158416,0.4900990099009901
"in interaction with the coauthors, and prepared the paper. CBM",0.0,0.8548387096774194,0.14516129032258063,10.0,1.0,0.0,0.693069306930693
"                                                                     Bornkamp B., 2011, Journal of Computational and Graphical Statistics, 20,",69.0,0.4507042253521127,0.5492957746478873,10.0,1.0,0.3415841584158416,0.29702970297029707
"contributed by: development of clustering redshifts software, cre-",0.0,0.8939393939393939,0.10606060606060608,8.0,1.0,0.0,0.6732673267326732
                                                                          656,74.0,0.03896103896103896,0.961038961038961,1.0,1.0,0.36633663366336633,0.6188118811881188
"ation of clustering redshifts photometric and spectroscopic sam-     Box G. E. P., Muller M. E., 1958, Ann. Math. Statist., 29, 610",0.0,0.816793893129771,0.18320610687022898,21.0,3.0,0.0,0.35148514851485146
"ples, creation of clustering redshift data products. SJS constructed Brown M. J. I., et al., 2014, ApJS, 212, 18",0.0,0.8392857142857143,0.1607142857142857,19.0,1.0,0.0,0.4455445544554455
"the photometric redshift catalogs and contributed to writing the     Carrasco Kind M., Brunner R. J., 2013, MNRAS, 432, 1483",0.0,0.8225806451612904,0.17741935483870963,19.0,3.0,0.0,0.38613861386138615
"corresponding portions of the paper. SW provided feedback on the     Carroll R. J., Hall P., 1988, Journal of the American Statistical Association,",0.0,0.8299319727891157,0.17006802721088432,22.0,3.0,0.0,0.2722772277227723
"method development and manuscript. RM advised on motivation,              83, 1184",0.0,0.7317073170731707,0.2682926829268293,10.0,8.0,0.0,0.594059405940594
"scope, experimental design, and analysis, and contributed to the     Cawthon R., et al., 2020, arXiv e-prints, p. arXiv:2012.12826",0.0,0.8384615384615385,0.16153846153846152,18.0,3.0,0.0,0.3564356435643564
"editing of the paper draft. YYM developed the access tools for       Chang C., et al., 2016, MNRAS, 459, 3203",0.0,0.7798165137614679,0.22018348623853212,19.0,4.0,0.0,0.46039603960396036
"cosmoDC2 and photo-z data products.                                  Chen T., Guestrin C., 2016, in Proceedings of the 22Nd ACM",0.0,0.6220472440944882,0.3779527559055118,16.0,18.0,0.0,0.3712871287128713
      MMR and RM are supported by DOE grant DE-SC0010118                  SIGKDD International Conference on Knowled ge Discovery,6.0,0.7054263565891473,0.2945736434108527,16.0,10.0,0.0297029702970297,0.3613861386138614
"                                                                          and Data Mining. KDD ‚Äô16. ACM, New York, NY, USA, pp",74.0,0.3333333333333333,0.6666666666666667,11.0,1.0,0.36633663366336633,0.37623762376237624
and NSF grant IIS-1563887. SJS acknowledges support from DOE,0.0,0.8666666666666667,0.1333333333333333,9.0,1.0,0.0,0.7029702970297029
"                                                                          785‚Äì794, doi:10.1145/2939672.2939785, http://doi.acm.org/10.",74.0,0.43283582089552236,0.5671641791044777,3.0,1.0,0.36633663366336633,0.3366336633663366
grant DESC0009999 and NSF/AURA grant N56981C. MMR was                     1145/2939672.2939785,0.0,0.7021276595744681,0.2978723404255319,9.0,11.0,0.0,0.5346534653465347
"supported in part by the Simons Foundation (Simons Investigator      Clerkin L., Kirk D., Lahav O., Abdalla F. B., Gazta√±aga E., 2015, MNRAS,",0.0,0.8156028368794326,0.18439716312056742,22.0,4.0,0.0,0.301980198019802
"Award, PI: Mandelbaum). This material is based upon work sup-             448, 1389",0.0,0.7228915662650602,0.27710843373493976,12.0,7.0,0.0,0.5891089108910892
"ported in part by the National Science Foundation through Cooper-    Collister A. A., Lahav O., 2004, Publications of the Astronomical Society",0.0,0.8380281690140845,0.1619718309859155,21.0,3.0,0.0,0.29702970297029707
"ative Agreement 1258333 managed by the Association of Univer-             of the Pacific, 116, 345",0.0,0.7448979591836735,0.2551020408163265,14.0,7.0,0.0,0.5148514851485149
"sities for Research in Astronomy (AURA), and the Department of       Craig I. J. D., Brown J. C., 1986, Inverse problems in astronomy. A guide to",0.0,0.7931034482758621,0.2068965517241379,25.0,4.0,0.0,0.2821782178217822
Energy under Contract No. DE-AC02-76SF00515 with the SLAC                 inversion strategies for remotely sensed data,0.0,0.7563025210084033,0.24369747899159666,14.0,9.0,0.0,0.4108910891089109
"National Accelerator Laboratory. Additional LSST funding comes       DESI Collaboration et al., 2016, arXiv e-prints, p. arXiv:1611.00036",0.0,0.8467153284671532,0.15328467153284675,16.0,4.0,0.0,0.32178217821782173
"from private donations, grants to universities, and in-kind support  Dalmasso N., Pospisil T., Lee A. B., Izbicki R., Freeman P. E., Malz A. I.,",0.0,0.8333333333333334,0.16666666666666663,24.0,2.0,0.0,0.28712871287128716
"                                                                          2020, Astronomy and Computing, 30, 100362",74.0,0.3130434782608696,0.6869565217391305,6.0,1.0,0.36633663366336633,0.43069306930693074
from LSSTC Institutional Members. SJS acknowledges support,0.0,0.896551724137931,0.10344827586206895,7.0,1.0,0.0,0.7128712871287128
"                                                                     Davis C., et al., 2017, arXiv e-prints, p. arXiv:1710.02517",69.0,0.3984375,0.6015625,9.0,1.0,0.3415841584158416,0.36633663366336633
from DOE grant DE-SC0009999 and NSF/AURA grant N56981C.,0.0,0.8727272727272727,0.12727272727272732,8.0,1.0,0.0,0.7277227722772277
"                                                                     Davison A. C., Hinkley D. V., 2013, Bootstrap Methods and Their Applica-",69.0,0.4326241134751773,0.5673758865248226,12.0,1.0,0.3415841584158416,0.301980198019802
"Support for YYM was provided by NASA through the NASA Hub-                tion. Cambridge University Press, USA",0.0,0.7297297297297297,0.2702702702702703,16.0,9.0,0.0,0.45049504950495045
"ble Fellowship grant no. HST-HF2-51441.001 awarded by the Space      Feldmann R., et al., 2006, MNRAS, 372, 565",0.0,0.8108108108108109,0.18918918918918914,17.0,4.0,0.0,0.45049504950495045
"Telescope Science Institute, which is operated by the Association of Gatti M., et al., 2018, MNRAS, 477, 1664",0.0,0.8440366972477065,0.15596330275229353,18.0,1.0,0.0,0.46039603960396036
"Universities for Research in Astronomy, Incorporated, under NASA     Gatti M., et al., 2020, arXiv e-prints, p. arXiv:2012.08569",0.0,0.84375,0.15625,17.0,3.0,0.0,0.36633663366336633
"contract NAS5-26555.                                                 Gelman A., li Meng X., Stern H., 1996, Statistica Sinica, pp 733‚Äì807",0.0,0.5547445255474452,0.44525547445255476,14.0,25.0,0.0,0.32178217821782173
"      The DESC acknowledges ongoing support from the Insti-          Gelman A., Hwang J., Vehtari A., 2013, arXiv e-prints, p. arXiv:1307.5928",6.0,0.7676056338028169,0.23239436619718312,19.0,6.0,0.0297029702970297,0.29702970297029707
"tut National de Physique Nucl√©aire et de Physique des Particules     Gerdes D. W., Sypniewski A. J., McKay T. A., Hao J., Weis M. R., Wechsler",0.0,0.8028169014084507,0.19718309859154926,25.0,3.0,0.0,0.29702970297029707
"in France; the Science & Technology Facilities Council in the             R. H., Busha M. T., 2010, ApJ, 715, 823",0.0,0.7345132743362832,0.2654867256637168,19.0,7.0,0.0,0.44059405940594054
"                                                                     Graham M. L., et al., 2020, AJ, 159, 258",69.0,0.29357798165137616,0.7064220183486238,9.0,1.0,0.3415841584158416,0.46039603960396036
"United Kingdom; and the Department of Energy, the National Sci-",0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"                                                                     Greisel N., Seitz S., Drory N., Bender R., Saglia R. P., Snigula J., 2015,",69.0,0.42657342657342656,0.5734265734265734,14.0,1.0,0.3415841584158416,0.2920792079207921
"ence Foundation, and the LSST Corporation in the United States.",0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"                                                                          MNRAS, 451, 1848",74.0,0.15555555555555556,0.8444444444444444,3.0,1.0,0.36633663366336633,0.5544554455445545
"DESC uses resources of the IN2P3 Computing Center (CC-IN2P3‚Äì         Hadzhiyska B., Alonso D., Nicola A., Slosar A., 2020, arXiv e-prints, p.",0.0,0.8014184397163121,0.1985815602836879,21.0,5.0,0.0,0.301980198019802
Lyon/Villeurbanne - France) funded by the Centre National de la           arXiv:2007.14989,0.0,0.7777777777777778,0.2222222222222222,11.0,6.0,0.0,0.5544554455445545
"Recherche Scientifique; the National Energy Research Scientific      Hahn C., Beutler F., Sinha M., Berlind A., Ho S., Hogg D. W., 2019,",0.0,0.8161764705882353,0.18382352941176472,21.0,4.0,0.0,0.3267326732673267
"Computing Center, a DOE Office of Science User Facility sup-              MNRAS, 485, 2956",0.0,0.7222222222222222,0.2777777777777778,13.0,8.0,0.0,0.5544554455445545
"ported by the Office of Science of the U.S. Department of Energy     Harris C. R., et al., 2020, Nature, 585, 357‚Äì362",0.0,0.7948717948717948,0.20512820512820518,21.0,3.0,0.0,0.42079207920792083
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,19.873417721518987,1.0,0.0,1.0,1.0,0.0983832560471237,0.9504950495049505
20,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
"Hartley W. G., et al., 2020, MNRAS, 496, 4769                                 Rau M. M., Seitz S., Brimioulle F., Frank E., Friedrich O., Gruen D., Hoyle",0.0,0.6470588235294118,0.3529411764705882,23.0,17.0,0.0,0.24257425742574257
"Hearin A., Korytov D., Kovacs E., Benson A., Aung H., Bradshaw C.,                 B., 2015, MNRAS, 452, 3710",0.0,0.7064220183486238,0.29357798165137616,17.0,9.0,0.0,0.46039603960396036
"    Campbell D., LSST Dark Energy Science Collaboration 2020, MNRAS,          Rau M. M., Hoyle B., Paech K., Seitz S., 2017, MNRAS, 466, 2927",4.0,0.7588652482269503,0.24113475177304966,22.0,6.0,0.019801980198019802,0.301980198019802
"    495, 5040                                                                 Rau M. M., Wilson S., Mandelbaum R., 2020, MNRAS, 491, 4768",4.0,0.41605839416058393,0.583941605839416,13.0,33.0,0.019801980198019802,0.32178217821782173
"Heitmann K., et al., 2019, ApJS, 245, 16                                      Raue A., Kreutz C., Theis F., Timmer J., 2013, Philosophical transac-",0.0,0.6258503401360545,0.37414965986394555,19.0,20.0,0.0,0.2722772277227723
"Heymans C., et al., 2020, arXiv e-prints, p. arXiv:2007.15632                      tions. Series A, Mathematical, physical, and engineering sciences, 371,",0.0,0.7532467532467533,0.24675324675324672,18.0,12.0,0.0,0.2376237623762376
"Hikage C., et al., 2019, PASJ, 71, 43                                              20110544",0.0,0.4175824175824176,0.5824175824175823,9.0,24.0,0.0,0.5495049504950495
"Hildebrandt H., et al., 2017, MNRAS, 465, 1454                                Rothenberg T. J., 1971, Econometrica, 39, 577",0.0,0.6341463414634146,0.36585365853658536,15.0,17.0,0.0,0.3910891089108911
"Hildebrandt H., et al., 2020, arXiv e-prints, p. arXiv:2007.15635             Salvato M., Ilbert O., Hoyle B., 2019, Nature Astronomy, 3, 212",0.0,0.7801418439716312,0.21985815602836878,20.0,7.0,0.0,0.301980198019802
"Hoyle B., 2016, Astronomy and Computing, 16, 34                               S√°nchez C., Bernstein G. M., 2019, MNRAS, 483, 2801",0.0,0.6434108527131783,0.3565891472868217,17.0,16.0,0.0,0.3613861386138614
"Hoyle B., Rau M. M., 2019, MNRAS, 485, 3642                                   S√°nchez C., Raveri M., Alarcon A., Bernstein G. M., 2020, MNRAS,",0.0,0.6267605633802817,0.37323943661971826,20.0,18.0,0.0,0.29702970297029707
"Hoyle B., Rau M. M., Bonnett C., Seitz S., Weller J., 2015, MNRAS, 450,       Schmidt S. J., M√©nard B., Scranton R., Morrison C., McBride C. K., 2013,",0.0,0.7866666666666666,0.21333333333333337,27.0,4.0,0.0,0.25742574257425743
"    305                                                                            MNRAS, 431, 3307",4.0,0.1717171717171717,0.8282828282828283,4.0,39.0,0.019801980198019802,0.5099009900990099
"Hoyle B., et al., 2018, MNRAS, 478, 592‚Äì610                                   Scottez V., et al., 2016, MNRAS, 462, 1683",0.0,0.5916666666666667,0.4083333333333333,16.0,18.0,0.0,0.40594059405940597
"Hunter J. D., 2007, Computing in Science Engineering, 9, 90                   Scranton R., et al., 2005, ApJ, 633, 589",0.0,0.7033898305084746,0.2966101694915254,18.0,10.0,0.0,0.4158415841584159
"Huterer D., Takada M., Bernstein G., Jain B., 2006, MNRAS, 366, 101           Simon P., Hilbert S., 2018, A&A, 613, A15",0.0,0.7563025210084033,0.24369747899159666,20.0,6.0,0.0,0.4108910891089109
"Huterer D., Lin H., Busha M. T., Wechsler R. H., Cunha C. E., 2014,           Speagle J. S., Eisenstein D. J., 2015, arXiv e-prints, p. arXiv:1510.08073",0.0,0.7763157894736842,0.22368421052631582,25.0,6.0,0.0,0.24752475247524752
"    MNRAS, 444, 129                                                           Spergel D., et al., 2015, arXiv e-prints, p. arXiv:1503.03757",4.0,0.4748201438848921,0.525179856115108,12.0,30.0,0.019801980198019802,0.31188118811881194
"Ilbert O., et al., 2006, A&A, 457, 841                                        St√∂lzner B., Joachimi B., Korn A., Hildebrandt H., Wright A. H., 2020,",0.0,0.6081081081081081,0.3918918918918919,20.0,21.0,0.0,0.26732673267326734
"Iveziƒá ≈Ω., et al., 2019, ApJ, 873, 111                                             arXiv e-prints, p. arXiv:2012.07707",0.0,0.5338983050847458,0.4661016949152542,12.0,23.0,0.0,0.4158415841584159
"                                                                              Stoyan D., Stoyan H., 1994, Fractals, Random Shapes and Point",78.0,0.37410071942446044,0.6258992805755396,10.0,1.0,0.38613861386138615,0.31188118811881194
"Izbicki R., Lee A. B., 2017, Electron. J. Statist., 11, 2800",0.0,0.8333333333333334,0.16666666666666663,11.0,1.0,0.0,0.7029702970297029
                                                                                   Fields: Methods of Geometrical Statistics. Wiley Series in Probabil-,83.0,0.3973509933774834,0.6026490066225165,9.0,1.0,0.41089108910891087,0.2524752475247525
"Johnson A., et al., 2016, MNRAS, 465, 4118",0.0,0.8333333333333334,0.16666666666666663,8.0,1.0,0.0,0.7920792079207921
"                                                                                   ity and Statistics, Wiley, https://books.google.com/books?id=",83.0,0.3958333333333333,0.6041666666666667,5.0,1.0,0.41089108910891087,0.28712871287128716
"Jones D. M., Heavens A. F., 2019, MNRAS, 483, 2487",0.0,0.82,0.18000000000000005,10.0,1.0,0.0,0.7524752475247525
                                                                                   Dw3vAAAAMAAJ,83.0,0.12631578947368421,0.8736842105263158,1.0,1.0,0.41089108910891087,0.5297029702970297
"Joudaki S., et al., 2018, MNRAS, 474, 4894",0.0,0.8333333333333334,0.16666666666666663,8.0,1.0,0.0,0.7920792079207921
"                                                                              Tagliaferri R., Longo G., Andreon S., Capozziello S., Donalek C., Giordano",78.0,0.42105263157894735,0.5789473684210527,11.0,1.0,0.38613861386138615,0.24752475247524752
"Joudaki S., et al., 2020, A&A, 638, L1",0.0,0.8157894736842105,0.1842105263157895,8.0,1.0,0.0,0.8118811881188119
"                                                                                   G., 2003, Neural Networks for Photometric Redshifts Evaluation. pp",83.0,0.38926174496644295,0.610738255033557,9.0,1.0,0.41089108910891087,0.2623762376237624
"Kalmbach J. B., Connolly A. J., 2017, AJ, 154, 277",0.0,0.82,0.18000000000000005,10.0,1.0,0.0,0.7524752475247525
"                                                                                   226‚Äì234, doi:10.1007/978-3-540-45216-4_26",83.0,0.3225806451612903,0.6774193548387097,2.0,1.0,0.41089108910891087,0.38613861386138615
"Kluyver T., et al., 2016, in Loizides F., Schmidt B., eds, Positioning and",0.0,0.8378378378378378,0.16216216216216217,13.0,1.0,0.0,0.6336633663366337
"                                                                              Tanaka M., et al., 2018, PASJ, 70, S9",78.0,0.2608695652173913,0.7391304347826086,8.0,1.0,0.38613861386138615,0.43069306930693074
"    Power in Academic Publishing: Players, Agents and Agendas. pp 87 ‚Äì",4.0,0.8,0.19999999999999996,11.0,1.0,0.019801980198019802,0.6534653465346535
"                                                                              The LSST Dark Energy Science Collaboration et al., 2018, arXiv e-prints,",78.0,0.41333333333333333,0.5866666666666667,11.0,1.0,0.38613861386138615,0.25742574257425743
    90,4.0,0.3333333333333333,0.6666666666666667,1.0,1.0,0.019801980198019802,0.9702970297029703
                                                                                   p. arXiv:1809.01669,83.0,0.17647058823529413,0.8235294117647058,2.0,1.0,0.41089108910891087,0.49504950495049505
"Korytov D., et al., 2019, ApJS, 245, 26                                       Uitert E., et al., 2017, MNRAS, 476",0.0,0.5398230088495575,0.4601769911504425,15.0,20.0,0.0,0.44059405940594054
"Kress R., 1998, Numerical Analysis. Graduate Texts in Mathematics,            Varin C., Reid N., Firth D., 2011, Statist. Sinica, pp 5‚Äì42",0.0,0.781021897810219,0.21897810218978098,20.0,7.0,0.0,0.32178217821782173
"    Springer New York, https://books.google.com.na/books?id=                  Virtanen P., et al., 2020, Nature Methods, 17, 261",4.0,0.7421875,0.2578125,13.0,10.0,0.019801980198019802,0.36633663366336633
"    R6182rh0tKEC                                                              Wes McKinney 2010, in St√©fan van der Walt Jarrod Millman eds, Pro-",4.0,0.4652777777777778,0.5347222222222222,13.0,32.0,0.019801980198019802,0.28712871287128716
"Kuusela M. J., 2016, PhD thesis, Lausanne, EPFL, doi:10.5075/epfl-thesis-          ceedings of the 9th Python in Science Conference. pp 56 ‚Äì 61,",0.0,0.7986111111111112,0.20138888888888884,21.0,6.0,0.0,0.28712871287128716
"    7118, http://infoscience.epfl.ch/record/220015                                 doi:10.25080/Majora-92bf1922-00a",4.0,0.6695652173913044,0.33043478260869563,3.0,17.0,0.019801980198019802,0.43069306930693074
"Laureƒ≥s R., et al., 2011, arXiv e-prints, p. arXiv:1110.3193                  Wickham H., Stryjewski L., 2012, Technical report, 40 years of boxplots.",0.0,0.76,0.24,20.0,10.0,0.0,0.25742574257425743
"Leistedt B., Mortlock D. J., Peiris H. V., 2016, MNRAS, 460, 4258                  had.co.nz",0.0,0.6847826086956522,0.3152173913043478,13.0,10.0,0.0,0.5445544554455446
"Ma Z., Hu W., Huterer D., 2006, ApJ, 636, 21                                  Zhou R., et al., 2020a, arXiv e-prints, p. arXiv:2001.06018",0.0,0.6277372262773723,0.3722627737226277,19.0,18.0,0.0,0.32178217821782173
"Malz A. I., Hogg D. W., 2020, arXiv e-prints, p. arXiv:2007.12178             Zhou R., et al., 2020b, Research Notes of the American Astronomical Soci-",0.0,0.7748344370860927,0.22516556291390732,23.0,7.0,0.0,0.2524752475247525
"Mandelbaum R., 2018, ARA&A, 56, 393                                                ety, 4, 181",0.0,0.4148936170212766,0.5851063829787234,9.0,25.0,0.0,0.5346534653465347
"Matarrese S., Coles P., Lucchin F., Moscardini L., 1997, MNRAS, 286, 115      van Daalen M. P., White M., 2018, MNRAS, 476, 4649",0.0,0.796875,0.203125,22.0,4.0,0.0,0.36633663366336633
"McLeod M., Balan S. T., Abdalla F. B., 2017, MNRAS, 466, 3558                 van Rossum G., 1995, Technical Report CS-R9526, Python tutorial. Centrum",0.0,0.7533333333333333,0.2466666666666667,22.0,9.0,0.0,0.25742574257425743
"McQuinn M., White M., 2013, MNRAS, 433, 2857                                       voor Wiskunde en Informatica (CWI), Amsterdam",0.0,0.6015625,0.3984375,14.0,20.0,0.0,0.36633663366336633
"Meister A., 2009, Deconvolution Problems in Nonparametric Statistics. Lec-",0.0,0.8918918918918919,0.10810810810810811,9.0,1.0,0.0,0.6336633663366337
"    ture Notes in Statistics, Springer Berlin Heidelberg, https://books.",4.0,0.8472222222222222,0.1527777777777778,8.0,1.0,0.019801980198019802,0.6435643564356436
    google.de/books?id=ItGkJPZQj-MC,4.0,0.8857142857142857,0.11428571428571432,1.0,1.0,0.019801980198019802,0.8267326732673268
"M√©nard B., Scranton R., Schmidt S., Morrison C., Jeong D., Budavari T.,       APPENDIX A: DERIVING THE E-M UPDATE",0.0,0.7964601769911505,0.20353982300884954,18.0,4.0,0.0,0.44059405940594054
"    Rahman M., 2013, arXiv e-prints, p. arXiv:1303.4722                       EQUATIONS",4.0,0.6206896551724138,0.3793103448275862,8.0,12.0,0.019801980198019802,0.5693069306930694
"Morrison C. B., Hildebrandt H., Schmidt S. J., Baldry I. K., Bilicki M., Choi",0.0,0.8311688311688312,0.16883116883116878,14.0,1.0,0.0,0.6188118811881188
"    A., Erben T., Schneider P., 2017, MNRAS, 467, 3576                        We start the discussion with an intuitive motivation for the theo-",4.0,0.6805555555555556,0.3194444444444444,20.0,13.0,0.019801980198019802,0.28712871287128716
"Myles J., et al., 2020, arXiv e-prints, p. arXiv:2012.08566                   retical foundation of the E-M algorithm. Assume a ‚Äòsystem‚Äô that",0.0,0.7446808510638298,0.25531914893617025,19.0,10.0,0.0,0.301980198019802
"Neal R. M., Hinton G. E., 1993, in Learning in Graphical Models. Kluwer       consists of hidden variables ùëå and observed variables ùëç. We wish",0.0,0.795774647887324,0.204225352112676,24.0,4.0,0.0,0.29702970297029707
"    Academic Publishers, pp 355‚Äì368                                           to find a set of parameters ùúÉ that maximize the joint distribution of",4.0,0.5782312925170068,0.4217687074829932,17.0,22.0,0.019801980198019802,0.2722772277227723
"Newman J. A., 2008, ApJ, 684, 88                                              both variables given ùúÉ. We know from statistical physics that the free",0.0,0.5743243243243243,0.42567567567567566,19.0,24.0,0.0,0.26732673267326734
"Newman J. A., et al., 2015, Astroparticle Physics, 63, 81                     energy of this system ùêπ ( ùëù, ùúÉ) should be minimized and depends on",0.0,0.7013888888888888,0.29861111111111116,24.0,11.0,0.0,0.28712871287128716
"Nicola A., et al., 2020, J. Cosmology Astropart. Phys., 2020, 044             the distribution of hidden variables, or states, ùëù(ùë¶) and the parame-",0.0,0.7755102040816326,0.22448979591836737,22.0,7.0,0.0,0.2722772277227723
"Padmanabhan N., et al., 2005, MNRAS, 359, 237                                 ters of the conditional ùëù(ùë¶|ùëß, ùúÉ). The E-M algorithm performs this",0.0,0.6527777777777778,0.3472222222222222,19.0,17.0,0.0,0.28712871287128716
"Pawitan Y., 2001, In All Likelihood: Statistical Modelling and Inference      minimization iteratively, where we assume an initial choice for ùúÉ.",0.0,0.8333333333333334,0.16666666666666663,20.0,4.0,0.0,0.28712871287128716
"    Using Likelihood. Oxford science publications, OUP Oxford, https:",4.0,0.8405797101449275,0.1594202898550725,8.0,1.0,0.019801980198019802,0.6584158415841583
"                                                                              In the ùê∏-step, we choose a distribution ùëù(ùë¶), while holding ùúÉ fixed,",78.0,0.3904109589041096,0.6095890410958904,12.0,1.0,0.38613861386138615,0.27722772277227725
    //books.google.com/books?id=M-3pSCVxV5oC,4.0,0.9090909090909091,0.09090909090909094,1.0,1.0,0.019801980198019802,0.7821782178217822
"                                                                              so that ùêπ ( ùëù, ùúÉ old ) is minimized. In the subsequent ùëÄ-step we hold",78.0,0.3673469387755102,0.6326530612244898,16.0,1.0,0.38613861386138615,0.2722772277227723
"Perez F., Granger B. E., 2007, Computing in Science Engineering, 9, 21",0.0,0.8428571428571429,0.15714285714285714,12.0,1.0,0.0,0.6534653465346535
"Prat J., et al., 2018, MNRAS, 473, 1667",0.0,0.8205128205128205,0.17948717948717952,8.0,1.0,0.0,0.806930693069307
"                                                                              ùëù fixed, but choose ùúÉ in a way that ùêπ ( ùëù old , ùúÉ) is minimized. This",78.0,0.35374149659863946,0.6462585034013606,18.0,1.0,0.38613861386138615,0.2722772277227723
"Quiroz M., Villani M., Kohn R., Tran M.-N., Dang K.-D., 2018, arXiv           procedure is iterated until the free energy does not change much",0.0,0.7746478873239436,0.22535211267605637,23.0,6.0,0.0,0.29702970297029707
"    e-prints, p. arXiv:1807.08409                                             with additional iterations, i.e., the scheme converges. In practical",4.0,0.5958904109589042,0.40410958904109584,12.0,23.0,0.019801980198019802,0.27722772277227725
"Raccanelli A., Rahman M., Kovetz E. D., 2017, MNRAS, 468, 3650                calculations, the connection with the variational free energy is not",0.0,0.7602739726027398,0.23972602739726023,21.0,9.0,0.0,0.27722772277227725
"Ranganathan A., 2004, Assumed Density Filtering, http://www.ananth.           often used, but it is a useful concept to build up an intuitive under-",0.0,0.7972972972972973,0.20270270270270274,21.0,6.0,0.0,0.26732673267326734
    in/Notes_files/adf.pdf                                                    standing of the method. We refer the interested reader to Neal &,4.0,0.528169014084507,0.471830985915493,13.0,27.0,0.019801980198019802,0.29702970297029707
"                                                                                                                                 MNRAS 000, 1‚Äì22 (2015)",129.0,0.12582781456953643,0.8741721854304636,4.0,1.0,0.6386138613861386,0.2524752475247525
avr_spaces,15.0,1.0,0.0,1.0,1.0,0.07425742574257425,0.9504950495049505
                                                                                                       Likelihood Inference under Photo-z error                                               21,103.0,0.19791666666666666,0.8020833333333334,6.0,24.0,0.5099009900990099,0.04950495049504955
Hinton (1993) for a more detailed explanation. In the following we                                       E-step: Given an old parameter vector ùúãold we evaluate,0.0,0.6415094339622641,0.3584905660377359,20.0,20.0,0.0,0.21287128712871284
will describe the derivation of the E-M algorithm in the concrete,0.0,0.8461538461538461,0.15384615384615385,11.0,1.0,0.0,0.6782178217821782
"context of finding the maximum likelihood solution of our photo-                                 ùëù(ùúª | FÃÇ,œÄold ) ‚àù                                                                           (A7)",0.0,0.37305699481865284,0.6269430051813472,16.0,54.0,0.0,0.044554455445544594
"metric likelihood. For that we will use a different notation, however                                       ùëÅgal √ñ",0.0,0.5614035087719298,0.4385964912280702,13.0,20.0,0.0,0.4356435643564357
                                                                                                                 ùëÅtot             ‚à´ ùëßùëò               ‚à´ ùõºùëò                                          ! ùúÅùõΩj,113.0,0.07,0.9299999999999999,7.0,35.0,0.5594059405940595,0.00990099009900991
                                                                                                            √ñ                            ùëÖ                   ùëÖ,108.0,0.0189873417721519,0.9810126582278481,3.0,24.0,0.5346534653465347,0.2178217821782178
"the intuition remains unchanged, if we associate the free energy (up                                                     ùúãj,old             dùëß ùõΩ                dùõº ùõΩ ùëù(f ùõΩ |T (ùëß ùõΩ , ùõº ùõΩ ), Œ£ ùõΩ )        .",0.0,0.43564356435643564,0.5643564356435644,29.0,45.0,0.0,0.0
"to a sign) with the term L (ùëû, ùùÖ) in Eq. (A3).                                                              ùõΩ=1 ùëó=1                 ùëß ùêøùëò                 ùõºùêøùëò",0.0,0.30128205128205127,0.6987179487179487,17.0,48.0,0.0,0.2277227722772277
"      To derive the Expectation-Maximization algorithm21 , we first                                                                                                                          (A8)",6.0,0.3005181347150259,0.6994818652849741,9.0,62.0,0.0297029702970297,0.044554455445544594
introduce the parameter vector Œ∂ùëñ for each galaxy ùëñ that is a ùëÅtot,0.0,0.8181818181818182,0.18181818181818177,13.0,1.0,0.0,0.6732673267326732
dimensional vector to indicate bin membership22 in the ‚Äò1-hot en-                                        M-step: In the maximization step of the algorithm we want to,0.0,0.6424242424242425,0.35757575757575755,21.0,21.0,0.0,0.18316831683168322
"coding‚Äô scheme. This means that for each galaxy, we have a ùëÅtot                                  maximize the expected data log-likelihood with respect to the pa-",0.0,0.6666666666666666,0.33333333333333337,22.0,18.0,0.0,0.19801980198019797
"dimensional binary vector, where (‚Äò0‚Äô/‚Äò1‚Äô) indicates that the galaxy                             rameter ùúª. Given the updated posterior ùëù(ùúª | FÃÇ, œÄold ) this expectation",0.0,0.7100591715976331,0.2899408284023669,22.0,15.0,0.0,0.1633663366336634
(resides/does not reside) in the respective redshift bin. For the re-                            is given as:,0.0,0.6330275229357798,0.3669724770642202,14.0,15.0,0.0,0.46039603960396036
mainder of this section we will work with the normed histogram bin,0.0,0.8333333333333334,0.16666666666666663,12.0,1.0,0.0,0.6732673267326732
heights œÄ = n ùêµ Œîùëß that parametrize the prior distribution over ùëß ‚àí ùõº                                                     ùëÅ      ùëÅtot,0.0,0.45112781954887216,0.5488721804511278,17.0,30.0,0.0,0.34158415841584155
                                                                                                                            gal ‚àëÔ∏Å,124.0,0.038461538461538464,0.9615384615384616,2.0,1.0,0.6138613861386139,0.3564356435643564
as defined in Eq. 13. The prior distribution over ùúª 23 is then given,0.0,0.8088235294117647,0.19117647058823528,14.0,1.0,0.0,0.6633663366336633
                                                                                                                          ‚àëÔ∏Å                ,122.0,0.028169014084507043,0.971830985915493,3.0,8.0,0.6039603960396039,0.29702970297029707
"                                                                                                 ùëÜ (œÄnew , œÄold ) =                     ùê∏ ùúÅùõΩ j √ó",97.0,0.125,0.875,10.0,11.0,0.4801980198019802,0.28712871287128716
as                                                                                                                        ùõΩ=1 ùëó=1,0.0,0.06201550387596899,0.937984496124031,3.0,61.0,0.0,0.3613861386138614
            √ñ     ùëÅgal,12.0,0.22727272727272727,0.7727272727272727,2.0,3.0,0.0594059405940594,0.8910891089108911
"             ùëÅtot √ñ                                                                                                        ‚à´ ùëßùëó              ‚à´ ùõºùëó                                            !! ,",13.0,0.07253886010362694,0.927461139896373,8.0,82.0,0.06435643564356436,0.044554455445544594
                          ùúÅ                                                                                   ,26.0,0.026785714285714284,0.9732142857142857,3.0,42.0,0.12871287128712872,0.4455445544554455
"ùëù(ùúª |œÄ) ‚àù               ùúã ùëòùëõ,ùëò ,                                                  (A1)             log ùúã ùõΩj + log",0.0,0.23893805309734514,0.7610619469026548,12.0,39.0,0.0,0.44059405940594054
                                                                                                                                  ùëÖ,130.0,0.007633587786259542,0.9923664122137404,1.0,1.0,0.6435643564356436,0.35148514851485146
                                                                                                                                      dùëß ùõΩ,134.0,0.021739130434782608,0.9782608695652174,2.0,1.0,0.6633663366336634,0.3168316831683168
                                                                                                                                                      ùëÖ,150.0,0.006622516556291391,0.9933774834437086,1.0,1.0,0.7425742574257426,0.2524752475247525
"                                                                                                                                                          dùõº ùõΩ ùëù(f ùõΩ |T (ùëß ùõΩ , ùõº ùõΩ ), Œ£ ùõΩ )",154.0,0.10695187165775401,0.893048128342246,14.0,1.0,0.7623762376237624,0.07425742574257421
                                                                                                                               ùëó                   ùëó,127.0,0.013513513513513514,0.9864864864864865,2.0,10.0,0.6287128712871287,0.26732673267326734
            ùëò=1 ùëõ=1                                                                                                          ùëßùêø                ùõºùêø,12.0,0.06896551724137931,0.9310344827586207,4.0,62.0,0.0594059405940594,0.2821782178217822
        √ç ùëÅtot,8.0,0.35714285714285715,0.6428571428571428,2.0,1.0,0.039603960396039604,0.9306930693069306
where ùëò=1      ùúã ùëò = 1. Using ùúª we can write the conditional distribu-                                                                                                                       (A9),0.0,0.29015544041450775,0.7098445595854923,15.0,63.0,0.0,0.044554455445544594
tion of the measured photometry given ùúª as                                                       where,0.0,0.39215686274509803,0.607843137254902,9.0,28.0,0.0,0.49504950495049505
                ùëÅ  gal ùëÅ          ùëò               ùëò,16.0,0.13725490196078433,0.8627450980392157,5.0,14.0,0.07920792079207921,0.7475247524752475
"                                                                                        ! ùúÅùõΩ,k",88.0,0.05319148936170213,0.9468085106382979,2.0,1.0,0.43564356435643564,0.5346534653465347
                        tot  ‚à´   ùëßùëÖ         ‚à´   ùõºùëÖ                                                               √ç          ùëõùëò,24.0,0.09523809523809523,0.9047619047619048,7.0,44.0,0.1188118811881188,0.37623762376237624
"                                                                                               . ùê∏  ùúÅ  = ùúÅùëõ,ùëò ùúÅ ùëù(ùúÅ ùëõùëò | FÃÇ, œÄold )",95.0,0.18796992481203006,0.8120300751879699,14.0,1.0,0.47029702970297027,0.34158415841584155
                √ñ√ñ,16.0,0.1111111111111111,0.8888888888888888,1.0,1.0,0.07920792079207921,0.9108910891089109
"ùëù( FÃÇ|ùúª, œÄ) ‚àù                        dùëß ùõΩ             dùõº ùõΩ ùëù(f ùõΩ |T (ùëß ùõΩ , ùõº ùõΩ ), Œ£ ùõΩ )",0.0,0.3793103448275862,0.6206896551724138,20.0,19.0,0.0,0.5693069306930694
                              ùëßùêøùëò             ùõºùêøùëò                                                        ùõΩj        √ç,30.0,0.07758620689655173,0.9224137931034483,4.0,39.0,0.1485148514851485,0.4257425742574258
"                ùõΩ=1 ùëò=1                                                                                                ùúÅùëõùëò ùëù(ùúÅ ùëõ,ùëò | FÃÇ, œÄold )",16.0,0.16783216783216784,0.8321678321678322,9.0,49.0,0.07920792079207921,0.2920792079207921
                                                                                  (A2)                                      ‚à´ ùëßùëñ            ‚à´ ùõºùëñ,82.0,0.06944444444444445,0.9305555555555556,5.0,26.0,0.40594059405940597,0.28712871287128716
"                                                                                                                   ùúãi,old ùëñ ùëÖ dùëß ùõΩ ùëñ ùëÖ dùõº ùõΩ ùëù(f ùõΩ |T (ùëß ùõΩ , ùõº ùõΩ ), Œ£ ùõΩ )",115.0,0.19642857142857142,0.8035714285714286,21.0,1.0,0.5693069306930693,0.16831683168316836
It is important at this point to note that a marginalization over the                                                        ùëß ùêø              ùõºùêø,0.0,0.4236111111111111,0.5763888888888888,16.0,36.0,0.0,0.28712871287128716
                                                                                                             =                      ùëó,109.0,0.015037593984962405,0.9849624060150376,2.0,12.0,0.5396039603960396,0.34158415841584155
"parameter vectors ùúÅùëñ for all galaxies will yield the second, i.e. the                                            √ç             ‚à´  ùëß            ‚à´ ùõºùëó",0.0,0.43537414965986393,0.564625850340136,17.0,36.0,0.0,0.2722772277227723
"                                                                                                                    ùëó ùúãj,old ùëó dùëß",116.0,0.07751937984496124,0.9224806201550387,4.0,1.0,0.5742574257425742,0.3613861386138614
                                                                                                                                    ùëÖ       ùõΩ,132.0,0.014184397163120567,0.9858156028368794,2.0,4.0,0.6534653465346535,0.301980198019802
                                                                                                                                                     ùëó,149.0,0.006666666666666667,0.9933333333333333,1.0,1.0,0.7376237623762376,0.25742574257425743
                                                                                                                                                       ùëÖ,151.0,0.006578947368421052,0.993421052631579,1.0,1.0,0.7475247524752475,0.24752475247524752
"                                                                                                                                                          dùõº ùõΩ ùëù(f ùõΩ |T (ùëß ùõΩ , ùõº ùõΩ ), Œ£ ùõΩ )",154.0,0.10695187165775401,0.893048128342246,14.0,1.0,0.7623762376237624,0.07425742574257421
"likelihood, term in Eq. (15).                                                                                                    ùëßùêø               ùõºùêø",0.0,0.19594594594594594,0.8040540540540541,7.0,58.0,0.0,0.26732673267326734
      To derive the iterative optimization scheme we first consider                                                                                                                        (A10),6.0,0.3020833333333333,0.6979166666666667,10.0,61.0,0.0297029702970297,0.04950495049504955
the decomposition of the posterior as                                                                                                                                               √ç,0.0,0.18681318681318682,0.8131868131868132,8.0,72.0,0.0,0.09900990099009899
"                                                                                                 We optimize ùëÜ nzz,t,new , nzz,t,old under the constraint ùëò ùúã ùëò = 1",97.0,0.32515337423312884,0.6748466257668712,14.0,1.0,0.4801980198019802,0.19306930693069302
"log ùëù(ùùÖ| FÃÇ) = L (ùëû, ùùÖ) + ùêæ ùêø (ùëû|| ùëù) + log ùëù(ùùÖ) ‚àí log ùëù( FÃÇ) ,                   (A3)",0.0,0.5581395348837209,0.4418604651162791,21.0,10.0,0.0,0.5742574257425743
                                                                                                 using the Lagrange multiplier formalism:,97.0,0.26277372262773724,0.7372262773722628,5.0,1.0,0.4801980198019802,0.32178217821782173
where                                                                                                                                                                    !,0.0,0.03529411764705882,0.9647058823529412,2.0,83.0,0.0,0.15841584158415845
                                              !                                                                                                              ‚àëÔ∏Å,46.0,0.018867924528301886,0.9811320754716981,2.0,56.0,0.22772277227722773,0.21287128712871284
"               ‚àëÔ∏Å                   ùëù( FÃÇ, ùúª)                                                    ùëÜ (œÄnew , œÄold ) = ùëÜ (œÄnew , œÄold ) + ùúÜ                          ùúãùëò ‚àí 1",15.0,0.23809523809523808,0.7619047619047619,20.0,49.0,0.07425742574257425,0.16831683168316836
" L (ùëû, nB ) =         ùëû(ùúª) log                                                    (A4)                                                                                                     (A11)",1.0,0.125,0.875,9.0,81.0,0.0049504950495049506,0.04950495049504955
                                     ùëû(ùúª)                                                                                                                      ùëò,37.0,0.03125,0.96875,2.0,60.0,0.18316831683168316,0.20792079207920788
                 ùúª,17.0,0.05555555555555555,0.9444444444444444,1.0,1.0,0.08415841584158416,0.9108910891089109
                                                    !,52.0,0.018867924528301886,0.9811320754716981,1.0,1.0,0.25742574257425743,0.7376237623762376
"                   ‚àëÔ∏Å                 ùëù(ùúª | FÃÇ, ùùÖ)                                               Equating ‚àáœÄ ùëÜ (œÄnew , œÄold ) == 0, performing a summation over ùëò,",19.0,0.3888888888888889,0.6111111111111112,19.0,32.0,0.09405940594059406,0.19801980198019797
"ùêæ ùêø(ùëû|| ùëù) = ‚àí          ùëû(ùúª) log                                                  (A5)           and using the summation constraint of œÄ, we obtain",0.0,0.42857142857142855,0.5714285714285714,17.0,36.0,0.0,0.2722772277227723
                                          ùëû(Œ∂),42.0,0.08695652173913043,0.9130434782608696,1.0,1.0,0.2079207920792079,0.7722772277227723
                    ùúª,20.0,0.047619047619047616,0.9523809523809523,1.0,1.0,0.09900990099009901,0.8960396039603961
                                                                                                 ‚àíùúÜ = ùëÅgal .                                                                               (A12),97.0,0.06770833333333333,0.9322916666666666,5.0,40.0,0.4801980198019802,0.04950495049504955
This decomposition implies an iterative scheme to maximize,0.0,0.8793103448275862,0.12068965517241381,8.0,1.0,0.0,0.7128712871287128
"log ùëù(ùùÖ| FÃÇ). Given an initial parameter vector ùùÖ old , we first minimize                        This leads to the update equations for the E-M scheme that are",0.0,0.6981132075471698,0.30188679245283023,26.0,13.0,0.0,0.21287128712871284
"ùêæ ùêø(ùëû|| ùëù) in the ‚ÄòE-step‚Äô which directly implies ùëû(Œ∂) = ùëù(ùúª | FÃÇ, ùùÖ).                           iterated until we reach convergence in œÄ 24 :",0.0,0.6549295774647887,0.34507042253521125,24.0,14.0,0.0,0.29702970297029707
"In the ‚ÄòM‚Äô-step we fix the distribution ùëû(Œ∂) and maximize L (ùëû, ùùÖ).",0.0,0.8208955223880597,0.17910447761194026,13.0,1.0,0.0,0.6683168316831682
This maximization directive is then given as                                                                                      ‚à´ ùëßùëò         ‚à´ ùõºùëò,0.0,0.29931972789115646,0.7006802721088435,11.0,48.0,0.0,0.2722772277227723
"                                                                                                                                     ùëò dùëß ùëñ ùõº ùëò dùõºùëñ ùëù( fÃÇi |T (ùëß ùëñ , ùõºùëñ ), Œ£ùëñ )",133.0,0.15428571428571428,0.8457142857142858,16.0,1.0,0.6584158415841584,0.13366336633663367
                                                                                                                 ùëÅ                     ùëÖ               ùëÖ,113.0,0.019736842105263157,0.9802631578947368,3.0,18.0,0.5594059405940595,0.24752475247524752
                                                                                                                   gal ¬©                                                                         ¬™,115.0,0.02577319587628866,0.9742268041237113,3.0,37.0,0.5693069306930693,0.03960396039603964
                            ‚àëÔ∏Å                                                                     ùë°      ùë°‚àí1,16.0,0.07207207207207207,0.9279279279279279,5.0,43.0,0.07920792079207921,0.45049504950495045
                                                                                                                 ‚àëÔ∏Å    ¬≠           ùëß                                                             ¬Æ,113.0,0.02577319587628866,0.9742268041237113,4.0,38.0,0.5594059405940595,0.03960396039603964
"L (ùëû, ùùÖ) = ùëÜ ùùÖ, ùùÖ old =              ùëù(ùúª | FÃÇ, ùùÖ old ) log ùëù( FÃÇ, ùúª |ùùÖ) + const. ,",0.0,0.573170731707317,0.426829268292683,23.0,8.0,0.0,0.594059405940594
                                                                                                                                     ùêø               ùêø,133.0,0.013333333333333334,0.9866666666666667,2.0,8.0,0.6584158415841584,0.25742574257425743
                                                                                                 ùëÅùëò = ùúãùëò               ¬≠,97.0,0.05,0.95,4.0,8.0,0.4801980198019802,0.40594059405940597
                                                                                                                       ¬≠√ç                       ùëó               ùëó,119.0,0.024844720496894408,0.9751552795031055,3.0,19.0,0.5891089108910891,0.20297029702970293
                                                                                                                                                                                                 ¬Æ,193.0,0.005154639175257732,0.9948453608247423,1.0,1.0,0.9554455445544554,0.03960396039603964
                                                                                                                                                                                                 ¬Æ,193.0,0.005154639175257732,0.9948453608247423,1.0,1.0,0.9554455445544554,0.03960396039603964
                                                                                                                            ùëÅ        ùë°‚àí1,124.0,0.029411764705882353,0.9705882352941176,2.0,5.0,0.6138613861386139,0.3267326732673267
                                                                                                                                           ‚à´  ùëßùëÖ           ‚à´  ùõºùëÖ,139.0,0.0375,0.9625,4.0,8.0,0.6881188118811881,0.20792079207920788
"                                                                                                                                                               ùëó dùõºùëñ ùëù( fÃÇi |T (ùëß ùëñ , ùõºùëñ ), Œ£ùëñ )",159.0,0.11458333333333333,0.8854166666666666,12.0,1.0,0.7871287128712872,0.04950495049504955
                                                                                                                 ùëñ=1   ¬≠      tot                                                                ¬Æ,113.0,0.041237113402061855,0.9587628865979382,4.0,37.0,0.5594059405940595,0.03960396039603964
                                  ùúª                                                                                         ùëó=1 ùëó,34.0,0.03875968992248062,0.9612403100775194,3.0,45.0,0.16831683168316833,0.3613861386138614
                                                                                                                                   ùúã          ùëó dùëß ùëñ,131.0,0.033783783783783786,0.9662162162162162,4.0,6.0,0.6485148514851485,0.26732673267326734
                                                                                                                       ¬´                     ùëßùêø              ùõºùêø                                  ¬¨,119.0,0.030927835051546393,0.9690721649484536,4.0,35.0,0.5891089108910891,0.03960396039603964
                                                                                  (A6)                                                                                                     (A13),82.0,0.046875,0.953125,2.0,51.0,0.40594059405940597,0.04950495049504955
which is the expectation of the data log-likelihood with respect to                                          ùëÅ ùë°‚àí1,0.0,0.5350877192982456,0.4649122807017544,13.0,22.0,0.0,0.4356435643564357
"ùúª. After a new parameter vector ùùÖ new is obtained, we continue with                               ùúã ùë°ùëò = √ç ùëò ùë°‚àí1 .                                                                         (A14)",0.0,0.3645833333333333,0.6354166666666667,21.0,52.0,0.0,0.04950495049504955
the ‚ÄòE‚Äô-step holding ùùÖ new fixed. This process is continued until                                            ùëò ùëÅùëò,0.0,0.5132743362831859,0.48672566371681414,13.0,23.0,0.0,0.44059405940594054
convergence. In the following we will derive the corresponding,0.0,0.8709677419354839,0.12903225806451613,9.0,1.0,0.0,0.693069306930693
                                                                                                         In appendix B we will derive a Laplace approximation to the,105.0,0.29878048780487804,0.7012195121951219,11.0,1.0,0.5198019801980198,0.18811881188118806
update equations.,0.0,0.9411764705882353,0.05882352941176472,2.0,1.0,0.0,0.9158415841584159
                                                                                                 posterior based on this optimization scheme. We apply and discuss,97.0,0.345679012345679,0.654320987654321,10.0,1.0,0.4801980198019802,0.19801980198019797
                                                                                                 this scheme in ¬ß 4 and ¬ß 8.,97.0,0.16129032258064516,0.8387096774193549,8.0,1.0,0.4801980198019802,0.38613861386138615
21  The interested reader will find the following derivation in analogy to the,0.0,0.8333333333333334,0.16666666666666663,13.0,2.0,0.0,0.6138613861386139
derivation to the E-M update equations for the Gaussian Mixture model (see,0.0,0.8513513513513513,0.14864864864864868,12.0,1.0,0.0,0.6336633663366337
Bishop 2006).,0.0,0.9230769230769231,0.07692307692307687,2.0,1.0,0.0,0.9356435643564356
22 We are referring to bins as defined in Eq. (13).                                              24    In practice we would iterate until the log-likelihood changes only by an,0.0,0.5942857142857143,0.4057142857142857,24.0,26.0,0.0,0.13366336633663367
"23 Here, ùúª denotes the collection of Œ∂ vectors of all galaxies.                                  extremely small amount.",0.0,0.6083333333333333,0.3916666666666667,15.0,18.0,0.0,0.40594059405940597
"MNRAS 000, 1‚Äì22 (2015)",0.0,0.8636363636363636,0.13636363636363635,4.0,1.0,0.0,0.8910891089108911
avr_spaces,51.845454545454544,1.0,0.0,1.0,1.0,0.25666066606660665,0.9504950495049505
22,0.0,1.0,0.0,1.0,1.0,0.0,0.9900990099009901
"APPENDIX B: DERIVING THE LAPLACE                                                                   Transformed into probability, or simplex, space, this posterior is",0.0,0.5212121212121212,0.47878787878787876,14.0,34.0,0.0,0.18316831683168322
APPROXIMATION                                                                                      then identified as a logit-normal distribution,0.0,0.3724137931034483,0.6275862068965516,7.0,44.0,0.0,0.2821782178217822
In the previous appendix we derived an iterative scheme to obtain                                                  1            1,0.0,0.4418604651162791,0.5581395348837209,13.0,32.0,0.0,0.3613861386138614
                                                                                                   ùëù(ùùÖ| FÃÇ) ‚âà ‚àöÔ∏Å          √é ùëÅbins                                      (B11),99.0,0.12209302325581395,0.877906976744186,7.0,25.0,0.4900990099009901,0.14851485148514854
maximum likelihood estimates of the vector of normed histogram                                                   |2ùúãùö∫y |           ùúãùëñ,0.0,0.46616541353383456,0.5338345864661654,12.0,31.0,0.0,0.34158415841584155
                                                                                                                             ùëñ=1,125.0,0.0234375,0.9765625,1.0,1.0,0.6188118811881188,0.36633663366336633
heights ùùÖ ML based on the E-M algorithm. We note that the E-M,0.0,0.8032786885245902,0.19672131147540983,13.0,1.0,0.0,0.698019801980198
                                                                                                                       ùùÖ ‚àíNbins                         ùùÖ ‚àíNbins,119.0,0.0875,0.9125,4.0,13.0,0.5891089108910891,0.20792079207920788
                                                                                                                                                                    ,104.0,0.05747126436781609,0.9425287356321839,9.0,30.0,0.5148514851485149,0.13861386138613863
"algorithm is guaranteed to produce a maximum likelihood estimate                                    exp ‚àí0.5 log                  ‚àí ùùÅy,ML ùö∫‚àí1y    log              ‚àí ùùÅ y,ML .",0.0,0.49710982658959535,0.5028901734104047,20.0,37.0,0.0,0.14356435643564358
ùùÖ ML that lies on the simplex. The direct application of the Laplace                                                   ùúã ùëÅbins                          ùúã ùëÅbins,0.0,0.4276729559748428,0.5723270440251572,17.0,39.0,0.0,0.21287128712871284
approximation will effectively estimate Gaussian errors on the val-                                                                                                    (B12),0.0,0.37209302325581395,0.627906976744186,10.0,51.0,0.0,0.14851485148514854
ues. Applying this approximation around ùúãML will lead to posteriors                                We note that the logit-normal is a probability distribution on the,0.0,0.6909090909090909,0.3090909090909091,21.0,17.0,0.0,0.18316831683168322
"that reach to negative values, i.e. the posterior draws are not guar-                              simplex, just as the Dirichlet. In fact, the Dirichlet can be approxi-",0.0,0.6923076923076923,0.3076923076923077,24.0,16.0,0.0,0.1633663366336634
anteed to lie on the simplex. To extend the Laplace approximation                                  mated well by a logit-normal (Atchison & Shen 1980). However the,0.0,0.6687116564417178,0.3312883435582822,22.0,18.0,0.0,0.19306930693069302
"to random variables that lie on the simplex, we first consider a                                   logit-normal allows for a more complex covariance structure. The",0.0,0.6687116564417178,0.3312883435582822,21.0,18.0,0.0,0.19306930693069302
mapping from simplex space to R ùëÅbins ‚àí1 . This mapping is realized                                scheme developed in this appendix is applied and analysed in ¬ß 4,0.0,0.6625766871165644,0.33742331288343563,25.0,17.0,0.0,0.19306930693069302
"by the additive logistic transformation. Assume y ‚àà R ùëÅbins ‚àí1 , we                                and ¬ß 8.",0.0,0.5700934579439252,0.4299065420560748,16.0,17.0,0.0,0.47029702970297027
define the function,0.0,0.8947368421052632,0.10526315789473684,3.0,1.0,0.0,0.905940594059406
                                                                                              !ùëá   This paper has been typeset from a TEX/LATEX file prepared by the author.,94.0,0.36627906976744184,0.6337209302325582,14.0,2.0,0.46534653465346537,0.14851485148514854
                       ùëí ùë¶1                               ùëí ùë¶Nbins ‚àí1             1,23.0,0.1566265060240964,0.8433734939759037,6.0,22.0,0.11386138613861387,0.5891089108910892
"ùùÖ(y) =              √ç ùëÅbins ‚àí1 ùë¶        ,  .  .  . ,      √ç ùëÅbins ‚àí1 ùë¶     ,   √ç ùëÅbins ‚àí1 ùë¶      ,",0.0,0.3979591836734694,0.6020408163265306,21.0,24.0,0.0,0.5148514851485149
             1 + ùëñ=1                ùëí ùëñ              1 + ùëñ=1           ùëí ùëñ 1 + ùëñ=1        ùëí ùëñ,13.0,0.22580645161290322,0.7741935483870968,15.0,25.0,0.06435643564356436,0.5396039603960396
                                                                                         (B1),89.0,0.043010752688172046,0.956989247311828,1.0,1.0,0.4405940594059406,0.5396039603960396
with its inverse,0.0,0.875,0.125,3.0,1.0,0.0,0.9207920792079208
                                                                            ,11.0,0.02564102564102564,0.9743589743589743,2.0,33.0,0.054455445544554455,0.6138613861386139
"y(ùùÖ) = log (ùúã1 /ùúã ùëÅbins ), . . . , log (ùúã ùëÅbins ‚àí1 /ùúã ùëÅbins ) .                          (B2)",0.0,0.5268817204301075,0.4731182795698925,20.0,14.0,0.0,0.5396039603960396
       We see that the transformed variables y are now defined in real,7.0,0.7428571428571429,0.2571428571428571,12.0,1.0,0.034653465346534656,0.6534653465346535
space and we perform the Laplace approximation as usual. Assum-,0.0,0.8571428571428571,0.1428571428571429,10.0,1.0,0.0,0.6881188118811881
"ing a flat prior in logistic space, we can directly utilize the invariance",0.0,0.8378378378378378,0.16216216216216217,13.0,1.0,0.0,0.6336633663366337
of the Maximum Likelihood estimate under variable transforma-,0.0,0.8852459016393442,0.11475409836065575,8.0,1.0,0.0,0.698019801980198
tions (see e.g. Pawitan 2001) and approximate the posterior,0.0,0.864406779661017,0.13559322033898302,9.0,1.0,0.0,0.7079207920792079
"ùëù(y| FÃÇ) = N (y| ùùÅML , ùö∫) ,                                                              (B3)",0.0,0.24731182795698925,0.7526881720430108,10.0,32.0,0.0,0.5396039603960396
where,0.0,1.0,0.0,1.0,1.0,0.0,0.9752475247524752
"ùùÅy ML = y(ùùÖ ML ) ,                                                                       (B4)",0.0,0.17204301075268819,0.8279569892473118,8.0,36.0,0.0,0.5396039603960396
and,0.0,1.0,0.0,1.0,1.0,0.0,0.9851485148514851
ùö∫ùíö = ‚àí H‚àí1                      .                                                        (B5),0.0,0.12903225806451613,0.8709677419354839,6.0,40.0,0.0,0.5396039603960396
                    y=yML,20.0,0.2,0.8,1.0,1.0,0.09900990099009901,0.8762376237623762
Here H is the hessian of the log-likelihood (the second term in,0.0,0.8253968253968254,0.17460317460317465,12.0,1.0,0.0,0.6881188118811881
Eq. (15)) as a function of y evaluated at y(ùùÖ ML ).,0.0,0.7843137254901961,0.21568627450980393,12.0,1.0,0.0,0.7475247524752475
       The components of the hessian are given as,7.0,0.7142857142857143,0.2857142857142857,8.0,1.0,0.034653465346534656,0.7574257425742574
                     √ç                    √ç                       ,21.0,0.13513513513513514,0.8648648648648649,8.0,19.0,0.10396039603960396,0.6336633663366337
             ùëÅ  gal,13.0,0.21052631578947367,0.7894736842105263,2.0,2.0,0.06435643564356436,0.905940594059406
                          ùëÅtot ùúï ùúã ùëó                      ùëÅtot ùúï ùúã ùëó,26.0,0.20588235294117646,0.7941176470588236,8.0,12.0,0.12871287128712872,0.6633663366336633
             ‚àëÔ∏Å           ùëó         ùúïùë¶ùëß      ùêº  ùëñ ùëó       ùëó=1 ùúïùë¶ùëé ùëñ ùëó,13.0,0.2463768115942029,0.7536231884057971,10.0,17.0,0.06435643564356436,0.6584158415841583
                                                                         ùêº,73.0,0.013513513513513514,0.9864864864864865,1.0,1.0,0.3613861386138614,0.6336633663366337
ùêª ùëéùëß = ‚àí                               √ç                   2                           (B6),0.0,0.13978494623655913,0.8602150537634409,7.0,38.0,0.0,0.5396039603960396
             ùëñ=1                             ùëÅtot,13.0,0.14285714285714285,0.8571428571428572,2.0,15.0,0.06435643564356436,0.7574257425742574
                                                     ùúã,53.0,0.018518518518518517,0.9814814814814815,1.0,1.0,0.2623762376237624,0.7326732673267327
                                             ùëó=1 ùëó ùëñ ùëó,45.0,0.1111111111111111,0.8888888888888888,4.0,1.0,0.22277227722772278,0.7326732673267327
                                                        ùêº,56.0,0.017543859649122806,0.9824561403508771,1.0,1.0,0.27722772277227725,0.7178217821782178
          ùëÅ gal                          ùëÅ,10.0,0.11904761904761904,0.8809523809523809,3.0,14.0,0.04950495049504951,0.7920792079207921
                                                               !,63.0,0.015625,0.984375,1.0,1.0,0.3118811881188119,0.6831683168316831
          ‚àëÔ∏Å               1            ‚àëÔ∏Å  tot,10.0,0.1702127659574468,0.8297872340425532,4.0,15.0,0.04950495049504951,0.7673267326732673
                                                      ùúï2 ùúã ùëó,54.0,0.06666666666666667,0.9333333333333333,3.0,1.0,0.26732673267326734,0.7029702970297029
"       +         √ç                                              ùêºùëñ ùëó ,                 (B7)",7.0,0.12903225806451613,0.8709677419354839,7.0,35.0,0.034653465346534656,0.5396039603960396
                      ùëÅtot,22.0,0.15384615384615385,0.8461538461538461,1.0,1.0,0.10891089108910891,0.8712871287128713
                             ùúã ùêº                     ùúïùë¶ ùëé ùúïùë¶ ùëß,29.0,0.12903225806451613,0.8709677419354839,6.0,11.0,0.14356435643564355,0.693069306930693
          ùëñ=1         ùëó=1        ùëó ùëñùëó     ùëó=1,10.0,0.26666666666666666,0.7333333333333334,5.0,11.0,0.04950495049504951,0.7772277227722773
where,0.0,1.0,0.0,1.0,1.0,0.0,0.9752475247524752
        ‚à´ ùëßùëó           ‚à´ ùõºùëó,8.0,0.2222222222222222,0.7777777777777778,4.0,6.0,0.039603960396039604,0.8663366336633663
              ùëÖ                  ùëÖ,14.0,0.058823529411764705,0.9411764705882353,2.0,10.0,0.06930693069306931,0.8316831683168316
ùêºùëñ ùëó = ùëó dùëßùëñ                  ùëó,0.0,0.2903225806451613,0.7096774193548387,6.0,10.0,0.0,0.8465346534653465
"                                    dùõºùëñ ùëù( fÃÇi |T (ùëß ùëñ , ùõºùëñ ), Œ£ùëñ ) .                    (B8)",36.0,0.27956989247311825,0.7204301075268817,13.0,11.0,0.1782178217821782,0.5396039603960396
          ùëßùêø               ùõºùêø,10.0,0.13793103448275862,0.8620689655172413,2.0,8.0,0.04950495049504951,0.8564356435643564
The first and second order derivatives are then evaluated to,0.0,0.85,0.15000000000000002,10.0,1.0,0.0,0.7029702970297029
"          Ô£± ùúãùëñ (1 ‚àí ùúãùëñ ),",10.0,0.4,0.6,6.0,1.0,0.04950495049504951,0.8762376237623762
          Ô£¥                                     ùëñ = ùëó ‚àß ùëñ < ùëÅùê∑,10.0,0.14516129032258066,0.8548387096774194,8.0,19.0,0.04950495049504951,0.693069306930693
 ùúïùúã ùëñ Ô£¥,1.0,0.5714285714285714,0.4285714285714286,3.0,1.0,0.0049504950495049506,0.9653465346534653
          Ô£¥,10.0,0.09090909090909091,0.9090909090909091,1.0,1.0,0.04950495049504951,0.9455445544554455
                ‚àíùúã                              ùëñ ‚â† ùëó ‚àß ùëñ < ùëÅùê∑,16.0,0.16129032258064516,0.8387096774193549,8.0,16.0,0.07920792079207921,0.693069306930693
          Ô£≤,10.0,0.09090909090909091,0.9090909090909091,1.0,1.0,0.04950495049504951,0.9455445544554455
"       =            ùëñ ùúã ùëó ,                                                              (B9)",7.0,0.0967741935483871,0.9032258064516129,6.0,38.0,0.034653465346534656,0.5396039603960396
 ùúïùë¶ ùëó Ô£¥                     ùúãùëó,1.0,0.2,0.8,4.0,11.0,0.0049504950495049506,0.8514851485148515
          Ô£¥     ‚àí     √ç,10.0,0.13043478260869565,0.8695652173913043,3.0,5.0,0.04950495049504951,0.8861386138613861
"          Ô£¥ 1+ ùê∑‚àí1 exp ùë¶ùëß               ,       ùëñ   = ùëÅùê∑",10.0,0.2857142857142857,0.7142857142857143,9.0,12.0,0.04950495049504951,0.7227722772277227
          Ô£≥             ùëß=1,10.0,0.14814814814814814,0.8518518518518519,2.0,7.0,0.04950495049504951,0.8663366336633663
and,0.0,1.0,0.0,1.0,1.0,0.0,0.9851485148514851
                       ùúï ùúãùëñ              ùúï ùúãùëñ,23.0,0.13333333333333333,0.8666666666666667,4.0,8.0,0.11386138613861387,0.7772277227722773
"                       ùúïùë¶ ùõº ‚àí 2ùúãùëñ ùúïùë¶ ùõº ,                   ùëñ = ùëó ‚àß ùëñ < ùëÅùê∑",23.0,0.2602739726027397,0.7397260273972603,14.0,10.0,0.11386138613861387,0.6386138613861386
                  Ô£±,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
     2,5.0,0.16666666666666666,0.8333333333333334,1.0,1.0,0.024752475247524754,0.9702970297029703
"   ùúï ùúã  ùëñ         Ô£≤ ‚àí ùëñ ùúã ‚àí ùúã ùúïùúãùëó , ùëñ ‚â† ùëó ‚àß ùëñ < ùëÅ",3.0,0.40816326530612246,0.5918367346938775,18.0,6.0,0.01485148514851485,0.7574257425742574
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
                  Ô£¥       ùúï  ùúã,18.0,0.1,0.9,3.0,5.0,0.0891089108910891,0.8514851485148515
              =           ùúïùë¶ ùõº ùëó,14.0,0.15625,0.84375,4.0,6.0,0.06930693069306931,0.8415841584158416
                                     ùúïùúã,37.0,0.05128205128205128,0.9487179487179487,1.0,1.0,0.18316831683168316,0.806930693069307
                                             ùëñ ùúïùë¶ ùõº                          ùê∑          (B10),45.0,0.10752688172043011,0.8924731182795699,5.0,19.0,0.22277227722772278,0.5396039603960396
 ùúïùë¶ ùõº ùúïùë¶ ùëó Ô£¥      Ô£¥       ùúã ùëó ùúã ùõº ‚àí ùúïùë¶ ùõºùëó,1.0,0.4146341463414634,0.5853658536585367,13.0,7.0,0.0049504950495049506,0.7970297029702971
                                                           ùëñ = ùëÅùê∑,59.0,0.06153846153846154,0.9384615384615385,3.0,1.0,0.29207920792079206,0.6782178217821782
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
                  Ô£¥,18.0,0.05263157894736842,0.9473684210526316,1.0,1.0,0.0891089108910891,0.905940594059406
"                  Ô£¥        √ç                   ,",18.0,0.0625,0.9375,3.0,14.0,0.0891089108910891,0.7623762376237624
                  Ô£≥ 1+ ùê∑‚àí1    ùëß=1 exp ùë¶ùëß,18.0,0.35,0.65,6.0,3.0,0.0891089108910891,0.801980198019802
"                                                                                                                                                   MNRAS 000, 1‚Äì22 (2015)",147.0,0.11242603550295859,0.8875739644970414,4.0,1.0,0.7277227722772277,0.1633663366336634
avr_spaces,19.29,1.0,0.0,1.0,1.0,0.0954950495049505,0.9504950495049505
